<p>Суть интеграции с PF и Bayut заключается в передаче обращений (звонки, WhatsApp-заявки) из этих сервисов в платформу CallGear.</p><p>Документ, описывающий функциональные возможности порталов с точки зрения интеграции с платформой CallGear для передачи обращений -&nbsp;<a href="https://docs.google.com/spreadsheets/d/1A30tN2OCQG4JvogvaucnvDYip4UUcboaEemSDOcY3ms/edit#gid=961794333">https://docs.google.com/spreadsheets/d/1A30tN2OCQG4JvogvaucnvDYip4UUcboaEemSDOcY3ms/edit#gid=961794333</a></p><p>Кратко:</p><ul style="list-style-type: square;"><li>Передача обращений-звонков осуществляется напрямую. Классифайды принимают звонок от Посетителя сайта на свой &quot;технический&quot; номер и затем переадресуют на номер CallGear, <ac:inline-comment-marker ac:ref="509eeed5-3434-444a-a0a7-aa4d50b1202e">предварительно указанный в конкретной карточке объекта</ac:inline-comment-marker> (как правило, это номер конкретного Агента, выданный Агенту при настройке его рабочего места в CallGear).</li><li>Передача WhatsApp-обращений осуществляется через механизм заявок в CallGear. WhatsApp-обращение Посетителя на классифайдах приводит к созданию заявки в CallGear. Заявка автоматически попадает на Агента, который закреплен за соответствующим объектом. Для того, чтобы этот механизм работал, номер Агента должен быть авторизован в CallGear по схеме &quot;серый WhatsApp&quot; <strong>(примечание - c WABA решение пока не работает, см. ниже комментарий &quot;Работа с WABA&quot;)</strong>.</li></ul><p>Разница между PF и Bayut заключается в механизме создания заявки в CallGear. В случае PF заявка создается после получения CallGear'ом Webhook'а от PF. В случае с Bayut заявка создается в результате парсинга чата Bayut c Агентом (в чат прилетают технические сообщения от Bayut каждый раз, когда Посетитель инициирует чат).</p><p>Подробное пошаговое описание логики передачи WhatsApp-обращений от каждого из классифайдов в CallGear см. ниже.</p><h1><strong>Propertyfinder</strong></h1><ul><li><strong>Клиент</strong> пишет в Ватсап на сайте PF в карточке объекта.<br /><br /></li><li>PF отправляет Webhook в CallGear c данными о сообщении.<br /><br /></li><li><strong>CallGear</strong> получает сообщение от PF и создает заявку в CallGear через DATA API (функция &quot;upload offline message&quot;).<ul><li><em><strong>Взаимодействие с CRM<br />В CRM создается сущность лид/сделка (в зависимости от логики CRM) с привязкой к заявке.<br /></strong></em><ul><li><strong>Вариант 1. Есть &quot;коробочная&quot; интеграция (АМО, Битрикс24)</strong><ul><li>Заявка автоматически передается в CRM (как лид или другая сущность - в зависимости от функционала интеграции и настройки).<ul><li>Триггеры для передачи лида - начало/конец диалога</li><li><em>Нюансы интеграции обсуждать с продактами - Дина (АМО), Лиза (Битрикс24).</em></li></ul></li></ul></li><li><strong>Вариант 2. Нет &quot;коробочной&quot; интеграции (другие CRM либо интеграция не включена)</strong><ul><li>Клиент CallGear сам настраивает интеграцию с CRM с помощью существующих механизмов передачи заявок<ul><li>Webhook</li><li>Data API<br /><br /></li></ul></li></ul></li></ul></li></ul></li><li><strong>Агент/&quot;Дистрибутор&quot;</strong> видит обращение как заявку (в десктопном РМО или мобильном РМО).<ul><li><strong>Задачи - что нужно сделать для реализации этого функционала</strong><ul><li>Убрать фильтр (отображать заявки, загруженные через DATA API).</li><li>Создать отдельный тип заявки под PF.</li><li>Создать отдельный источник для PF в каталог источников.</li><li>Продумать какие поля из API-сообщения забрать и как отобразить в поле Message (поля, формат).</li><li>Таня: заявки должны участвовать в логике распределения (заявки-сообщения от порталов должны видеть только определенные менеджеры)<ul><li>Новый функционал - добавить сценарии распределения для заявок<ul><li><strong>Заявка уходит тому агенту, номер которого указан в соответствующем поле API-сообщения:</strong><br /><ac:image ac:height="150"><ri:attachment ri:filename="image2023-6-9_0-35-11.png" /></ac:image><br />Суть изменений - добавление поля employee_id для заявок + распределение заявки по этому полю</li></ul></li></ul></li></ul></li></ul></li><li><strong><ac:inline-comment-marker ac:ref="0d0b75ce-c764-4b7a-a138-6077622fa343">Агент/&quot;Дистрибутор&quot;</ac:inline-comment-marker></strong><ac:inline-comment-marker ac:ref="0d0b75ce-c764-4b7a-a138-6077622fa343">&nbsp;инициирует чат с Клиентом, проводит квалификацию клиента (задает ключевые вопросы в чате и принимает решение - лид это или не лид) и завершает чат.</ac:inline-comment-marker><br /><br /></li><li><strong>CallGear</strong> передает сообщения чата в CRM<ul><li><strong>Взаимодействие с CRM</strong><br /><strong>В CRM НЕ СОЗДАЕТСЯ новая сущность лид/сделка</strong><br /><strong>Чат добавляется в ранее созданный лид/сделку</strong><br /><br /></li></ul></li><li><strong>Агент/&quot;Дистрибутор&quot;</strong> переводит (чат/лид?) на соответствующего агента<br />Через трансфер чата - функция есть в РМО/ мобильном РМО<br /><ul><li><strong>Взаимодействие с CRM&nbsp;</strong><ul><li><strong><strong>Вариант 1. Есть &quot;коробочная&quot; интеграция (АМО, Битрикс24)</strong><br /></strong><strong>1) Смена ответственного</strong><br /><strong>Трансфер чата в РМО приводит к смене ответственного.<br />Важно! Если ответственный за лид/сделку будет изменен в CRM, то РМО должно &quot;узнать&quot; об этом и передать чат соответствующему агенту.<br /></strong><strong>2) Смена воронки&nbsp;[продавец ожидает увидеть лид в &quot;своей&quot; воронке - Первичка/Вторичка и т.п.]</strong></li><li><strong><strong>Вариант 2. Нет &quot;коробочной&quot; интеграции (другие CRM либо интеграция не включена)</strong><br />ПЕРЕВОД ЛИДА/СДЕЛКИ ВЫПОЛНЯЕТСЯ ВРУЧНУЮ В CRM<br /></strong></li></ul></li></ul></li></ul><h1><strong>Bayut (на паузе - пока не реализуем из-за отсутствия API для забора WhatsApp-обращений)</strong></h1><ul><li><strong>Клиент</strong> пишет в Ватсап на сайте Bayut в карточке объекта.<br />Сообщение от Клиента попадает в аккаунт Bayut в WhatsApp.&nbsp;<br /><br /></li><li><strong>Bayut</strong> делает пересылку Агенту ссылки для начала диалога с Клиентом (у каждого агента есть свой чат с Bayut, куда попадают такие ссылки).<ul><li>Важно! Чтобы CallGear мог &quot;видеть&quot; эти чаты, все WhatsApp-аккаунты, через которые работают агенты, должны быть заведены в платформу CallGear (авторизованы по схеме &quot;серый WhatsApp&quot;).</li><li><strong>Примеры ссылок</strong><ul><li>Запрос от Home seeker'a (посетитель сайта Bayut, оставляющий запрос)<strong><br /><ac:image ac:border="true" ac:height="250"><ri:attachment ri:filename="image2023-6-9_15-28-27.png" /></ac:image><br /><br /></strong></li><li>Переписка посетителя с Bayut после отправки запроса<strong><br /><ac:image ac:border="true" ac:height="250" ac:width="432"><ri:attachment ri:filename="image2023-6-9_15-29-30.png" /></ac:image></strong><br /><br /></li><li>Посетитель может самостоятельно инициировать прямой чат с агентом (в этом случае CallGear должен распознать этот чат как принадлежащий к Bayut)<strong><br /><ac:image ac:border="true" ac:height="150"><ri:attachment ri:filename="image2023-6-9_15-31-35.png" /></ac:image></strong><br /><br /></li><li>Агент получает в своем личном чате с Bayut ссылку на чат с посетителем + инфу о его запросе (ссылку на листинг + Refernce no.) (в примере ниже скрин из переписки агента с PropertyFinder - мы думаем, что Bayut работает аналогично)<strong>&nbsp;</strong><ul><li><strong><ac:image><ri:attachment ri:filename="image2023-7-4_11-19-26.png" /></ac:image><br /></strong></li><li><strong><ac:image><ri:attachment ri:filename="image2023-7-5_18-8-31.png" /></ac:image><br /></strong></li></ul></li></ul></li></ul><strong><br /></strong></li><li><strong>CallGear парсит сообщение о запросе от Посетителя на чат с Агентом из чата Bayut c Агентом и создает заявку в CallGear с возможностью инициации из заявки чата с посетителем</strong><ol><li><strong>CallGear создает лид/сделку в CRM</strong></li><li><strong><ac:inline-comment-marker ac:ref="d68fbe7c-b2af-4506-9a20-02f0fc94feb5">CallGear&nbsp;<span>отображает обращение в разделе &quot;заявки&quot; только тем агентам, к которым она относится в зависимости от сценария</span></ac:inline-comment-marker></strong></li></ol></li></ul><p><br /></p><p>Дальше с Bayut работа идет по тому же алгоритму, что и с PF (ниже включен сокращенное описание алгоритма - оно скопировано из верхней части документа):<br /><strong><br /></strong></p><ul><li>CallGear создает заявку в CallGear через DATA API (upload offline message).<ul><li>CRM<ul><li>Есть &quot;коробочная&quot; интеграция. Заявка автоматически передается в CRM (как лид или другая сущность - в зависимости от функционала интеграции и настройки).</li><li>Нет &quot;коробочной&quot; интеграции.<ul><li>Webhook</li><li>Data API<br /><br /></li></ul></li></ul></li></ul></li><li><ac:inline-comment-marker ac:ref="e3681ff4-2051-4d44-bd66-e9dc534c4e81">&quot;Дистрибутор&quot; видит обращение как заявку</ac:inline-comment-marker> (в десктопном РМО или мобильном РМО).<ul><li>Задачи<ul><li>Убрать фильтр (отображать заявки, загруженные через DATA API).</li><li>Создать отдельные типы заявок под PF.<br /><br /></li></ul></li></ul></li><li>&quot;Дистрибутор&quot; создает чат с Клиентом и проводит квалификацию<br /><br /></li><li><ac:inline-comment-marker ac:ref="d7a1312b-9435-4104-8a4f-8bc15b589043">&quot;Дистрибутор&quot; переводит (чат/лид?) на соответствующего агента</ac:inline-comment-marker><br /><br /></li><li>Агент принимает (чат/лид) в (CRM/РМО)?</li></ul><h1>Задачи по итогам встречи</h1><ac:task-list>
<ac:task>
<ac:task-id>3</ac:task-id>
<ac:task-status>complete</ac:task-status>
<ac:task-body><span><ac:link><ri:user ri:userkey="ff80808154250e9a0154250f30b5004c" /></ac:link> проводит с&nbsp;<ac:link><ri:user ri:userkey="4353faa981f3e0620183f93d6b230030" /></ac:link>обсуждение логики взаимодействия решения с CRM (какие сущности в какой последовательности хотим создавать в CRM, как хотим управлять обновлением информации после чата), дополняет описание USER FLOW и передает&nbsp;<ac:link><ri:user ri:userkey="ff80808154250e9a0154250f30920018" /></ac:link> &nbsp;</span></ac:task-body>
</ac:task>
</ac:task-list><h1><span>Заметки</span></h1><p><span>Вопросы на проработку</span></p><ul style="list-style-type: square;"><li><span>Если в агентстве используется WABA а не серый WhatsApp, то что в модели работы с порталами надо будет поменять? (результат проработки - с WABA решение пока не делаем, возможно, в следующих версиях)</span></li><li><span><ac:inline-comment-marker ac:ref="3c05314d-1cda-4dca-9c09-0275c4877e94">Если схема с парсингом WhatsApp агента (интеграция с Bayut) будет работать надежнее схемы с Webhook (интеграция с PF), то не использовать ли нам ее и для PF тоже? (результат проработки - от схемы с парсингом WhatsApp агента пока отказались, так как она разбивает общую логику работы с каналами; вследствие этого интеграцию с Bayut не понятно как реализовать, решили поставить на паузу )</ac:inline-comment-marker></span></li><li><span><ac:inline-comment-marker ac:ref="14c81574-79d2-48ea-bdd8-7204a0aeb7eb">Что мы хотим видеть в отчетах? <strong>(задача для проработки!)</strong></ac:inline-comment-marker></span></li></ul><p><span><br /></span></p>