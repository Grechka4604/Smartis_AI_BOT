<h4>Плановые данные CRM для план-факт отчёта</h4><p>Зачем делали: предоставляем ежедневную отчётность для ежедневной работы отдела маркентинга в едином окне Смартис. Это один из отчётов, который использует маркетинг.</p><p>Сотрудники маркетинга смогут работать со своими отчётами в Смартис для принятия решений&nbsp;</p><p><strong><br /></strong></p><p><strong>Важные правила:</strong></p><p>- план не может быть в разных месяцах - только период внутри одного месяца</p><p>- на один и тот же месяц на стороне Смайнекс может быть множество строк планов</p><p>- При отправке нам Смайнекс на своей стороне &quot;схлопывает&quot; строки одного месяца в одну с уже итоговым значением за этот месяц</p><p>- Уникальным ID считаем комбинацию атрибутов плана:</p><p>Проект + Категория + Тип мероприятия + Источник мероприятия + Профиль + Месяц</p><p>- месяц договорились использовать в таком формате &quot;2024-01&quot;</p><p><strong><br />Как обмениваемся?</strong></p><p>- инкрементально</p><p>- ежедневно - всё, что создано + изменилось с 01.01.2023</p><p>синхрон -SminexPlanesSync</p><p>- используем сервис&nbsp;get_sminex_plan (описание есть в приложенном файле)</p><p>(возможные ошибки:&nbsp;<strong><a href="https://app.asana.com/0/1207247484206447/1208637111904115/f">https://app.asana.com/0/1207247484206447/1208637111904115/f</a>&nbsp;)</strong></p><p><strong>Пример который разбирали на созвоне:</strong></p><p>У Смайнекс 2 строки планов на январь:</p><p>&middot; Проект - ЖК Лаврушинский</p><p>&middot; Категория - жилая/нежилая</p><p>&middot; Тип мероприятия - звонок/презентация/брони/сделки</p><p>&middot; Источник мероприятия - Брокеры/SminexLab</p><p>&middot; Профиль - машиноместо/квартира/кладовка</p><p>&middot; Месяц - [01.01,31.01]</p><p>&middot; Значение - 100 =&gt; 100/31</p><p><br /></p><p>&middot; Проект - ЖК Лаврушинский</p><p>&middot; Категория - жилая/нежилая</p><p>&middot; Тип мероприятия - звонок/презентация/брони/сделки</p><p>&middot; Источник мероприятия - Брокеры/SminexLab</p><p>&middot; Профиль - машиноместо/квартира/кладовка</p><p>&middot; Месяц - [15.01,31.01]</p><p>&middot; Значение - 20 =&gt; 20/16</p><p><br /></p><p><strong>ИТОГО нам в Смартис прилетит</strong></p><p>&middot; Проект - ЖК Лаврушинский</p><p>&middot; Категория - жилая/нежилая</p><p>&middot; Тип мероприятия - звонок/презентация/брони/сделки</p><p>&middot; Источник мероприятия - Брокеры/SminexLab</p><p>&middot; Профиль - машиноместо/квартира/кладовка</p><p>&middot; Месяц - 2024-01</p><p>&middot; Значение - 100 =&gt; 100*15/31 + 16*20/16</p><p><ac:structured-macro ac:name="view-file" ac:schema-version="1" ac:macro-id="ce7dc0e8-177b-4808-be1a-b9d3b9bcb5ec"><ac:parameter ac:name="name"><ri:attachment ri:filename="Smartis_Сервисы_final (2).xlsx" /></ac:parameter><ac:parameter ac:name="height">250</ac:parameter></ac:structured-macro></p><p><br /></p><h3>Доработка для достоверности по CRM Endpoint</h3><p>Была добавлена настройка часового пояса у интеграций по CRM Endpoint. В Смайнекс часовой пояс - UTC+0</p><p>смайнекс при передачи данных нам просит не удалять сущности, которые в самой CRN Смайнекса удалены. В связи с этим при подсчете достоверности по CRM Endpoint возникает ситуация, что &quot;у нас&quot; данных больше чем &quot;в апи&quot;. Из-за этого достоверность была &quot;красной&quot; и мешала выявить ситуации нехватки данных. Поэтому мы сделали доработку для этого клиента, чтобы в случаях когда &quot;у нас&quot; данных больше чем &quot;в апи&quot;, достоверность всегда была 100%. Эту логику согласовали с клиентом, тк кейс связан с удалением данных в смайнекс которые в смартис попросили не удалять.</p><p><br /></p><h3>Конкатенация данных в импорте (объединение значений из 2 полей в одно)</h3><p>Сделали конкатенацию для Шаблона 10 для поля &quot;профиль&quot; и &quot;проект&quot;, завели все проекты на все комбинации для того, чтобы клиент мог загружать в нас данные по API со следующими полями:</p><p>0. Проект</p><p>1. Профиль</p><p>2. Период плана</p><p>3. Категория расходов</p><p>4. Статья расходов</p><p>5. Сумма</p><p>При импорте именно этого шаблона клиента sminex конкатенировать профиль в проект через пробел.<br />Пример:</p><ul class="RichTextList-bulleted"><li><p>Проект &quot;Twist&quot;</p></li><li><p>Профиль &quot;Офис&quot;</p></li><li><p>Результат конкатенации &quot;Twist Офис&quot;</p></li></ul><p>&nbsp;В качестве проекта будет использована именно сконкатенированная строка &quot;Twist Офис&quot;.&nbsp;</p><p><span style="color: rgb(30,31,33);">при импорте шаблона вручную в превью будет сразу показываться конкатенация.&nbsp;</span></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image (7).png" /></ac:image></p><p><span style="color: rgb(30,31,33);">при сопоставлении тоже будет конкатенированная строка</span></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image (8).png" /></ac:image></p><p>При импорте через апи он так же будет склеивать две колонки -&nbsp;<span style="color: rgb(30,31,33);">в файле этого не видно, но внутри под капотом будет склеивать их так же как при ручной загрузке</span></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image (9).png" /></ac:image></p><p><br /></p><p><br /></p><p><br /></p>