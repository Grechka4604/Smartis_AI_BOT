<p>CommonCohort</p><p>В этом методе происходит 3 шага</p><p>Получаем сырые данные с номерами телефонов по полям crm_contacts и phone_a, чтобы номера были независимо от того получаем crm данные или реквесты</p><p>Берем из полученных данных уникальные номера&nbsp;<span style="color: rgb(0,51,102);">getUniqueAnalyzedPhones</span></p><p>Накладываем фильтры по телефонам: 'App\Classes\Report\Filters\FiltersList\SmartisCRM\ContactPhoneFilter', 'App\Classes\Report\Filters\FiltersList\Common\PhoneFilter', в зависимости от того, какие данные получаем</p><p>afterQuery</p><p>Получаем сырые данные в зависимости от выбранной стратегии getRawCohortData</p><p>Получаем из них id-шники getItemsIdsWithPhone это специальный метод, добавленный через интерфейс CohortPhoneStrategyInterface, для когорты телефонов, чтобы собирать id по телефонам</p><p>Обшая логика описана на следующей схеме</p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-1_15-3-43.png" /></ac:image></p>