<p>Коробка, это наш продукт Smartis развернутый на сервере клиента.&nbsp;</p><p>Обычно это делают из-за страхов &quot;что на их данные кто-то посмотрит или использует&quot;, или из-за внутренних требований информационной безопасности / СБ.</p><p>Все действия любого пользователя как внутри интерфейса коробочного Smartis, так и на удаленном рабочем столе пишутся и автоматически отслеживаются на предмет злоупотребления данными клиента.&nbsp;<strong>Например</strong>&nbsp;отправить себе на рабочую почту выгрузку обращений или срм или просто отчет с циферками - это злоупотребление которое нарушает НДА с клиентом.</p><p><br /></p><p>Есть 2 разных варианта как нам попадать в коробку (какие то коробки по одному варианту, какие то по второму):</p><ol><li>Предоставляется доступ к удаленному рабочему столу (это называется RDP - Remote Desktop Protocol) внутри сети клиента, и уже оттуда - через браузер в коробку Smartis.&nbsp;</li><li>Сам интерфейс коробки Smartis доступен извне - как любой сайт, но сам сервер для работы разработчиков по RDP</li></ol><p><strong>Для входа в коробку ПМ требуется:</strong></p><ul style="list-style-type: square;"><li>создать пользователя (логин + пароль) в коробке с правами супер-админа (через доступ другого ПМ или по согласованию с клиентом на их стороне)</li><li>описать, что вход в смартис в коробке будет не по ссылке <a class="ProsemirrorEditor-link" href="https://my.smartis.bi/">https://my.smartis.bi/</a>, ссылка будет отличаться и в идеале ее нужно где-то хранить. Обычно ее закрепляют в описании проекта в asana. Пример ссылки в лср:&nbsp;<br /><ac:image ac:thumbnail="true" ac:height="45"><ri:attachment ri:filename="image (8).png" /></ac:image></li><li>также дл разработчиков смартис требуется создавать отдельные ИНДИВИДУАЛЬНЫЕ доступы для авторизации в коробке. Это нужно из соображений безопасности, поэтому нельзя чтобы у всех разработчиков был 1 логин и пароль на всех.<br /><br /></li></ul><p><strong>При развертывании новой коробки</strong></p><p>Рекомендуется провести тестирование базового функционала, для этого существует Шаблон -&nbsp;<a class="external-link" href="https://app.asana.com/0/1204486395777830/1205378312352904/f" rel="nofollow">https://app.asana.com/0/1204486395777830/1205378312352904/f</a></p><p>Если уже созданы доступы в коробку для консультантов - можно в консультацию, если нет - на кого то из тех у кого есть доступ в коробку.&nbsp;</p><p><br /></p><p><strong>Некоторые интеграции в коробках работают не так как в облаке</strong>, если вы поддерживаете/внедряете/разрабатываете что то для коробки - то вы должны знать эти особенности.</p><ol><li>Все интеграции работающие через веб-хуки (<a href="https://docs.uiscom.ru/display/SMARTIS/Marquiz" rel="nofollow">Марквиз</a>,&nbsp;<a href="https://docs.uiscom.ru/display/SMARTIS/JivoSite" rel="nofollow">Jivosite</a>, Profitbase-лиды, Bothelp) - сами вебхуки должны настроены в облаке, обращения по ним отображаться в облаке и отдельным процессом они переносятся в коробку</li><li>Работа нашего счетчика сессий и прослушка форм - должна быть настроена в облаке. При создании сайта в коробке - он должен автоматически создаваться в облаке, что обычно достаточно для сбора сессий, но дополнительные настройки (учет поддоменов, зеркала сайта итд ) надо делать в облаке.</li><li>Интеграции Postview - должны сначала настраиваться в облаке и далее данные автоматически будут переноситься в коробку с задержкой не более суток</li><li>Бенчмарк не учитывает данные коробочников. И наоборот - в коробках бенчмарк недоступен.</li></ol><p><br /></p><p><strong>Другие особенности коробок:</strong></p><ol><li>Для каждого коробочного клиента в нашем облаке есть свой кабинет, в котором можно выполнять часть операций и настраивать специфичные интеграции (бенчмарк, вебхуки).&nbsp;</li><li>Для экономии ресурсов серверов (которые обычно выдают хуже чем мы просим) - мы выключаем процессы синхронизации в рабочее время. Синхроны работают только по ночам.&nbsp;</li><li>&quot;Очереди&quot; которые запускаются при обновлении данных из раздела &quot;Мониторинг системы&quot; - работают и днем.</li><li>Обновления кода в коробках происходит реже (обычно раз в неделю) чем нашего облака (1 основной релиз + 2-3 hotfix в неделю)&nbsp; - нужна задержка чтобы оттестировать новые функционалы, &quot;стабилизировать&quot; их.</li><li>Мониторинг достоверности коробок доступен также в облачных кабинетах:&nbsp;Сетл (коробка) - 2076 облако, Эталон (коробка) - 718 облако, ЛСР (коробка)-2172 облако, Бест новострой - 1661 облако, Текта (коробка)- 1872 облако</li><li>При создании сайта в коробке, он копируется и создается также в облачном кабинете.<br /><br /></li></ol><p><strong>Как работает мониторинг системы (достоверность) коробки в облаке:</strong></p><ul><li><strong>достоверность фактически считается в коробке, но передается в облако</strong></li><li><p>Отличить от других интеграций можно по специфичному названию integration #...</p></li><li>в облаке интеграции, по которым отображается достоверность из коробки, НЕ СУЩЕСТВУЮТ (а значит, обновить достоверность по ним в облаке не получится)<br /><strong><br />Пример того, как выглядит достоверность из коробки в облачном кабинете:</strong><br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-3_13-46-54.png" /></ac:image></span></li></ul><h3>Зеркальное создание площадок в коробке и облаке</h3><p>При создании новой площадки, изменении условий площадки, изменении названия площадки, удалении площадки в коробке данные изменения автоматически происходят и в облачном кабинете коробочного клиента.<br />Если какая-то ранее созданная в коробке площадка не &quot;отзеркалилась&quot; в облаке, нужно по этой площадке в коробке сделалть пересохранение (просто в меню настройки площадки нажать &quot;сохранить&quot;). В таком случае она появится в облачном кабинете.</p><p>В облачных кабинетах коробочных клиентов создание, изменение условий площадок и их удаление недоступно.</p><p>При всех этих событиях запускается source transported plan. В течение 10 минут после внесения изменений в коробке, изменения отражаются в облачном кабинете.</p><p>Поддерживать одинаковость привязок в облаке и коробке не обязательно, тк клиент работает только в коробках.</p><p><br /></p><h3><strong>Несколько клиентов внутри одной коробки:</strong></h3><p>По запросу клиента можно организовать разделение коробки на оболочки: например, когда у клиента есть проекты и отделения в разных городах и нужно сделать так, чтобы сотрудники разных регионов использовали только свои отчеты и не видели данных другого региона. Для такого разделения нам не достаточно стандартных настроек прав по пользователям и отделам.<br /><br />Для того, чтобы можно было создать несколько оболочек (кабинетов) внутри одной коробки, необходимо обратиться к менеджеру, он создаст задачу на разработку Smartis.&nbsp;</p><h3>Как работает функционал разделения внутри коробки</h3><ol><li>Появляется кнопка Клиенты (она доступна не всем пользователям коробки. Перечень пользователей, которые могут эту кнопку видеть, определяет клиент и присылает менеджеру. Разработчик в рамках выполнения задачи по разделению доступов указывает пользователей, которые смогут переключаться между оболочками внутри коробки, и также разработчик таких пользователей удаляет при необходимости). Этой кнопкой пользуются определенные пользователи клиента и сотрудники Smartis, никакие дополнительные доступы для переключения между оболочками не нужны. Пользователи, у которых нет прав переключения, смогут заходить и просматривать данные только той оболочки, к которой у них доступ<br /><em><br />Например, маркетологи Москвы не смогут попасть в оболочку СПб в коробке клиента, а супер-админ клиента смож</em>е<em>т</em></li></ol><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-14_10-2-11.png" /></ac:image></span><br /><br />2. При нажатии на кнопку &quot;Клиенты&quot; открывается окно, в котором можно ввести id оболочки и переключиться в нужную.<br />ID оболочки присваивается такой же, как у облачного кабинета коробки в Smartis.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-14_10-3-23.png" /></ac:image></span></p><p>3. После ввода нужного id или названия оболочки нужно нажать на кнопку перехода (как на скрине ниже) и откроется нужная оболочка<br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-14_10-5-19.png" /></ac:image></span><br /><br /><br />Внутри каждой оболочки данные будут свои, тк по сути это разные клиентские кабинеты. Никакие данные не будут пересекаться, поэтому важно учесть:</p><ul><li>Добавление новой оболочки - по факту новое внедрение, тк нужно будет подключить все интеграции, которые нужны в этом кабинете, воспроизвести отчеты, привязки, показатели, иерархию каналов и сайтов-объектов-проектов</li><li>Если вы сначала создали сайты в облачном кабинете, для которого добавляется оболочка внутри коробки, то сайты из этого облачного кабинета перенесутся в коробку автоматически в нужную оболочку (но вы также можете создать сайты сразу внутри коробки)</li><li>Добавление новых пользователей в новую оболочку работает так же, как в облаке или обычной коробке</li><li>Внутри отдельной оболочке можно управлять правами доступов отделов и пользователей&nbsp;как в облаке или обычной коробке</li></ul><p><br /><br /><strong>Для разработчика Smartis:</strong><br />В рамках&nbsp;<a class="external-link" href="https://app.asana.com/0/1201722676269311/1205421308032519" rel="nofollow">данной задачи</a>&nbsp;была добавлена возможность работы нескольких клиентов в одной коробке, для разделения например зоны МСК и СПБ.<br />Также в рамках&nbsp;<a class="external-link" href="https://app.asana.com/0/1205555692659257/1205956562645220" rel="nofollow">проекта исключения различий с коробками</a>&nbsp;появились следующие изменения:</p><ul><li>Больше нет<strong>&nbsp;.env.box.example</strong>, теперь разницы в переменных между коробочным&nbsp;<strong>.env</strong>&nbsp;и облачным нет.</li><li>В .env теперь не обязательны значения&nbsp;<strong>SMARTIS_BOX_CLIENT_ID,&nbsp;CLOUD_CLIENT_ID,&nbsp;SMARTIS_API_TOKEN,&nbsp;SMARTIS_BOX_TOKEN</strong></li><li>В коробке в&nbsp;<strong>box_clients</strong>&nbsp;заполняем клиента как&nbsp;<strong>в коробке</strong>, так и&nbsp;<strong>в облаке</strong>,&nbsp;<strong>client_id, token, auth_token</strong>, туда и переехали значения из&nbsp;<strong>env</strong><strong><br /></strong></li><li>Клиента в коробке теперь заводим&nbsp;<strong>с таким же id</strong>, как и в&nbsp;<strong>облаке</strong><strong><br /></strong></li><li>Функция&nbsp;<strong>XRM теперь работает в коробках</strong>, достаточно&nbsp;<u><span style="color: rgb(0,51,102);">включить/добавить</span></u>&nbsp;меню как в облаке (<strong>Клиенты</strong>) и дать нужным менеджерам доступ к XRM,&nbsp;<strong>isXrmUser=1</strong>&nbsp;в&nbsp;<strong>clients_managers</strong><strong><br /></strong></li><li>Каждая коробка работает на своём сервере, не как раньше все на&nbsp;<strong>old_dev</strong></li><li>Для определения находимся мы в коробке или нет используется&nbsp;<strong>APP_SERVER</strong>, который указывается в .<strong>env</strong>, для коробок название должно начинаться с&nbsp;<strong>BOX_</strong>&nbsp;например&nbsp;<strong>BOX_Etalon</strong></li><li>Все сервера указываются в&nbsp;<strong>\App\Enums\Servers</strong>, там же статичные методы определения конкретной коробки&nbsp;<strong>isEtalonBox</strong>&nbsp;и т.д.</li><li>Избавились от ветки&nbsp;<strong>box_master</strong>, теперь коробочные ветки наследуются от&nbsp;<strong>master</strong>.</li></ul><p><br /></p><p><strong>Процесс раскатки новой коробки:</strong></p><ul><li>Получить и зафиксировать доступы от VPN и к серверу</li><li>Удостовериться с Костей, что директория&nbsp;<code>/var/smartisstat/databases</code>&nbsp;находится на диске под базы (если таковой имеется)</li><li>Получить облачный&nbsp;<code>client_id, теперь в коробках он такой же</code></li><li>Пойти к Валере с просьбой запустить команду в облаке<ul><li><code>./artisan box:tokens</code></li></ul></li><li>Запустить скрипт&nbsp;<code>bin/new_box.sh</code></li><li>Скачать скрипт&nbsp;<code>wget -O /tmp/install.sh &lt;<a class="external-link" href="https://my.smartis.bi/scripts/install.sh" rel="nofollow">https://my.smartis.bi/scripts/install.sh</a></code>&gt;</li><li>Запустить скрипт<ul><li><code>chmod +x /tmp/install.sh</code></li><li><code>/tmp/install.sh</code></li></ul></li><li>Ответить на все его вопросы</li></ul><p><br /></p>