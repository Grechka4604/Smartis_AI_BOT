<h1>Ключевые синхроны</h1><p>Необходимо отслеживать, чтобы все своевременно запускалось и не было критических ошибок. Ошибки логинов и прав доступа к АПИ не в счет.</p><p><strong>Важно! Идентификаторы синхронов в коробках могут отличаться. Ищите их по названиям синхронов или названиям классов синхронов.</strong></p><table class="wrapped"><colgroup><col /><col /><col /></colgroup><tbody><tr class="xtr-0"><td class="xtd-0-0"><p>(null)</p></td><td class="xtd-0-1"><p>418</p></td><td class="xtd-0-2"><p>Accuracy: контроль статусов очередей</p></td></tr><tr class="xtr-1"><td class="xtd-1-0"><p>(null)</p></td><td class="xtd-1-1"><p>65</p></td><td class="xtd-1-2"><p>Accuracy: основной синхрон заполнения itogs</p></td></tr><tr class="xtr-2"><td class="xtd-2-0"><p>(null)</p></td><td class="xtd-2-1"><p>519</p></td><td class="xtd-2-2"><p>Accuracy: создание планов по плохой достоверности</p></td></tr><tr class="xtr-3"><td class="xtd-3-0"><p>(null)</p></td><td class="xtd-3-1"><p>447</p></td><td class="xtd-3-2"><p>HandOperations: контроль за джобами</p></td></tr><tr class="xtr-4"><td class="xtd-4-0"><p>Яндекс.Директ</p></td><td class="xtd-4-1"><p>460</p></td><td class="xtd-4-2"><p>YDirect регулярный синхрон парсинга реквестов</p></td></tr><tr class="xtr-5"><td class="xtd-5-0"><p>Яндекс.Директ</p></td><td class="xtd-5-1"><p>538</p></td><td class="xtd-5-2"><p>YDirect: Синхрон актуализирует названия для МКБ/Smart кампаний</p></td></tr><tr class="xtr-6"><td class="xtd-6-0"><p>Яндекс.Директ</p></td><td class="xtd-6-1"><p>192</p></td><td class="xtd-6-2"><p>YDirect: синхрон групп объявлений</p></td></tr><tr class="xtr-7"><td class="xtd-7-0"><p>Яндекс.Директ</p></td><td class="xtd-7-1"><p>144</p></td><td class="xtd-7-2"><p>YDirect: синхрон истории измененний(для объявлений)</p></td></tr><tr class="xtr-8"><td class="xtd-8-0"><p>Яндекс.Директ</p></td><td class="xtd-8-1"><p>191</p></td><td class="xtd-8-2"><p>YDirect: синхрон картинок(ссылок) для объявлений</p></td></tr><tr class="xtr-9"><td class="xtd-9-0"><p>Яндекс.Директ</p></td><td class="xtd-9-1"><p>27</p></td><td class="xtd-9-2"><p>YDirect: синхрон по внутренним аккаунтам</p></td></tr><tr class="xtr-10"><td class="xtd-10-0"><p>Яндекс.Директ</p></td><td class="xtd-10-1"><p>28</p></td><td class="xtd-10-2"><p>YDirect: синхрон по кампаниям</p></td></tr><tr class="xtr-11"><td class="xtd-11-0"><p>Яндекс.Директ</p></td><td class="xtd-11-1"><p>29</p></td><td class="xtd-11-2"><p>YDirect: синхрон по объявлениям</p></td></tr><tr class="xtr-12"><td class="xtd-12-0"><p>Яндекс.Директ</p></td><td class="xtd-12-1"><p>504</p></td><td class="xtd-12-2"><p>YDirect: синхрон статистики [ЮСИ]</p></td></tr><tr class="xtr-13"><td class="xtd-13-0"><p>Яндекс.Директ</p></td><td class="xtd-13-1"><p>503</p></td><td class="xtd-13-2"><p>YDirectAds: Создание job-в для синхронизации объявлений</p></td></tr><tr class="xtr-14"><td class="xtd-14-0"><p>Яндекс.Директ</p></td><td class="xtd-14-1"><p>362</p></td><td class="xtd-14-2"><p>YDirectInsights: Создание плана</p></td></tr><tr class="xtr-15"><td class="xtd-15-0"><p>Яндекс.Директ</p></td><td class="xtd-15-1"><p>345</p></td><td class="xtd-15-2"><p>YDirectInsights: Создание плана для получения расходов директа в MySql</p></td></tr><tr class="xtr-16"><td class="xtd-16-0"><p>Яндекс.Директ</p></td><td class="xtd-16-1"><p>346</p></td><td class="xtd-16-2"><p>YDirectInsights: Создание плана для сохранения расходов директа в ClickHouse</p></td></tr><tr class="xtr-17"><td class="xtd-17-0"><p>Яндекс.Директ</p></td><td class="xtd-17-1"><p>443</p></td><td class="xtd-17-2"><p>YDirectInsightsKeywords: Создание job-в по ключевым словам директа</p></td></tr><tr class="xtr-18"><td class="xtd-18-0"><p>Яндекс.Директ</p></td><td class="xtd-18-1"><p>442</p></td><td class="xtd-18-2"><p>YDirectInsightsKeywords: Создание плана</p></td></tr></tbody></table><table class="wrapped"><colgroup><col /></colgroup><tbody><tr class="xtr-0"><td class="xtd-0-0"><p>SELECT</p><p>-- <a href="http://si.id">si.id</a>, si.class_name, si.is_active, si.period, si.time_condition_month, si.time_condition_day, si.time_condition_weekday, si.time_condition_hour</p><p>FROM_UNIXTIME(si.last_start), services.title AS services_title, si.*</p><p>-- si.title, si.class_name, si.period, si.can_manual_run, si.is_active, si.time_condition_hour</p><p>FROM synchronizations.synchronization_items si</p><p>LEFT JOIN smartis_stat.services ON si.service_id = <a href="http://smartis_stat.services.id">smartis_stat.services.id</a></p><p>WHERE TRUE</p><p>&nbsp;AND si.is_active = 1</p><p>&nbsp;AND (si.service_id = 1</p><p>&nbsp; OR <a href="http://si.id">si.id</a> = 14 OR <a href="http://si.id">si.id</a> = 65 OR <a href="http://si.id">si.id</a> = 519 OR <a href="http://si.id">si.id</a> = 447</p><p>&nbsp; OR si.title LIKE '%Accuracy%' OR si.title LIKE '%Hand%'</p><p>&nbsp; )</p><p>-- AND synchronization_items.title LIKE '%%'</p><p>-- AND class_name LIKE '%First%'</p><p>-- AND <a href="http://synchronization_items.id">synchronization_items.id</a> IN (522)</p><p>-- AND <a href="http://synchronization_items.id">synchronization_items.id</a> = 522</p><p>-- OR <a href="http://synchronization_items.id">synchronization_items.id</a> = 400</p><p>-- ORDER BY services.title;</p><p>ORDER BY</p><p>&nbsp;si.last_start DESC</p><p>--&nbsp; si.class_name</p><p>-- si.title</p><p>;</p></td></tr></tbody></table><p><br /></p><h1>Мониторинг в Графана</h1><p><a href="https://grafana.smartis.bi/d/Uxb10IAIk/ydirect?orgId=1&amp;from=now-7d&amp;to=now">https://grafana.smartis.bi/d/Uxb10IAIk/ydirect?orgId=1&amp;from=now-7d&amp;to=now</a></p><p>У каждой панели в верхнем левом углу есть подсказка (см. пиктограмму с буквой i).</p><p><br /></p><h2>Итоги достоверности</h2><p>Процент высчитывается по среднему среди всех процентов всех сущностей всех интеграций ЯД клиента за указанный день. Если никакой цифры нет &mdash; значит нет никакой информации в БД. Для коробочных интеграций если нет цифры (квадратик черный), значит не пришли данные из коробки.</p><p>График Итоги достоверности должен быть зелёненьким. Если сильно покраснело &ndash; см. выполнение синхронов (могли отстать с временем запуска) и ошибки в таблицах планов получения данных и вычисления достоверности (могли не выполниться из-за ошибок). См. также ниже раздел Запросы с примерами запросов для получения полной информации о состоянии получения данных по конкретной интеграции/логину.</p><p><br /></p><p><br /></p><p><ac:image ac:height="250"><ri:attachment ri:filename="Без заголовка.png" /></ac:image></p><p>Важно учитывать, что у некоторых клиентов интеграции крутятся в коробках. Например, ЛСР #2172. Поэтому, если что-то покраснело или квадратик черный, надо смотреть в коробку, что там не так. Понять, что это коробка, можно по названию интеграции в облаке - Integration #...</p><p><ac:image ac:height="250"><ri:attachment ri:filename="Без заголовка.png" /></ac:image></p><h2>Записи в accuracy_itogs</h2><p>Таблица Записи в accuracy_itogs (см. ниже) Показывает количество и процент записей с достоверностью ниже 99.85 за последние 90 дней. Хорошо, если Процент записей с низкой достоверностью &lt; 1. Должен стремиться к 0, но по факту такое вряд ли возможно, поскольку ЯД может пересчитывать данные в прошлом, а мы регулярно обновляем данные и достоверность. Если процент резко вырос или непрерывно растет, необходимо проверить работоспособность синхронов создания, планирования и получения данных по расходам и ключевым словам, расчета достоверности и т. п. (см. выше). Также необходимо проверить доступность АПИ ЯД.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="Без заголовка.png" /></ac:image></p><h2>ЮСИ за текущий день</h2><p>Таблица ЮСИ за текущий день. Достоверность ЮСИ за текущий день. Достоверность должна быть &gt; 0. Eсли менее 80%, см. абсолютные цифры. Как правило, это нормально для небольших цифр типа 900 и 600. Если 0 или очень мала, то скорее всего отстают синхроны 504 или получения данных или проблемы с доступом к ЯД (см. выше). Также, достоверность может быть 0, если У нас и Всего различаются в кратное количество раз. Так работает формула расчета. Также, если Достоверность = 0 и У нас = 0, а Всего больше нуля, то возможно в настоящий момент идет перезабор данных и обновление данных в таблице КХ.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="24.png" /></ac:image></p><h2>Синхроны</h2><p>Количество и качество ошибок (см. рисунки ниже) должно быть стабильным день ото дня. Явные всплески на порядок &ndash; значит что-то не так с конкретным синхроном или самим ЯД.</p><p>Следующие ошибки не влияют на качество данных и могут быть проигнорированы:</p><ul><li>[...] - Specify the advertiser's login in the HTTP Client-Login header - Указан логин агентства, там где ожидается логин рекламодателя.</li><li>[...] - No rights to access the agency service - Логин помечен как агентство, но не имеет соответствующих полномочий.</li><li>[...] - No rights - У указанного логина нет прав для использования API.</li><li>[...] - SQLSTATE[HY000] [2002] Connection refused (...) - Не доступна БД.</li><li>Get, Save or PrepareData failed: Объект не найден. Code: 404 (Объект не найден). Интеграция #... &ndash; эта ошибка говорит о том, что один из логинов, входящий в данную интеграцию, удален.</li><li>Get, Save or PrepareData failed: Логин не подключен к YDirect. Code: 400 (Ваш логин не подключен к Яндекс.Директу). Интеграция #... &ndash; эта ошибка говорит о том, что один из логинов, входящий в данную интеграцию, не подключен к ЯД или нет прав на получение данных по этому логину.</li></ul><p><br /></p><p><ac:image ac:height="250"><ri:attachment ri:filename="йе.png" /></ac:image></p><p><ac:image ac:height="250"><ri:attachment ri:filename="267г6.png" /></ac:image></p><h2>Текущее состояние расходов и ключевых слов</h2><p>Текущее состояние расходов и ключевых слов (см. рисунок ниже) показывает необработанные записи в таблицах очередей. К утру их должно быть минимальное количество. Если их сотни, например, в статусе created, возможно сильно отстали синхроны создания заданий получения данных или перегружена система. Также так может быть сразу после выполнения 519 синхрона, если им создано много планов повторного забора данных сомнительного качества.</p><p>Ручные операции &ndash; на статус error не смотрим. Там куча старых мертвых записей.</p><p>Текущее состояние синхронов показывает, когда был последний запуск и интервалы запуска. Можно посмотреть, соответствует ли факт ожиданиям и настройкам параметров запуска синхрона.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="Без заголовка.png" /></ac:image></p><h2>Отставание синхронов</h2><p>Графики Отставание синхронов приведены для синхронов получения данных, для которых важна частота (на графиках синхроны с частотой 1 мин.) и стабильность запуска. Если отставание постоянно велико (более 3 минут) или очень велико (всплески 30 мин и более), то это может привести к отставанию получения данных и расчета достоверности и, как следствие, появлению дней с низкой достоверностью на графике &ldquo;Итоги достоверности&rdquo; за предыдущий день или ранее.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="Без заголовка.png" /></ac:image></p><h1>Запросы</h1><p>Запросы получения детальной информации о конкретных проблемных интеграциях. Рекомендуется выполнять в IDE, которая позволяет одновременно открыть несколько окон результатов для совместного просмотра данных. Задайте свои параметры. Все id, например integration_id и login_id могут быть 0. Далее необходимо проанализировать выведенные данные для выявления проблем. Особое внимание уделить полям error и log.</p><h2>Получение данных и проверка достоверности</h2><p>Проверка всего, что может влиять на достоверность (в том числе ошибки получения данных), для заданных параметров. Важно проверить все поля статусов, логов и ошибок в записях таблиц.</p><table class="wrapped"><tbody><tr class="xtr-0"><td class="xtd-0-0"><p>SET @date = '2024-07-17';</p><p>SET @client_id = 2178;</p><p>SET @integration_id = 7838;</p><p>SET @login_id = 0;</p><p><br /></p><p>SELECT</p><p>&nbsp;ai.*</p><p>FROM smartis_stat.accuracy_itogs ai</p><p>WHERE</p><p>&nbsp;ai.date = @date</p><p>&nbsp;AND IF (@client_id &gt; 0, ai.client_id = @client_id, TRUE)</p><p>&nbsp;AND ai.service_id = 1</p><p>&nbsp;AND IF (@integration_id &gt; 0, ai.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND (ai.percent &lt; 99.85 OR ai.percent IS NULL)</p><p>&nbsp;ORDER BY ai.percent</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;ap.*</p><p>FROM smartis_stat.accuracy_plan ap</p><p>WHERE</p><p>&nbsp;ap.date = @date</p><p>&nbsp;AND IF (@integration_id &gt; 0, ap.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND IF (@client_id &gt; 0, ap.client_id = @client_id, TRUE)</p><p>&nbsp;AND ap.service_id = 1</p><p>&nbsp;ORDER BY ap.updated_at DESC</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;ho.*</p><p>FROM smartis_stat.hand_operations ho</p><p>WHERE</p><p>&nbsp;ho.date = @date</p><p>&nbsp;AND IF (@client_id &gt; 0, ho.client_id = @client_id, TRUE)</p><p>&nbsp;AND IF (@integration_id &gt; 0, ho.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND ho.service_id = 1</p><p>&nbsp;AND ho.entity IN ('insights', 'keywords')</p><p>&nbsp;ORDER BY ho.created_at DESC</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;hoydi.*</p><p>&nbsp;FROM smartis_stat.hand_operations_to_yd_insights hoydi</p><p>&nbsp;LEFT JOIN smartis_stat.hand_operations ho ON hoydi.hand_operation_id = <a href="http://ho.id">ho.id</a></p><p>WHERE</p><p>&nbsp;ho.date = @date</p><p>&nbsp;AND IF (@client_id &gt; 0, ho.client_id = @client_id, TRUE)</p><p>&nbsp;AND IF (@integration_id &gt; 0, ho.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND ho.service_id = 1</p><p>&nbsp;AND ho.entity = 'insights'</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;hoydk.*</p><p>&nbsp;FROM smartis_stat.hand_operations_to_yd_keywords hoydk</p><p>&nbsp;LEFT JOIN smartis_stat.hand_operations ho ON hoydk.hand_operation_id = <a href="http://ho.id">ho.id</a></p><p>WHERE</p><p>&nbsp;ho.date = @date</p><p>&nbsp;AND IF (@client_id &gt; 0, ho.client_id = @client_id, TRUE)</p><p>&nbsp;AND IF (@integration_id &gt; 0, ho.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND ho.service_id = 1</p><p>&nbsp;AND ho.entity = 'keywords'</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;ydip.*</p><p>FROM smartis_stat.YDirect_insights_plan ydip</p><p>WHERE</p><p>&nbsp;ydip.date_to = @date</p><p>&nbsp;AND IF (@login_id &gt; 0, ydip.login_id = @login_id, TRUE)</p><p>&nbsp;AND IF (@integration_id &gt; 0, ydip.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND IF (@client_id &gt; 0, ydip.client_id = @client_id, TRUE)</p><p>&nbsp;ORDER BY ydip.updated_at DESC</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;ydikp.*</p><p>FROM smartis_stat.YDirect_insights_keywords_plan ydikp</p><p>WHERE</p><p>&nbsp;ydikp.date_to = @date</p><p>&nbsp;AND IF (@login_id &gt; 0, ydikp.login_id = @login_id, TRUE)</p><p>&nbsp;AND IF (@integration_id &gt; 0, ydikp.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND IF (@client_id &gt; 0, ydikp.client_id = @client_id, TRUE)</p><p>&nbsp;ORDER BY ydikp.updated_at DESC</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;i.*</p><p>FROM smartis_stat.integrations i</p><p>WHERE</p><p>&nbsp;IF (@integration_id &gt; 0, <a href="http://i.id">i.id</a> = @integration_id, FALSE)</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;il.*</p><p>FROM smartis_stat.YDirect_integrations_logins il</p><p>WHERE</p><p>&nbsp;IF (@integration_id &gt; 0, il.integration_id = @integration_id, FALSE)</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;l.*</p><p>FROM smartis_stat.YDirect_Logins l</p><p>LEFT JOIN smartis_stat.YDirect_integrations_logins il ON <a href="http://l.id">l.id</a> = il.login_id</p><p>WHERE</p><p>&nbsp;IF (@integration_id &gt; 0, il.integration_id = @integration_id, FALSE)</p><p>;</p></td></tr></tbody></table><p><br /></p><h2>ЮСИ 2178 текущий день</h2><p>Проверка достоверности ЮСИ в текущий день. Явным прецедентом является, если более 2 часов вы видите какую-то цифру в поле in_api и 0 в поле in_db по конкретной интеграции. Ну или вообще все по нулям по всем интеграциям.</p><table class="wrapped"><tbody><tr class="xtr-0"><td class="xtd-0-0"><p>SET @date = DATE(NOW());</p><p>SET @client_id = 2178;</p><p>SET @integration_id = 0;</p><p><br /></p><p>SELECT</p><p>&nbsp;ai.updated_at, ai.*</p><p>FROM smartis_stat.accuracy_itogs ai</p><p>WHERE</p><p>&nbsp;ai.date = @date</p><p>&nbsp;AND ai.client_id = @client_id</p><p>&nbsp;AND ai.service_id = 1</p><p>&nbsp;ORDER BY ai.percent</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;ydip.updated_at, ydip.status, ydip.integration_id, ydip.*</p><p>FROM smartis_stat.YDirect_insights_plan ydip</p><p>WHERE</p><p>&nbsp;ydip.date_to = @date</p><p>&nbsp;AND IF (@integration_id &gt; 0, ydip.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND ydip.client_id = @client_id</p><p>&nbsp;ORDER BY ydip.updated_at</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;ydikp.updated_at, ydikp.status, ydikp.integration_id, ydikp.*</p><p>FROM smartis_stat.YDirect_insights_keywords_plan ydikp</p><p>WHERE</p><p>&nbsp;ydikp.date_to = @date</p><p>&nbsp;AND IF (@integration_id &gt; 0, ydikp.integration_id = @integration_id, TRUE)</p><p>&nbsp;AND ydikp.client_id = @client_id</p><p>&nbsp;ORDER BY ydikp.updated_at</p><p>;</p><p><br /></p><p>SELECT</p><p>&nbsp;sl.created_at, sl.errors, sl.*</p><p>FROM synchronizations.synchronization_logs sl</p><p>WHERE</p><p>&nbsp;sl.sync_id = 504</p><p>&nbsp;AND sl.created_at &gt;= @date</p><p>&nbsp;ORDER BY sl.created_at DESC</p><p>;</p></td></tr></tbody></table><p><br /></p><h2>Достоверность за последние 90 дней</h2><p>Важно, чтобы процент записей с низкой достоверностью был минимальным (не более 1%). По хорошему, должен быть 0, но поскольку ЯД может изменить данные задним числом, может быть отклонение от 0.</p><table class="wrapped"><colgroup><col /></colgroup><tbody><tr class="xtr-0"><td class="xtd-0-0"><p>SELECT cnt.count_all, cnt.count_low, 100/cnt.count_all*cnt.count_low AS perc</p><p>FROM</p><p>(</p><p>SELECT</p><p>COUNT(<a href="http://ai.id">ai.id</a>) AS count_low, ai_all.count_all AS count_all</p><p>FROM smartis_stat.accuracy_itogs ai,</p><p>(</p><p>&nbsp; SELECT COUNT(id) AS count_all</p><p>&nbsp; FROM smartis_stat.accuracy_itogs</p><p>&nbsp; WHERE</p><p>&nbsp; date &gt;= DATE_SUB(CURDATE(), INTERVAL 90 DAY)</p><p>&nbsp; AND date &lt; CURDATE()</p><p>&nbsp; AND service_id = 1</p><p>&nbsp; AND entity IN ('Расходы', 'Ключевые слова')</p><p>) AS ai_all</p><p>WHERE</p><p>&nbsp;ai.date &gt;= DATE_SUB(CURDATE(), INTERVAL 90 DAY)</p><p>&nbsp;AND ai.date &lt; CURDATE()</p><p>&nbsp;AND ai.service_id = 1</p><p>&nbsp;AND (ai.percent &lt; 99.85 OR ai.percent IS NULL)</p><p>&nbsp;AND ai.entity IN ('Расходы', 'Ключевые слова')</p><p>) AS cnt;</p></td></tr></tbody></table><h2>Ошибки синхрона</h2><p>Вывод ошибок указанного синхрона за указанное количество дней</p><table class="wrapped"><colgroup><col /></colgroup><tbody><tr class="xtr-0"><td class="xtd-0-0"><p>SET @days_before = 7;</p><p>SET @sync_id = 27;</p><p><br /></p><p>SELECT</p><p>&nbsp; &nbsp; created_at AS time,</p><p>&nbsp; &nbsp; se.title,</p><p>&nbsp; &nbsp; se.error_text,</p><p>&nbsp; &nbsp; <a href="http://sl.id">sl.id</a></p><p>FROM synchronizations.synchronization_logs sl</p><p>LEFT JOIN synchronizations.synchronization_errors se ON se.sync_session = <a href="http://sl.id">sl.id</a></p><p>WHERE</p><p>sl.created_at &gt; DATE_SUB(DATE(NOW()), INTERVAL @days_before DAY) &nbsp;</p><p>AND sl.sync_id = @sync_id</p><p>AND IFNULL(sl.message, '') NOT LIKE 'Ручной запуск%'</p><p>ORDER BY sl.created_at DESC</p><p>;</p></td></tr></tbody></table><h1>Ошибки в таблицах</h1><p>Детальные сведения можно также получить непосредственно из таблиц (см. выше раздел Запросы).</p><p><br /></p><h2>smartis_stat.hand_operations</h2><h3>Не смогли найти логины Яндекс Директ для интеграции &hellip;</h3><p>Смотрим в интерфейсе мониторинга системы проблемную интеграцию, определяем проблемный логин и обращаемся к менеджеру для отключения интеграции/логина</p><p><ac:image ac:height="250"><ri:attachment ri:filename="й34н56о.png" /></ac:image></p><p>Если это интеграция агентства (у которой много логинов), то скорее всего отключение логина возможно только разработчиком через правку таблиц. Например, разорвав связь (удалив запись) в таблице smartis_stat.YDirect_integrations_logins.</p><h3>Ошибка получения данных (см. связанную запись таблицы планов)</h3><p>Смотрим в таблице ручных операций smartis_stat.hand_operations идентификаторы клиента, интеграции и дату. Смотрим в интерфейсе мониторинга системы проблемную интеграцию за эту дату (см. иллюстрацию выше). Принимаем решение исходя из информации об ошибке. Если информации недостаточно &ndash; смотрим информацию об ошибке в связанных таблицах планов или логах системы. См также раздел Запросы данного документа.</p><p>Бывает, что повторный запуск ручной операции проходит нормально, тогда последующая запись в таблице ручных операций не будет содержать ошибки. Также, в связанной записи таблицы планов ошибка будет удалена. Т.е., если вы видите ошибку в таблице ручных операций, но не видите ее в связанной таблице планов, то это значит, что есть более поздняя ручная операция, которая завершилась удачно.</p><h3>Иные ошибки</h3><p>Разбираемся, опираясь на информацию в интерфейсе системы (см. выше), записи об ошибках в таблицах ручных операций smartis_stat.hand_operations, планов smartis_stat.YDirect_insights_plan, smartis_stat.YDirect_insights_keywords_plan и smartis_stat.accuracy_plan и логи системы.</p><h1>Облако</h1><h2>Вопросы клиентов</h2><p>Достоверность &ndash; см выше про мониторинг. Скорее всего что-то отстало. Надо пнуть руками.</p><p>ЮСИ &ndash; данные по расходам должны обновляться каждые 2 часа есть свой синхрон. Если что надо пнуть руками. Но в последнее время все стабильно.</p><p>Переименование кампаний и объявлений &ndash; соответствующие исправления уже на dev. Раз в сутки все обновляется. Если что не так &ndash; необходимо запустить соответствующе синхроны руками в режиме --static.</p><h2>Решение проблем</h2><p>Переключаемся на пользователя и открываем Мониторинг. Раскрываем интеграции.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="Без заголовка.png" /></ac:image></p><p>Кликаем на красную дату.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="Без заголовка.png" /></ac:image></p><p>Смотрим Историю запросов данных (доступна суперадминам и xrm). Как правило здесь более информативное сообщение об ошибке. Если оно общее, значит проблема в приложении. Надо смотреть логи и запись в базе планов поле error.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="цкфуеык.png" /></ac:image></p><h3>Задержки обновления данных в КХ</h3><p>Редко, но бывает. Особенно, для агентств, у которых куча логинов и достоверность считается по всем. Низкая достоверность, но никаких видимых ошибок нет, в том числе в таблицах планов. Т.е. данные получены полностью, но поле У нас в интерфейсе очень мало или равно 0.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="цуерс.png" /></ac:image></p><p>Поскольку достоверность пересчитывается, в том числе, сразу после забора данных, возможна ситуация, при которой данные получены, но еще не размещены в таблице КХ, а находятся в ожидающей мутации. И в этот момент они запрашиваются расчетом достоверности. Тогда КХ ничего не вернет (или вернет не все) и достоверность будет плохая до следующего пересчета. Можно пересчитать достоверность без перезабора данных руками (зеленая кнопка Достоверность).</p><h1>Коробки</h1><h2>Проблема обновлений</h2><p>В коробки очень долго едут обновления. Зачастую, в коробке что-то не работает просто потому, что она старая. Смотрите чат обновлений, чтобы понять, какие реально фиксы и фичи есть в коробке.</p><p><ac:image ac:height="250"><ri:attachment ri:filename="3е45цнеуг.png" /></ac:image></p><h2>Основные проблемы в коробках:</h2><p>Если все плохо (все красное и ручной перезабор не помогает) &ndash; Скорее всего не включены ключевые синхроны (см. выше) или неверно указан интервал запуска.</p><p>Если ошибки КХ &ndash; значит в коробке не обновлена версия КХ. Это к Игорю.</p><p>Если какие-то дни покраснели и никак не хотят зеленеть &ndash; скорее всего до коробки не доехал актуальный код. Надо пнуть руками создание планов, получение данных и пересчет достоверности. Цимус в том, что в коробках синхроны работают ночью и планы скорее всего выполнятся ночью (если не доехал актуальный код &ndash; там при выполнении команд в режиме --static такой проблемы нет &ndash; все запускается немедленно).</p><p><br /></p>