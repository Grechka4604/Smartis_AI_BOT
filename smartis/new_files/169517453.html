<p>Вне зависимости от того в каком часовом поясе находится клиент - интегрируемые сервисы могут находиться в разных часовых поясах.</p><p>В случае российских сервисов это обычно: Москва (+3), Гринвич (+0, еще называют это &quot;UTC&quot; и &quot;London&quot;). Но могут быть и другие специально настроенные в личном кабинете внешнего сервиса</p><p>В случае, если сам клиент находится в другом часовом поясе - то вероятность, что его данные к нам будут прилетать в каких-то других часовых поясах к которым мы по умолчанию не готовы - велика. То есть, например, если клиент находится в часовом поясе отличающимся от МСК на +1 час, то его данные будут смещаться на +1 час и отображаться также во времени клиента (то есть например не на 13.00 по МСК, а на 14.00 по МСК).</p><p><br /></p><p>Если данные разных сервисов будут приходить к нам в разных часовых поясах:</p><ul><li>При анализе по источникам сделки могут не увидеть своих касаний которые сместились позже времени создания сделки</li><li>Не сойдутся данные при сверке по дням (крайние часы будут переходить в соседние дни, например сделка в 22 часа по UTC, в москве перетечет уже в следующий день на 1 час ночи)</li><li>В CJM события будут смещены не на то время, когда они действительно были</li><li>Наши дополнительные функции работающие на стыке сервисов (Верификация, поиск parent_request_id и тд) - будут работать с ошибками</li></ul><h3><span style="letter-spacing: 0.0px;">Как синхронизировать работу, если клиент в другом часовом поясе</span></h3><ol><li><span style="color: rgb(0,0,0);letter-spacing: 0.0px;">Узнаем часовой пояс отдела маркетинга клиента, так как у одного ЛК в смартис можно установить только 1 часовой пояс.</span></li><li>Настраиваем часовой пояс отдела маркетинга клиента в шаблонной задаче - указываем, что клиент ТАКОЙ-ТО аккаунт ТАКОЙ-ТО живет в +3. (указывать часовой пояс по международному стандарту, можно как альтернативу говорить Москва +3 и тд.).&nbsp;<a href="https://app.asana.com/0/1206876306252490/1206877364947853/f">https://app.asana.com/0/1206876306252490/1206877364947853/f</a>&nbsp;- Шаблонная задача</li><li>Далее начинается работа с каждым конкретным источником данных. Самая правильная методика-анализировать CJM, открывать какую-то конкретную клиентскую историю и сравнивать это с фактическими событиями на стороне клиента. Это могут быть либо ЛК сервисов обращений, либо СРМ. На отличиях этого источника и&nbsp; CJM можно ставить задачи. Например: кастомная СРМ отличается от нашей CJM на 2 часа (отстает), соответственно ставится задача - сдвинуть на 2 часа.&nbsp;</li><li>После выполнения задачи по смещению времени в конкретном сервисе в конкретном клиенте нужна пере синхронизация данных.</li><li>Если смещение нужно для нескольких сервисов, то порядок, в котором будет выполняться обновление данных - не важен.&nbsp;</li></ol><p><br /></p><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="c63ba96f-1fa8-4e0f-91c8-b8afc4ce8bcd"><ac:rich-text-body>Очень важно для понимания - часовой пояс отображается для ЛК браузера в котором он находится. Например: если открыть CJM находясь в Москве - то будут одни даты и время, если открыть эту же CJM в тот же момент где-нибудь на Камчатке - произойдет смещение во времени. Очень важно сверять данные о часовом поясе с теми данными о часовом поясе, в котором настроен ЛК. Можно делать по-разному: как правило нужно временно переключать свой часовой пояс на часовой пояс маркетолога. Это делается в настройках в браузера.</ac:rich-text-body></ac:structured-macro><h1 class="TypographyPresentation TypographyPresentation--colorDefault TypographyPresentation--h5 TypographyPresentation--fontWeightMedium RichText3-header2--withVSpacingNormal RichText3-header2"><strong>Работа с часовыми поясами в разных сервисах</strong></h1><h2><strong>комэджик</strong> (<em>CoMagic</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 4</p><p><strong>title</strong> = 'CoMagic'</p><p><strong>service_class</strong> = '\App\Classes\CoMagic\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Автоматическое получение и использование часового пояса клиента внесено <strong>прямо в коде приложения</strong>, подобной настройки в пользовательских настройках интеграции нет.</p><p>Мы получаем часовой пояс в формате <strong>Europe/Moscow</strong>, <strong>Europe/Saratov</strong> и т.д. из настроек аккаунта которые приходят к нам по <strong>API</strong> запросу и <strong>конвертируем</strong> дату и время в часовой пояс <strong>Europe/Moscow.</strong></p><p>Связанные методы:</p><p>Используется в <strong>Звонках</strong>, <strong>Чатах</strong> и <strong>Заявках</strong>:</p><p><code>\App\Classes\CoMagic\Synchronizers\SynchronBase::applyAccountTimezone</code></p><p>Используется в достоверности:</p><p><code>\App\Classes\CoMagic\Api::getAccountInfoObject</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Знаем по данным настройки аккаунта, конвертируем часовой пояс клиента в часовой пояс <strong>Europe/Moscow</strong>.</p><h2><strong>колтач</strong> (<em>CallTouch</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 14</p><p><strong>title</strong> = 'CallTouch'</p><p><strong>service_class</strong> = '\App\Classes\CallTouch\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по сущности (<strong>Звонки</strong>, <strong>Заявки</strong>, <strong>Теги</strong>) и записываем <strong>как есть</strong>, как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграции так же нет.</p><p>Связанные методы:</p><p>Используется в <strong>Звонках</strong>, <strong>тегах Звонков</strong>, <strong>Заявках</strong>, т<strong>егах Заявок</strong>:</p><p><code>\App\Classes\CallTouch\Synchronizers\SynchronBase::getUnixFromCalltouchDate</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><h2><strong>коллибри</strong> (<em>Callibri</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 16</p><p><strong>title</strong> = 'Callibri'</p><p><strong>service_class</strong> = '\App\Classes\Callibri\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по сущности (<strong>Звонки</strong>, <strong>Чаты</strong>, <strong>Заявки</strong>) и записываем <strong>как есть</strong>, как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграции так же нет.</p><p>Связанные методы:</p><p>Используется в <strong>Звонках</strong>, <strong>Чатах</strong>, <strong>Заявках</strong>:</p><p><code>\App\Classes\Callibri\Synchronizers\CallibriTrait::getDate</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><h2><strong>ройстат</strong> (<em>Roistat</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 38</p><p><strong>title</strong> = 'Roistat'</p><p><strong>service_class</strong> = '\App\Classes\Roistat\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по сущности (<strong>Звонки</strong>, <strong>Заявки</strong>) и записываем <strong>как есть</strong>, как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграции так же нет.</p><p>Связанные методы:</p><p><code>\App\Classes\Roistat\Synchronizers\Call::getDate</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><h2><strong>аллока</strong> (<em>Alloka</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 20</p><p><strong>title</strong> = 'Alloka'</p><p><strong>service_class</strong> = '\App\Classes\Alloka\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по сущности (<strong>Звонки</strong>, <strong>Объекты</strong>) и записываем <strong>как есть</strong>, как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.</p><p>При получении звонков есть закомментированная\неактивная логика приведения даты и времени звонка к часовому поясу <strong>Europe/Moscow</strong>, ниже приведен комментарий почему данная логика не активна.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграции так же нет.</p><p>Связанные методы:</p><p><code>\App\Classes\Alloka\Synchronizers\Objects::save</code></p><p><code>\App\Classes\Alloka\Synchronizers\Calls::save</code></p><p>Комментарий:</p><p><em>По-хорошему надо приводить к Москве - но тогда перестает сходиться с кабинетом аллоки</em></p><p><em>пока решили пренебречь тем что почасовое распределение неадекватно, важнее сойтись с аллокой потому что клиент живет с верой что там правильно</em></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><h2><strong>амо срм</strong> (<em>AmoCRM</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 9</p><p><strong>title</strong> = 'AmoCRM'</p><p><strong>service_class</strong> = '\App\Classes\AmoCRM\CoreOAuth'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Автоматическое получение и использование часового пояса клиента внесено <strong>прямо в коде приложения</strong>, подобной настройки в пользовательских настройках интеграции нет.</p><p>Мы получаем смещение часового пояса вида <strong>+04:00</strong> по сущностям <strong>Сделки</strong> и <strong>Задачи</strong> из <strong>настроек аккаунта</strong> которые приходят к нам по <strong>API</strong> запросу и конвертируем смещение часового пояса в <strong>часовой пояс по Москве</strong>.</p><p>Для клиента <strong>1982</strong> (<em><a href="http://strana.com">strana.com</a></em>) сделано исключение для <strong>Сделок</strong> и смещение часового пояса <strong>для него не рассчитывается</strong>.</p><p>Связанные методы:</p><p><code>\App\Classes\AmoCRM\Synchronizers\V2\LeadsSync::getDateTimeFieldValue</code></p><p><code>\App\Classes\AmoCRM\Synchronizers\V2\LeadsSync::getTimezoneShift</code></p><p><code>\App\Classes\AmoCRM\Synchronizers\V2\TasksSync::getDateTimeFieldValue</code></p><p><code>\App\Classes\AmoCRM\Synchronizers\V2\TasksSync::getTimezoneShift</code></p><p><code>\App\Classes\AmoCRM\AccuracyOAuth::getTimezoneShift</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Знаем по <strong>данным настройки аккаунта</strong>, конвертируем смещение часового пояса клиента в <strong>часовой пояс по Москве</strong>.</p><h2><strong>битрикс 24</strong> (<em>Битрикс24</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 19</p><p><strong>title</strong> = 'Битрикс24'</p><p><strong>service_class</strong> = '\App\Classes\Bitrix24CRM\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по сущности (<strong>Лиды</strong>, <strong>Сделки</strong>, <strong>Контакты</strong>, <strong>Кампании</strong>) и записываем <strong>как есть</strong>, как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграции так же нет.</p><p>Существует нюанс для расчета достоверности, запрос от нас идет по дате и времени в <strong>Московском часовом поясе UTC+3</strong>, но данные у клиента могут храниться в другом часовом поясе, смещение не учитывается. Поэтому нужный элемент для расчета достоверности может находиться в предыдущем или следующем дне по данным клиента:</p><p><code>\App\Classes\Bitrix24CRM\Accuracy::calculatePercentForElementType</code></p><p>Для клиента <strong>2115</strong> (<em>providentestate.com</em>) существует кастом который позволяет учитывать смещение часового пояса при контроле удаленных сущностей, для <strong>Лидов</strong> и <strong>Сделок</strong>:</p><p><code>\App\Classes\Bitrix24CRM\Synchronizers\LeadsSync::afterSaveWithAllData</code></p><p><code>\App\Classes\Bitrix24CRM\Synchronizers\DealsSync::afterSaveWithAllData</code></p><p>Связанные методы:</p><p><code>\App\Classes\Bitrix24CRM\Synchronizers\SynchronBase::createPeriodFilterArray</code></p><p><code>\App\Classes\Bitrix24CRM\Synchronizers\LeadsSync::save</code> (<em>сохранение CRM элемента с датой как есть</em>)</p><p><code>'created_at' =&gt; (new Carbon($item['DATE_CREATE']))-&gt;timestamp</code></p><p><code>\App\Classes\Bitrix24CRM\Synchronizers\DealsSync::getResponsibleDealManager</code> (<em>сохранение CRM элемента с датой как есть</em>)</p><p><code>'created_at' =&gt; (new Carbon($item['DATE_CREATE']))-&gt;timestamp</code></p><p><code>\App\Classes\Bitrix24CRM\Synchronizers\ContactsSync::save</code></p><p><code>'bx_date_create' =&gt; isset($item['DATE_CREATE']) ? strtotime($item['DATE_CREATE']) : null</code></p><p><code>\App\Classes\Bitrix24CRM\Synchronizers\CompaniesSync::save</code></p><p><code>'DATE_CREATE' =&gt; isset($item['DATE_CREATE']) ? strtotime($item['DATE_CREATE']) : null</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><h2><strong>дайнемикс</strong> (<em>Microsoft Dynamics CRM</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 33</p><p><strong>title</strong> = 'Microsoft Dynamics CRM'</p><p><strong>service_class</strong> = '\App\Classes\MDynamicsCRM\Core'</p><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 43</p><p><strong>title</strong> = 'Nikfort API for MS Dynamics'</p><p><strong>service_class</strong> = '\App\Classes\Nikfort\Core'</p><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 82</p><p><strong>title</strong> = 'Microsoft Dynamics CRM от Tisa'</p><p><strong>service_class</strong> = '\App\Classes\MDynamicsTisa\Core'</p><p>-----</p><p>Сервис <strong>Microsoft Dynamics CRM</strong> (<em>33</em>)</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по всем сущностям и записываем <strong>как есть</strong>, как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграций так же нет.</p><p>Связанные методы:</p><p><code>\App\Classes\MDynamicsCRM\Synchronizers\SynchronBase::getTimestampFromDate</code></p><p>Существует отдельная логика для клиента <strong>1156</strong> (<em>Отрада</em>) по сервису <strong>Microsoft Dynamics CRM</strong> (<em>33</em>):</p><p>По всем сущностям происходит обработка даты сущности и перевод ее в <strong>часовой пояс по Москве</strong>, к дате сущности прибавляется <strong>+3</strong> часа.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграции <strong>mig.corp.local\Smartis</strong> (<em>5163</em>) данного клиента так же нет.</p><p>Связанные методы:</p><p><code>\App\Classes\MDynamicsCRM\Synchronizers\Mssql\SynchronBase::gmtToMskTimeZone</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><p>-----</p><p>Сервис <strong>Microsoft Dynamics CRM от Tisa</strong> (<em>82</em>)</p><p>На данный момент этот сервис функционирует для двух клиентов:</p><p><strong>Амград</strong> (<em>2209</em>) интеграция <strong>smatris</strong> (<em>9023</em>)</p><p><strong>vatutinki.ru</strong> (<em>2077</em>) интеграция <strong>smatrisMDTisa</strong> (<em>10577</em>)</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по всем сущностям и <strong>конвертируем дату каждой сущности в часовой пояс</strong> установленный в<strong> скрытой из интерфейса настройке интеграции</strong>.</p><p>Существует <strong>скрытая настройка интеграции</strong> для установки <strong>часового пояса</strong> для конвертации даты создания сущности в установленный <strong>в данной настройке часовой пояс</strong> (<em><strong><a href="http://smartis_stat.services_settings.id">smartis_stat.services_settings.id</a></strong> = 307, <strong>html_type</strong> = 'hidden'</em>). Данная настройка <strong>не отображается в пользовательском интерфейсе</strong> в модальном окне настроек интеграции.</p><p>Связанные методы:</p><p><em>//Если в настройках есть таймзона проставляем её</em></p><p><code>\App\Classes\MDynamicsTisa\Synchronizers\SynchronBase::save</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем в скрытой из интерфейса настройке интеграции (<em><strong><a href="http://smartis_stat.services_settings.id">smartis_stat.services_settings.id</a></strong> = 307</em>).</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Знаем на основании выставленной вручную скрытой настройки интеграции (<em><strong><a href="http://smartis_stat.services_settings.id">smartis_stat.services_settings.id</a></strong> = 307</em>). Из <strong>API</strong> не получаем данные о часовом поясе.</p><p>-----</p><p>Сервис <strong>Nikfort API for MS Dynamics</strong> (<em>43</em>)</p><p>На данный момент данный сервис действует для одного клиента <strong>MR GROUP</strong> (<em>5</em>) интеграция <strong><a href="https://crmdataapi.mr-group.ru:8833/api/v1">https://crmdataapi.mr-group.ru:8833/api/v1</a></strong> (<em>5870</em>).</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>По всем сущностям происходит <strong>обработка всех дат которые есть в сущности</strong> и <strong>перевод этих дат в часовой пояс по Москве</strong>, ко всем датам <strong>которые содержатся в сущности прибавляется +3 часа</strong>. Данная логика установлена <strong>прямо в коде</strong>, в интерфейсе настройки интеграции настройки часового пояса нет. На данный момент автоматически не забираем настройку часового пояса из сервиса.</p><p>Связанные методы:</p><p><code>\App\Classes\Nikfort\Synchronizers\V2\SynchronBase::getUnixAtMoscowTimezone</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, по умолчанию прибавляем ко всем пришедшим датам <strong>+3</strong> часа.</p><h2><strong>1с</strong> (<em>1C CRM</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 32</p><p><strong>title</strong> = '1C CRM'</p><p><strong>service_class</strong> = '\App\Classes\OneC\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по всем сущностям и записываем <strong>как есть,</strong> как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграций так же нет.</p><p>Связанные методы:</p><p><code>\App\Classes\OneC\Synchronizers\SynchronBase::save</code></p><p><code>\App\Classes\OneC\Synchronizers\SynchronBase::getUnixtimeDate</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><h2><strong>макро срм</strong> (<em>MacroCRM</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 83</p><p><strong>title</strong> = 'MacroCRM'</p><p><strong>service_class</strong> = '\App\Classes\Macro\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по всем сущностям и записываем <strong>как есть</strong>, как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.</p><p>На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграций так же нет.</p><p>Связанные методы:</p><p>В основном используется функция <code>\strtotime</code></p><p><code>\App\Classes\Macro\Synchronizers\SynchronBase::getFormatedDateValue</code></p><p><code>Carbon::createFromTimestamp((int)$item['date_modified'])-&gt;toDateTimeString()</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><h2><strong>как работать с часовыми поясами если интеграция с срм через срм эндпойнт?</strong> (<em>CRM Endpoint</em>)</h2><p><strong>smartis_stat.services</strong></p><p><strong>id</strong> = 91</p><p><strong>title</strong> = 'CRM Endpoint'</p><p><strong>service_class</strong> = '\App\Classes\CrmEndpoint\Core'</p><p>Существует <strong>2</strong> способа получения данных по сервису <strong>CRM Endpoint</strong>:</p><p><strong>Подключение к БД</strong> (<em>прямой запрос к <strong>БД</strong></em>)</p><p><strong>HTTP Guzzle Client</strong> (<em>запросы к <strong>API</strong></em>)</p><p>-----</p><p><strong>Подключение к БД </strong>(<em>CRM Endpoint</em>)</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>На данный момент мы <strong>не получаем текущий часовой пояс клиента</strong> при типе соединения <strong>Подключение к БД</strong> из интеграции сервиса <strong>CRM Endpoint</strong> по какой либо сущности.</p><p>Есть вариант <strong>модификации запроса</strong> по сущности к <strong>БД</strong> клиента чтобы привести получаемые <strong>поля сущности к часовому поясу который нам нужен</strong>, это некоторое подобие настройки часового пояса на нашей на нашей стороне.</p><p>Пример строк модификации получаемых полей сущности для приведения к <strong>Московскому часовому поясу</strong> (<em><strong>+3</strong> часа, клиент <strong>ПИК</strong></em>):</p><p><code>SELECT</code></p><p><code>dateadd(HOUR, 3, l.CreatedOn) AS CreatedOn, # <strong>Дата создания +3 часа</strong></code></p><p><code>dateadd(HOUR, 3, l.ModifiedOn) AS ModifiedOn, # <strong>Дата изменения +3 часа</strong></code></p><p><code>FROM Leads AS l</code></p><p><code>WHERE ...</code></p><p><code>;</code></p><p>Для расчета достоверности в интеграции <strong>CRM Endpoint </strong>существует настройка <strong>Часовой пояс</strong>, где <strong>указывается часовой пояс в котором содержаться данные клиента</strong> о сущности по которой мы получаем данные. При запросе к <strong>БД</strong> данный часовой пояс подставляется в параметр даты запроса и мы можем обновить достоверность по сущности именно на дату в часовом поясе клиента.</p><p>Связанные методы:</p><p><code>\App\Classes\CrmEndpoint\Services\TableDataService::run</code></p><p><code>\App\Classes\CrmEndpoint\Services\DataRetrievers\DatabaseDataRetriever::retrieveData</code></p><p><code>\App\Classes\CrmEndpoint\Accuracy::getIntegrationTimeZone</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Есть <strong>вариант модификации запроса</strong> по сущности к <strong>БД</strong> клиента чтобы привести получаемые поля сущности к часовому поясу который нам нужен, это некоторое подобие настройки часового пояса на нашей на нашей стороне.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам из <strong>БД</strong> клиента. Часовой пояс указывается вручную в настройке <strong>Часовой пояс</strong> в интеграции.</p><p>-----</p><p><strong>HTTP Guzzle Client</strong> (<em>CRM Endpoint</em>)</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>На данный момент мы <strong>не получаем текущий часовой пояс</strong> при типе соединения <strong>HTTP Guzzle Client</strong> из интеграции сервиса <strong>CRM Endpoint</strong> по какой либо сущности.</p><p>Для получения данных или расчета достоверности при типе соединения <strong>HTTP Guzzle Client</strong> в интеграции <strong>CRM Endpoint</strong> существует настройка <strong>Часовой пояс</strong>, где указывается часовой пояс в котором содержаться данные клиента о сущности по которой мы получаем данные. При запросе к <strong>API</strong> данный часовой пояс подставляется в параметр даты запроса и мы можем получить данные или обновить достоверность по сущности именно на дату в часовом поясе клиента.</p><p>Связанные методы:</p><p><code>\App\Classes\CrmEndpoint\Services\DataRetrievers\GuzzleDataRetriever::retrieveData</code></p><p><code>\App\Classes\CrmEndpoint\Accuracy::getIntegrationTimeZone</code></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам из <strong>API</strong>. Часовой пояс указывается вручную в настройке <strong>Часовой пояс</strong> в интеграции.</p><p><br /></p>