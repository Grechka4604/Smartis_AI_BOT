<p><br /></p><p><strong>Версия от 10.2021, для внутреннего использования!</strong></p><p><br /></p><p>Алгоритм создания персон - это основа нашей сквозной аналитики.<strong>&nbsp;</strong>Мы не просто собираем данные со всех систем, а анализируем их и собираем единую персону, благодаря которой можем анализировать рекламу по источникам в разной модели атрибуции.&nbsp;<br />Анализ данных персон выполняется регулярно. Персоны за вчерашний день всегда должны быть проанализированы.</p><p>К каждой персоне присваивается свой уникальный id.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_15-23-51.png" /></ac:image></span></p><p>При раскрытии любого элемента открывается CJM (путь клиента) в данной персоне&nbsp;</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_15-27-32.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper"><ac:image><ri:attachment ri:filename="image2023-11-27_15-27-54.png" /></ac:image></span></p><p><br /></p><p>В CJM собираются все касания клиента со всех сервисов (маркетинговые сервисы и crm) по нашему алгоритму.&nbsp;</p><p>Как работает модель атрибуции на персонах можно&nbsp;<a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171322207" rel="nofollow">почитать тут.</a></p><h2>Подробно, как работает Алгоритм создания персон&nbsp;</h2><h3>Сырье/входные данные для алгоритма</h3><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-49-19.png" /></ac:image></span></p><h3>Параметры склейки</h3><p>&laquo;Hard ID&raquo;<br />В случае пересечения персон по этим параметрам - они объединяются в<br />одну<br />&bull; phone_a &ndash; мобильные, валидные номера клиентов<br />&bull; smartis_client_id (pid) &ndash; кроссдоменная кука пользователя Smartis</p><p>&laquo;Temp ID&raquo;<br />Через пересечения по ним рассматриваются параметры &laquo;Hard ID&raquo; для склейки<br />&bull; google client id</p><h3><br />Подготовка справочников валидности параметров</h3><p>Каждую ночь автоматически выполняется запрос вида:<br />SELECT param_value, count(*)<br />FROM events<br />GROUP BY param_value<br />Он проверяет какое количество событий/значений hard_id<br />связано с param_value (каждый из параметров hard/temp ID)</p><p>Запрос выполняется ПО ВСЕЙ БАЗЕ ВСЕХ КЛИЕНТОВ</p><p>В случае превышения по количеству настроенных в едином<br />конфиге &laquo;параметров адекватности&raquo; значений -<br />param_value помещается в справочник неадекватных или<br />адекватных параметров</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:thumbnail="true" ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-51-30.png" /></ac:image></span></p><p><br /></p><h3>Схема Алгоритма&nbsp;</h3><p><br /></p><p><span class="confluence-embedded-file-wrapper"><ac:image><ri:attachment ri:filename="image2023-11-27_14-52-8.png" /></ac:image></span></p><h3>Примеры сценариев склейки</h3><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-53-9.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="150"><ri:attachment ri:filename="image2023-11-27_14-53-26.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-53-59.png" /></ac:image></span></p><p><br /></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-54-18.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-54-49.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-55-0.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-55-9.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-55-14.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-55-19.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-55-26.png" /></ac:image></span></p><p><br /></p><h2>Саморегуляция</h2><p>&bull; Синхрон чистки персон с параметрами замеченными в неадекватности<br />каждые 30 мин уничтожаем персон параметры которых замечены в спаме и отправляем все их данные на<br />переанализ<br />&bull; Синхрон чистки персон склеивших неадекватное количество событий<br />Каждую ночь в 3 часа берем всех неадекватных персон - обнуляем их и отправляем на переанализ.<br />Тут есть проблема: без изменения алгоритмов и справочников неадекватных параметров они рано или поздно<br />обратно склеются - но хотя бы не будут мешать клиенту и не повлияют на отчетность<br />&bull; Автопоиск ошибок сброса персон<br />Иногда может возникать deadlock таблиц зависящих от person_id - и person_id может &laquo;подвиснуть&raquo; с<br />неактуальным значением. Каждую ночь в 4 часа автоматически ищутся все такие данные и отправляются на<br />переанализ.</p><p><br /></p><ul><li>&nbsp;UI блокировки служебных телефонов пользователями и менеджерами</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_14-56-36.png" /></ac:image></span></p><ul><li>Тегирование спамом в любых внешних и внутренних сервисах</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-57-13.png" /></ac:image></span></p><p><br /></p><h2>Мониторинг</h2><p>&bull; SQL-запрос &laquo;Покажи всех подозрительных&raquo; по 7 параметрам</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_14-58-3.png" /></ac:image></span></p><ul><li>% проанализированных данных на персоны:</li><li>&bull;в UI клиентам и менеджерам (в модуле достоверности)<br />+ оповещение в Tg при &lt; 90%</li><li>скорости работы синхронов в real-time - оповещение в Tg<br />Определение персон обращений: 272 000 за вчера<br />Проанализировано CRM данных: 211 919 за вчера<br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_15-0-11.png" /></ac:image></span></li></ul><h3>Мониторинг. Адекватность текущей базы Персон</h3><p>Методика 1<br />Кол-во неадекватных персон / Кол-во персон всего<br />2740 / 10 872 769 = 0,025%</p><p><br />Методика 2<br />Кол-во событий связанных с неадекватными персонами / Кол-во событий всего<br />Обращения: 251 784 / 20 767 982 = 1,21%<br />CRM события: 38 515 / 5 826 180 = 0,66%</p><h2>Использование</h2><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_14-59-34.png" /></ac:image></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_15-0-30.png" /></ac:image></span></p><h3>Использование. С точки зрения моделей данных</h3><p>1. Прямое свойство в модели событий (обращений, crm)</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_15-1-54.png" /></ac:image></span></p><p>2. Таблица матчинга больших или быстро меняющихся данных</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_15-5-34.png" /></ac:image></span></p><p><br /></p><h2>Недостатки текущего алгоритма</h2><p>1. Не real-time для новых персон или новых параметров персон<br />2. скорость анализа<br />1. один сервер сможет дать скорость 200-500 тыс/событий в день<br />2. при росте количества данных - скорость будет уменьшаться<br />3. После очистки неадекватных - они без изменения алгоритма могут вернуться<br />4. ~1% неадекватных склеек неизбежен - важно мониторить, улучшать непрерывно<br />5. person_id - ИЗМЕНЧИВ!<br />нельзя зашиваться на то, что у обращения/сделки найденных person_id<br />неизменен на всегда. Поэтому внешние потребители должны обновлять результаты<br />определения person_id по date_update<br />6. Алгоритм Non-explainable - многие склейки &laquo;под капотом&raquo;, которые нельзя показать</p><h2>Планы</h2><p><br /></p><p>1. Собрать требования с продактов СМ<br />2. Изучить таблицы событий (обращений, сессий, сделок) СМ<br />3. Изучить справочники спама СМ<br />4. Прототип сервиса в коде smartis на php работающий уже с данными СМ<br />5. Отладка прототипа по скорости+адекватности<br />6. Формирование &laquo;ТЗ&raquo;/беклога для реализация уже в платформе кодом СМ</p>