<div class="translate-tooltip-mtz translator-hidden"><ul style="list-style-type: square;"><li>Обновление данных с достоверностью ниже 99,9% происходит автоматически по всем сервисам.&nbsp;</li><li><p>Проходим по сервисам, для которых нужно синхронить исторический период. Делаем это только при вечерней синхронизации. Мы забираем кол-во данных за указанный период и сверяем их с нашими итогами. По дням, в которых есть расхождения между нашим значением и кол-вом из АПИ, мы создаём ручную операцию, чтобы автоматика перезабрала данные и пересчитала затем достоверность&nbsp;</p><br />За это отвечает 519 синхрон. Он забирает данные за последние 30 дней + обновляет достоверность. Везде, где достоверность по сущностям ниже 99,9%<br /><br /></li></ul></div><div class="translate-tooltip-mtz translator-hidden"><strong><br /></strong></div><div class="translate-tooltip-mtz translator-hidden"><strong>Как это работает:</strong></div><div class="translate-tooltip-mtz translator-hidden"><ul style="list-style-type: square;"><li>каждый день происходит автоматический запуск синхрона в&nbsp; 7.00 утра и в 19.00 вечером - чтобы к 8.00 по МСК уже прошла 1 или 2 проверки элементов с низкой достоверностью.</li><li class="ProsemirrorEditor-listItem"><p>ищем все элементы по всем сервисам всех клиентов, по которым достоверность ниже 99,9%**&nbsp;<strong>за последние 30 дней по умолчанию&nbsp;</strong>(элемент - звонки, заявки, чаты, сделки, контакты, расходы, ключевые слова и тд). Также проверяем дни, в которых отображется достоверность 0 и при этом вообще нет информации о данных (пусто).&nbsp;По МК данный синхрон проверяет и забирает данные за последние 60 дней.</p></li><li>синхрон повторно обновляет достоверность и данные по элементам, у которых достоверность ниже 99,9% или вообще нет информации о достоверности и делает это 5 раз с момента обнаружения такого случая:<ul style="list-style-type: square;"><li><p>Через час после получения достоверности за предыдущий день&nbsp;</p></li><li><p>Через 12 часов после первого обновления</p></li><li>Через сутки после первого обновления и тд (каждые 12 часов после первого обнаружения проблемы)</li><li>Если после 5 попыток достоверность осталась ниже 99,9%, мы не берем в следующую обработку эти элементы. По таким случаям если интеграция активна (и в ней нет ошибок), РМ нужно создавать тикет в отладку (тк скорее всего есть проблема в логике интеграции и ее нужно чинить системно, обновление данных не помогает)</li></ul></li><li>достоверность может стать выше 99,9% после любого из 5 этапов автоматического обновления. В таком случае, если достоверность исправилась, мы больше не будем брать в обработку эти данные.</li><li>для некоторых сервисов период обновления ретро данных больше 30 дней (например, у ЯД - 90 дней). По таким сервисам проверка ретро-периода выполняется только при вечерней синхронизации: Мы забираем кол-во данных за указанный период и сверяем их с нашими итогами. По дням, в которых есть расхождения между нашим значением и кол-вом из АПИ, мы создаём ручную операцию, чтобы автоматика перезабрала данные и пересчитала затем достоверность. Периоды ретро для разных сервисов описаны ниже.</li><li><p>данный синхрон не обрабатывает интеграции в архиве</p></li></ul><p><em>*Если синхрон достоверности не успел отработать утром, это никак не влияет на автоматические обновления. Так как автоматика работает утром в 7.00 и вечером в 19.00, данные в любом случае обработаются: если они поступили вечером, мы их обработаем первый раз вечером и второй раз утром. Если данные впервые получены утром - то наоборот, утром и потом второй раз вечером и тд. Пересчитанная автоматически первый или второй раз достоверность для клиента все равно будет готова до начала рабочего дня<br /></em></p><p><strong style="letter-spacing: 0.0px;">**99,9% </strong>- тк в результатах достоверности у нас % детализируется до сотых (не 99,9 а 99,90, например), работают правила округления:&nbsp;все значения от 99,85 до 99,99 приравниваются к 99,9. В работу мы берем на автоматическое переобновление 519 синхроном все, что имеет достоверность ниже 99,85. &quot;! знак&quot; ставим, если после 5 попыток обновления значения остались ниже 99,85. Такие примеры, как на скрине, не будут браться в повторную обработку - тк % у нас 99,99%.</p><h3><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-8_9-34-31.png" /></ac:image><br /><br />Периоды ретро, за которые 519 синхрон проверяет достоверность по вечерам по сервисам:</h3><p>Яндекс Директ - 90 дней.</p><p><strong style="letter-spacing: 0.0px;"><br /></strong></p><p><strong style="letter-spacing: 0.0px;"><br /></strong></p><p><strong style="letter-spacing: 0.0px;">Статус работы обновления по элементам с низкой достоверностью можно определить в интерфейсе:</strong></p><p>Чтобы увидеть статус работы автоматики, нужно раскрыть список интеграций по сервисам:</p><p><em>Мы специально не выводим статус в строку с названием сервиса, тк может быть несколько интеграций в разном статусе обновления.</em></p><p><ac:image ac:height="400"><ri:attachment ri:filename="Снимок экрана 2023-11-03 в 09.25.21.png" /></ac:image></p><p><strong><br /></strong></p><ul style="list-style-type: square;"><li><p>Если было произведено <strong>менее 5</strong>&nbsp;обновлений и достоверность ниже 99,9%, показывается<ac:image ac:thumbnail="true" ac:width="30"><ri:attachment ri:filename="66401.png" /></ac:image><br /><em>Это значит, что руками обновлять данные не надо - просто ожидаем, когда пройдет 5 этапов обработки данных</em></p></li><li>Если было произведено 5 этапов обновления и достоверность осталась ниже 99,9%, показывается иконка <ac:image ac:thumbnail="true" ac:width="16"><ri:attachment ri:filename="Bang.svg.png" /></ac:image></li></ul></div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<em>Это значит, что 5 этапов обработки данных завершились и мы автоматически больше не будем обновлять достоверность по этому элементу. Достоверность осталась ниже 99,9% - нужно отлаживать проблему отдельным тикетом в разработку.</em></div><div><ul style="list-style-type: square;"><li>также, если были запущены ручные обновления данных с низкой достоверностью, то каждое завершенное ручное обновление достоверности будет засчитываться в кол-во обработок автоматизаци.&nbsp;<br /><em>Пример: 519 синхрон (автоматика) отработал 3 раза, но менеджер или клиент захотел не дожидаясь 4 и 5 обработки обновить достоверность вручную. В таком случае мы 519 синхроном данные больше не будем обновлять, если по ним&nbsp; после обновления получили 99,9% достоверности, либо обновим только 1 раз (если после ручного обновления достоверность осталась ниже 99,9%), так как ручное обновление засчиталось за 1 автоматическую обработку.</em></li></ul></div><div><em><br /></em></div><div><em>В примере: по МК есть несколько интеграций, у которых прошло 5 попыток обновления и достоверность осталась ниже 99,9%</em></div><div><em><ac:image ac:height="250"><ri:attachment ri:filename="Снимок экрана 2023-11-03 в 09.27.09.png" /></ac:image></em></div><div><em><br /></em></div><div><ul style="list-style-type: square;"><li>Если никакого символа нет, и достоверность &quot;зеленая&quot; - все ок, после 1-5 этапов обновления данных достоверность выше 99,9% (достоверность может исправиться на любом из 5 этапов)</li><li>Если за период до <strong>3.10.2023</strong> есть дни в мониторинге, когда у интеграции отображаются &quot;песочные часы&quot; и достоверности ниже 99,9% - это ок, но ожидать автоматического обновления не нужно: такие кейсы появляются из-за того, что ДО отгрузки функционала автоматики по интеграциям были попытки обновления, но их было менее 5.</li><li>Если по интеграции отображается 0, но знаков &quot;часы&quot; или &quot;!&quot; нет, и при этом у самой интеграции есть ошибка, например такая, как на скриншоте - <strong>это ОК</strong>. Достоверность не была посчитана изначально, поэтому мы автоматически ее не смогли взять в обновление. К таким кейсам может относиться: <strong>Token has expired, ошибка авторизации и другие подобные.</strong><br /><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-3_14-7-52.png" /></ac:image></li></ul></div><div><strong><br /></strong></div><div><strong><br /></strong></div><div><strong><br /><br />Какие ситуации мы не сможем исправить с помощью автоматики:</strong></div><div><ol class="ProsemirrorEditor-list"><li class="ProsemirrorEditor-listItem"><p>дни с пустой достоверностью (по ним не будет символов&nbsp;&quot;часы&quot; или &quot;!&quot; )</p></li><li class="ProsemirrorEditor-listItem"><p>интеграции с ошибкой доступов (по результатам работы автоматики у них не повысится достоверность) -&nbsp;по ним не будет символов&nbsp;&quot;часы&quot; или &quot;!&quot;&nbsp;</p></li><li class="ProsemirrorEditor-listItem"><p>любые случаи отключения/деактивации интеграций, когда достоверность по интеграции не отображается -&nbsp;по ним не будет символов&nbsp;&quot;часы&quot; или &quot;!&quot;&nbsp;</p></li><li class="ProsemirrorEditor-listItem"><p>интеграции с протухшим токеном -&nbsp;по ним не будет символов&nbsp;&quot;часы&quot; или &quot;!&quot;&nbsp;</p></li><li>Частные случаи, которые могут не исправиться автоматически: ошибка у ВК по Расходам <code>One of the parameters specified was missing or invalid: ids is invalid</code><span style="color: rgb(30,31,33);"> при получении сущности &quot;</span><strong>Расходы</strong><span style="color: rgb(30,31,33);">&quot;. При такой ошибке если автоматика не помогла, нужно просто вручную обновить данные (возможно, несколько раз).</span><br />(описано в решенной задаче&nbsp;<a href="https://app.asana.com/0/1204486395777830/1205904956621239/f">https://app.asana.com/0/1204486395777830/1205904956621239/f</a>&nbsp;)</li></ol><p><strong style="letter-spacing: 0.0px;">&nbsp;Справка по функционалу - находится в самом разделе Мониторинг системы и открывается по клику на знак &quot;?&quot; (справа от заголовка раздела)<br /><ac:image ac:height="400"><ri:attachment ri:filename="Снимок экрана 2023-11-15 в 09.47.04.png" /></ac:image></strong></p><p><strong style="letter-spacing: 0.0px;"><br /></strong></p><p><strong style="letter-spacing: 0.0px;"><br /></strong></p><p><strong style="letter-spacing: 0.0px;">Исключения:</strong></p><p><strong>ЮСИ</strong> - Яндекс Директ. У клиента настроена кастомная частота получения данных из Яндекс Директ (каждые 2 часа), также достоверность по ЯД у клиента обновляется каждые 2 часа. Поэтому для такого клиента обновление данных и перерасчет плохой достоверности происходит чаще, чем у других. У ЮСИ могут отображаться знаки &quot;часы&quot; или &quot;!&quot; , однако несмотря на это, обновление будет происходить регулярно, даже если было уже 5 попыток обновить достоверность.</p><p><br /></p><p>Мониторинг функционала в Grafana:&nbsp;<a href="http://grafana.smartis.bi/d/xCTob7VIz/dostovernost-pereschet-itogov?orgId=1&amp;from=now-2d&amp;to=now">http://grafana.smartis.bi/d/xCTob7VIz/dostovernost-pereschet-itogov?orgId=1&amp;from=now-2d&amp;to=now</a></p><p><strong>Как смотреть данные в дашборде Grafana:</strong></p><ol><li><strong>Кол-во кейсов плохой достоверности до и после 519 синхрона:</strong> здесь указываются кол-во элементов с достоверностью ниже 99,9 ДО того как их обновли 519 синхрон и после обновления.</li></ol><p><strong>Важно</strong>, что мы считаем не просто дни плохой достоверности, а именно кейсы. <br /><em>Пример:&nbsp;у клиента по ЯД 4 интеграции и по каждой из них 1 ноября низкая достоверность по Расходам, в этом виджете будет отражено &quot;4&quot; , по кол-ву проблемных элементов.<br /></em></p><p><br /></p><p>2. <strong>% выполнения планов:</strong> в этом виджете отображается информация за сегодняшний день - какой % планов по достоверности был выполнен ДО 7.00 утра (то есть до запуска 519 синхрона). С помощью виджета можно понять, какой объем данных за вчера мы смогли переобновить к началу текущего рабочего дня.</p><p>3. <strong>Контроль 519 синхрона:</strong> показывает время работы, кол-во запусков и наличие ошибок за выбранный период</p><p>4. <strong>Детализация необработанных ситуаций:</strong> показывает из-за каких ошибок в достоверности не получилось обработать повторно элементы с низкой достоверностью</p><p>5. <strong>Детализация ошибок</strong>&nbsp;<strong>необработанных ситуаций:</strong>&nbsp;показывает клиента, сервис и интеграцию + текст ошибки, из-за которых&nbsp;не получилось обработать повторно элементы с низкой достоверностью</p><p>6. <strong>Логи 519 синхрона:</strong> показывает логи обработки 519 синхроном. С помощью этого виджета можно смотреть какие элементы мы вообще не обработали (почему-то)</p></div>