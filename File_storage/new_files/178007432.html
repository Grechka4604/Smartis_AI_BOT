<h3>Аффилированность контактов</h3><p>Аффилированные контакты - связанные контакты, например, муж и жена которые ищут квартиру вместе. Аффилированными могут быть и другие родственники. Суть определения и объединения таких клиентов в том, чтобы корректно определять источник такой сделки, тк в случае связанности контактов нужно учитывать касания с рекламой всех связанных людей.</p><p>В сущности &quot;Заявки&quot; из Макро в поле&nbsp;&quot;linked_contacts&quot; указаны связанные контакты. При анализе таких сущностей в поле Доп номер клиента мы вставляем телефон из данного поля, если тип связи прописан (тип null (то есть если не прописан -&nbsp; не связываем)</p><p><ac:image ac:width="400"><ri:attachment ri:filename="Снимок экрана 2024-07-04 в 16.42.08.png" /></ac:image></p><p>В сущности &quot;Сделки&quot; из Макро&nbsp;все связанные со сделкой контакты с указанием роли передаются в поле roles_set (в смартис поле &quot;Аффилированные контакты&quot;)</p><p><br /></p><h3>Передача по API платежей эскроу из Макро&nbsp;</h3><p><strong>ЭСКРОУ - это информация об оплатах по заключенным договорам</strong></p><p><strong>Кому конкретно из пользователей/коллег мы поможем? (роль в компании):</strong></p><p>Это необходимо SEO и руководителю отдела маркетинга</p><p><strong><br /></strong></p><p><strong>Какая польза будет от того что мы это сделаем?:</strong></p><p>-Клиенту не придется вносить данные руками</p><p>-Данные будут обновляться ежедневно&nbsp;</p><p><strong>Сделали такую доработку:</strong></p><ol class="ProsemirrorEditor-list"><li class="ProsemirrorEditor-listItem"><p>Создание отдельного показателя &quot;<em>Macro: Проведенные платежи по сделкам&quot;</em></p></li><li class="ProsemirrorEditor-listItem"><p>Новый синхрон на получение данных + донасыщать данную сущность из связанной сделки (по deal_id), и сохранять все поля сделки в получаемую сущность.</p></li><li class="ProsemirrorEditor-listItem"><p>Важен порядок синхронизации, синхронизировать после сделок. (лучше сохранять все, что есть, даже если не нашли связку со сделкой)</p></li><li class="ProsemirrorEditor-listItem"><p>Обязательно логировать каждое отсутствие сделки через addError в синхроне</p></li><li class="ProsemirrorEditor-listItem"><p>Добавляем мониторинг сущностей в Grafana в MacroCRM</p></li><li class="ProsemirrorEditor-listItem"><p>Добавляем достоверность</p></li><li class="ProsemirrorEditor-listItem"><p>Просинхронили исторический период с какого периода с 2022 года</p><p><br /></p></li></ol><h3>Кастомная логика группировок&nbsp;<strong>Статус отказа (общий)</strong> и&nbsp;<strong>Статус нецелевого (общий)<br /></strong></h3><p><strong>!!! Данные группировки не следует изменять через Конфигуратор -&nbsp;Управление группировками так как изменения могут исчезнуть.<br /></strong></p><p><strong>Особенность клиента:</strong> заведение новых ЖК в разных кабинетах Макро, поэтому при добавлении нового объекта необходимо подключать дополнительный CRM коннектор для объекта.</p><p>У клиента некоторые отчеты построены по пользовательским группировкам (<em>по полю <strong>CRM</strong></em>).</p><p>Например, отчет по <strong>Статус отказа</strong>&nbsp;или отчет по <strong>Статус нецелевого</strong>.</p><p>Необходимо было объединить две группировки, относящиеся к разным коннекторам в одну - общую. Для этого понадобилась кастомная доработка. Задача -&nbsp;<a href="https://app.asana.com/0/1206876306252490/1208633914982150/f">https://app.asana.com/0/1206876306252490/1208633914982150/f</a></p><p><strong>Для справки:</strong></p><p>-----</p><p>Отчет для проверки:</p><p><a class="ProsemirrorEditor-link" href="https://my.smartis.bi/reports/designer/shared/throughBuilding/Yzl4Q2xhNERNWVVXNHpTTDN4djVjdUJuMTlQcTdUZVE6Ojp0aHJvdWdoQnVpbGRpbmc=">https://my.smartis.bi/reports/designer/shared/throughBuilding/Yzl4Q2xhNERNWVVXNHpTTDN4djVjdUJuMTlQcTdUZVE6Ojp0aHJvdWdoQnVpbGRpbmc=</a></p><blockquote><p><strong>smartis_stat.groupings</strong></p><p><strong>id</strong> = 1177</p><p><strong>client_id</strong> = 2260</p><p><strong>title</strong> = 'Статус отказа' (<em>старое значение</em>)</p><p><strong>title</strong> = 'Статус отказа (общий)' (<em>новое значение</em>)</p><p><strong>code</strong> = 'status_otkaza'</p><p><strong>smartis_stat.groupings_metrics</strong></p><p><strong>id</strong> = 7005</p><p><strong>grouping_id</strong> = 1177</p><p><strong>metric_id</strong> = 1125674 (<em>MacroCRM: Заявки</em>)</p><p><strong>smartis_stat.joins_links</strong></p><p><strong>id</strong> = 123490</p><p><strong>table_name</strong> = 'groupings_metrics'</p><p><strong>item_id</strong> = 7005</p><p><strong>join_condition</strong> = 'cfv_gr_resp.element_id = smartis_stat.CRM_elements.id AND cfv_gr_resp.custom_field_id = 1270494' (<em>старое значение</em>)</p><p><strong>join_condition</strong> = 'cfv_gr_resp.element_id = smartis_stat.CRM_elements.id AND cfv_gr_resp.custom_field_id IN (1270494,1270747)' (<em>новое значение</em>)</p><p><strong>smartis_stat.CRM_custom_fields</strong></p><p><strong>id</strong> = 1270494 (<em>_field_1270494_6</em>)</p><p><strong>crm_account_id</strong> = 452 (<em>Коннектор &laquo;Champine&raquo; интеграции #10527</em>)</p><p><strong>element_type_id</strong> = 446 (<em>MacroCRM: Заявки</em>)</p><p><strong>custom_field_title</strong> = 'Статус отказа'</p><p><strong>is_filter</strong> = 1</p><p><strong>filter_param_id</strong> = 113553</p><p><strong>smartis_stat.CRM_custom_fields</strong></p><p><strong>id</strong> = 1270747 (<em>_field_1270747_6</em>)</p><p><strong>crm_account_id</strong> = 453 (<em>Коннектор &laquo;Дом Горизонтов&raquo; интеграции #10529</em>)</p><p><strong>element_type_id</strong> = 446 (<em>MacroCRM: Заявки</em>)</p><p><strong>custom_field_title</strong> = 'Статус отказа'</p><p><strong>is_filter</strong> = 1</p><p><strong>filter_param_id</strong> = 113706</p></blockquote><p>-----</p><p>Отчет для проверки:</p><p><a class="ProsemirrorEditor-link" href="https://my.smartis.bi/reports/designer/shared/throughBuilding/R0VGNUtmQ1NzcnpMakZZanpMQmV5a2lCUnhlZFFMNjc6Ojp0aHJvdWdoQnVpbGRpbmc=">https://my.smartis.bi/reports/designer/shared/throughBuilding/R0VGNUtmQ1NzcnpMakZZanpMQmV5a2lCUnhlZFFMNjc6Ojp0aHJvdWdoQnVpbGRpbmc=</a></p><blockquote><p><strong>smartis_stat.groupings</strong></p><p><strong>id</strong> = 1236</p><p><strong>client_id</strong> = 2260</p><p><strong>title</strong> = 'Статус нецелевого' (<em>старое значение</em>)</p><p><strong>title</strong> = 'Статус нецелевого (общий)' (<em>новое значение</em>)</p><p><strong>code</strong> = 'status_necelevogo'</p><p><strong>smartis_stat.groupings_metrics</strong></p><p><strong>id</strong> = 7091</p><p><strong>grouping_id</strong> = 1236</p><p><strong>metric_id</strong> = 1125674 (<em>MacroCRM: Заявки</em>)</p><p><strong>smartis_stat.joins_links</strong></p><p><strong>id</strong> = 124519</p><p><strong>table_name</strong> = 'groupings_metrics'</p><p><strong>item_id</strong> = 7091</p><p><strong>join_condition</strong> = 'cfv_gr_resp.element_id = smartis_stat.CRM_elements.id AND cfv_gr_resp.custom_field_id = 1270463' (<em>старое значение</em>)</p><p><strong>join_condition</strong> = 'cfv_gr_resp.element_id = smartis_stat.CRM_elements.id AND cfv_gr_resp.custom_field_id IN (1270463,1270742)' (<em>новое значение</em>)</p><p><strong>smartis_stat.CRM_custom_fields</strong></p><p><strong>id</strong> = 1270463 (<em>_field_1270463_6</em>)</p><p><strong>crm_account_id</strong> = 452 (<em>Коннектор &laquo;Champine&raquo; интеграции #10527</em>)</p><p><strong>element_type_id</strong> = 446 (<em>MacroCRM: Заявки</em>)</p><p><strong>custom_field_title</strong> = 'Статус нецелевого'</p><p><strong>is_filter</strong> = 1</p><p><strong>filter_param_id</strong> = 113584</p><p><strong>smartis_stat.CRM_custom_fields</strong></p><p><strong>id</strong> = 1270742 (<em>_field_1270742_6</em>)</p><p><strong>crm_account_id</strong> = 453 (<em>Коннектор &laquo;Дом Горизонтов&raquo; интеграции #10529</em>)</p><p><strong>element_type_id</strong> = 446 (<em>MacroCRM: Заявки</em>)</p><p><strong>custom_field_title</strong> = 'Статус нецелевого'</p><p><strong>is_filter</strong> = 1</p><p><strong>filter_param_id</strong> = 113711</p></blockquote><p><br /></p><p><span style="color: rgb(30,31,33);">В клиенте </span><span style="color: rgb(30,31,33);">2260</span><span style="color: rgb(30,31,33);"> сделаны <strong>две общие группировки </strong></span><strong><span style="color: rgb(30,31,33);">Комнатность (общий)</span><span style="color: rgb(30,31,33);"> и </span><span style="color: rgb(30,31,33);">Программа покупки (общий)</span></strong><span style="color: rgb(30,31,33);"> которые группируют поля </span><span style="color: rgb(30,31,33);">Комнат</span><span style="color: rgb(30,31,33);"> и </span><span style="color: rgb(30,31,33);">Программа покупки,</span><span style="color: rgb(30,31,33);"> каждая в двух коннекторах </span><span style="color: rgb(30,31,33);">Коннектор &laquo;Champine&raquo; интеграции #10527</span><span style="color: rgb(30,31,33);"> и </span><span style="color: rgb(30,31,33);">Коннектор &laquo;Дом Горизонтов&raquo; интеграции #10529/</span></p><p><br /></p><p><span>Для справки:</span><br />-----<br /><span>Комнатность (общий)</span></p><p>Отчет для проверки:<br /><a class="PrimaryLink BaseLink" href="https://my.smartis.bi/reports/designer/shared/throughBuilding/bmV1S25CODJMRVRvaWprb0E2bjg5b25maGpGMnMyMHU6Ojp0aHJvdWdoQnVpbGRpbmc=">https://my.smartis.bi/reports/designer/shared/throughBuilding/bmV1S25CODJMRVRvaWprb0E2bjg5b25maGpGMnMyMHU6Ojp0aHJvdWdoQnVpbGRpbmc=</a></p><p><span>smartis_stat.groupings</span><br /> <span>id</span> = 1371<br /> <span>client_id</span> = 2260<br /> <span>title</span> = 'Комнатность' (<em>старое название</em>)<br /> <span>title</span> = 'Комнатность (общий)' (<em>новое название</em>)<br /> <span>code</span> = 'komnatnost'<br /> <span>is_active</span> = 1<br /> <span>is_system</span> = 0<br /><span>smartis_stat.groupings_metrics</span><br /> <span>id</span> = 7319<br /> <span>grouping_id</span> = 1371<br /> <span>metric_id</span> = 1125672<br /> <span>grouping_expression</span> = 'CASE WHEN cfv_gr_resp.value IS NULL THEN 'Не указано' ELSE cfv_gr_resp.value END'<br /><span>smartis_stat.joins_links</span><br /> <span>id</span> = 127420<br /> <span>table_name</span> = 'groupings_metrics'<br /> <span>item_id</span> = 7319<br /> <span>join_table</span> = 'CRM_custom_fields_values as cfv_gr_resp'<br /> <span>join_condition</span> = 'cfv_gr_resp.element_id = <a href="http://smartis_stat.ce_gr_resp_2_352850.id">smartis_stat.ce_gr_resp_2_352850.id</a> AND cfv_gr_resp.custom_field_id = 1270574' (<em>старое значение</em>)<br /> <span>join_condition</span> = 'cfv_gr_resp.element_id = <a href="http://smartis_stat.ce_gr_resp_2_352850.id">smartis_stat.ce_gr_resp_2_352850.id</a> AND cfv_gr_resp.custom_field_id IN (1270574,1270899)' (<em>новое значение</em>)<br /><span>smartis_stat.CRM_custom_fields</span><br /> <span>id</span> = 1270574<br /> <span>crm_account_id</span> = 452 (<em>Коннектор &laquo;Champine&raquo; интеграции #10527</em>)<br /> <span>element_type_id</span> = 444 (<em>MacroCRM: Сделки</em>)<br /> <span>custom_field_title</span> = 'Комнат'<br /> <span>is_filter</span> = 1<br /> <span>filter_param_id</span> = 113848<br /><span>smartis_stat.CRM_custom_fields</span><br /> <span>id</span> = 1270899<br /> <span>crm_account_id</span> = 453 (<em>Коннектор &laquo;Дом Горизонтов&raquo; интеграции #10529</em>)<br /> <span>element_type_id</span> = 444 (<em>MacroCRM: Сделки</em>)<br /> <span>custom_field_title</span> = 'Комнат'<br /> <span>is_filter</span> = 1<br /> <span>filter_param_id</span> = 113922<br />-----<br /><span>Программа покупки (общий)</span></p><p>Отчет для проверки:<br /><a class="PrimaryLink BaseLink" href="https://my.smartis.bi/reports/designer/shared/throughBuilding/ZTU2cDVCc1BSdFZPYlZYRUpldzBVSjBHZVVuN1VHWDM6Ojp0aHJvdWdoQnVpbGRpbmc=">https://my.smartis.bi/reports/designer/shared/throughBuilding/ZTU2cDVCc1BSdFZPYlZYRUpldzBVSjBHZVVuN1VHWDM6Ojp0aHJvdWdoQnVpbGRpbmc=</a></p><p><span>smartis_stat.groupings</span><br /> <span>id</span> = 1372<br /> <span>client_id</span> = 2260<br /> <span>title</span> = 'Программа покупки 2' (<em>старое название</em>)<br /> <span>title</span> = 'Программа покупки (общий)' (<em>новое название</em>)<br /> <span>code</span> = 'programma_pokupki'<br /> <span>is_active</span> = 1<br /> <span>is_system</span> = 0<br /><span>smartis_stat.groupings_metrics</span><br /> <span>id</span> = 7470<br /> <span>grouping_id</span> = 1372<br /> <span>metric_id</span> = 1125672<br /> <span>grouping_expression</span> = 'CASE WHEN cfv_gr_resp.value IS NULL THEN 'Не указано' ELSE cfv_gr_resp.value END'<br /><span>smartis_stat.joins_links</span><br /> <span>id</span> = 129120<br /> <span>table_name</span> = 'groupings_metrics'<br /> <span>item_id</span> = 7470<br /> <span>join_table</span> = 'CRM_custom_fields_values as cfv_gr_resp'<br /> <span>join_condition</span> = 'cfv_gr_resp.element_id = <a href="http://smartis_stat.CRM_elements.id">smartis_stat.CRM_elements.id</a> AND cfv_gr_resp.custom_field_id = 1270584' (<em>старое значение</em>)<br /> <span>join_condition</span> = 'cfv_gr_resp.element_id = <a href="http://smartis_stat.CRM_elements.id">smartis_stat.CRM_elements.id</a> AND cfv_gr_resp.custom_field_id IN (1270584,1270903)' (<em>новое значение</em>)<br /><span>smartis_stat.CRM_custom_fields</span><br /> <span>id</span> = 1270584<br /> <span>crm_account_id</span> = 452 (<em>Коннектор &laquo;Champine&raquo; интеграции #10527</em>)<br /> <span>element_type_id</span> = 444 (<em>MacroCRM: Сделки</em>)<br /> <span>custom_field_title</span> = 'Программа покупки'<br /> <span>is_filter</span> = 1<br /> <span>filter_param_id</span> = 113838<br /><span>smartis_stat.CRM_custom_fields</span><br /> <span>id</span> = 1270903<br /> <span>crm_account_id</span> = 453 (<em>Коннектор &laquo;Дом Горизонтов&raquo; интеграции #10529</em>)<br /> <span>element_type_id</span> = 444 (<em>MacroCRM: Сделки</em>)<br /> <span>custom_field_title</span> = 'Программа покупки'<br /> <span>is_filter</span> = 1<br /> <span>filter_param_id</span> = 113918</p><p><strong><br /></strong></p><p><br /></p>