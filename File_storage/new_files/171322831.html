<p><strong>для внутреннего использования!</strong></p><p><br /></p><p>Алгоритм создания персон - это основа нашей сквозной аналитики.<strong>&nbsp;</strong>Мы не просто собираем данные со всех систем, а анализируем их и собираем единую персону, благодаря которой можем анализировать рекламу по источникам в разной модели атрибуции.&nbsp;<br />Анализ данных персон выполняется регулярно. Персоны за вчерашний день всегда должны быть проанализированы.</p><p>К каждой персоне присваивается свой уникальный id.</p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_15-23-51.png" /></ac:image></p><p>При раскрытии любого элемента открывается CJM (путь клиента) в данной персоне&nbsp;</p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_15-27-32.png" /></ac:image></p><p><ac:image><ri:attachment ri:filename="image2023-11-27_15-27-54.png" /></ac:image></p><p><br /></p><p>В CJM собираются все касания клиента со всех сервисов (маркетинговые сервисы и crm) по нашему алгоритму.&nbsp;</p><p>Как работает модель атрибуции на персонах можно <a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171322207">почитать тут.</a></p><p><br /></p><ac:structured-macro ac:name="tip" ac:schema-version="1" ac:macro-id="32c9ae96-bdd6-4c4d-8196-4b590a1d602e"><ac:rich-text-body>С момента перехода на новый анализ &quot;налету&quot; допустимо что один и тот же валидный телефон/gclid&nbsp;(и другие допущенные для соединения персон параметры) - находятся в разных персонах. Анализ налету и CJM - учитывают все связанные через валидные параметры персоны, даже если они еще не соединены</ac:rich-text-body></ac:structured-macro><p><br /></p><p>Для клиентов, которые передают в CRM параметры Yclid (Yandex Client ID, он же Client ID Яндекс Метрики) и p_id мы можем с помощью шаблонной задачи в консультацию (<a href="https://app.asana.com/0/1206876306252490/1206877363534585/f">https://app.asana.com/0/1206876306252490/1206877363534585/f</a>) забирать данные по Yandex Client ID или p_id из доп поля в CRM клиента и далее использовать этот параметр для склейки персон. При распознавании данных параметров в указанном доп поле срм элемента мы найдем в БД персону с таким же Yclid или p_id,&nbsp;что позволит нам склеить персону по данному параметру.</p><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="b4fc5a34-9601-4036-8582-edf1ed5285a2"><ac:rich-text-body>Обратите внимание, что&nbsp;в стандартном анализе склейка по Yclid&nbsp;НЕ используется (то есть выполнение шаблонной задачи будет как бы обходить логику стандартного анализа для обогащения данных).</ac:rich-text-body></ac:structured-macro><p>Если у сессии и обращения есть одинаковые g_clid,&nbsp;y_clid, PID, Smartis Rop_id (Smid) тогда сессии склеются между собой.</p><p>Обратите внимание, что когда у клиента в CRM карточке есть например параметры utm или какие-либо другие, мы НЕ будем по ним склеивать данные с сессией, тк склейка сессий с персоной происходит только там, где есть информация о заявке/звонке из колл-трекинга. Чтобы сессии склеивались с срм данными персоны, когда в срм есть информация о метках utm, нужно создавать маркетинговые касания на срм данных, и в интеграции с такими МК прописывать поля, где хранится информация о utm метках.</p><p>То есть, нужно смэтчить сессионный и телефонный параметр - с помощью маркетингового касания. Обращение(заявка с сайта) может попадать напрямую в CRM, но при этом омнисистемы должны оцифровывать такие заявки с форм с сайта. Базовая нормальная ситуация - когда есть сервис, который аккумулирует внутри себя всю информацию (обычно коллтрекинг, он оцифровывает все формы и связывает звонки, сессии, ютм и т.п.). Если колл-трекинг этого не делает, то в смартис есть механизм создания маркетинговых касаний с сессией и телефоном (смотреть документацию по созданию маркетинговых касаний).</p><h2>Подробно, как работает Алгоритм создания персон&nbsp;</h2><h3>Сырье/входные данные для алгоритма</h3><p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-49-19.png" /></ac:image></p><h3>Параметры склейки</h3><p>&laquo;Hard ID&raquo;<br />В случае пересечения персон по этим параметрам - они объединяются в<br />одну<br />&bull; phone_a &ndash; мобильные, валидные номера клиентов<br />&bull; smartis_client_id (pid) &ndash; кроссдоменная кука пользователя Smartis</p><p>&laquo;Temp ID&raquo;<br />Через пересечения по ним рассматриваются параметры &laquo;Hard ID&raquo; для склейки<br />&bull; google client id</p><h3><br />Подготовка справочников валидности параметров</h3><p>Каждую ночь автоматически выполняется запрос вида:<br />SELECT param_value, count(*)<br />FROM events<br />GROUP BY param_value<br />Он проверяет какое количество событий/значений hard_id<br />связано с param_value (каждый из параметров hard/temp ID)</p><p>Запрос выполняется ПО ВСЕЙ БАЗЕ ВСЕХ КЛИЕНТОВ</p><p>В случае превышения по количеству настроенных в едином<br />конфиге &laquo;параметров адекватности&raquo; значений -<br />param_value помещается в справочник неадекватных или<br />адекватных параметров</p><p><ac:image ac:thumbnail="true" ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-51-30.png" /></ac:image></p><h3>Примеры сценариев склейки</h3><p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-53-9.png" /></ac:image></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-53-59.png" /></ac:image></p><p><br /></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-54-18.png" /></ac:image></p><p><br /></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-55-14.png" /></ac:image></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-55-19.png" /></ac:image></p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_14-55-26.png" /></ac:image></p><h3>Работа с брокерами</h3><p>Брокерские контакты влияют на то, станет ли персона адекватной или нет. Так как брокеры имеют касания в большом кол-ве персон, нам важно чтобы их данные не смешивались и не мешали корректной работе алгоритма. Если у клиента возникает запрос о том, что хотят анализировать и брокерские звонки, то мы можем дать такие рекомендации:&nbsp;</p><ul class="RichTextList-bulleted"><li><p>клиент сам должен понять нужно ли это анализировать или нет</p><ul class="RichTextList-bulleted"><li><p>если задача в том чтобы реклама не тратилась на брокеров - то да, им важно понимать что это звонки от брокеров и их анализировать.</p></li><li><p>если звонок от брокера фиксируется и сделка причисляется к брокеру - да, тоже важно учитывать</p></li></ul></li><li><p>в срм важно фиксировать все. даже если это от брокера. Где именно фиксировать - в контакте или в доп поле:</p><ul class="RichTextList-bulleted"><li><p>было бы проще если б это регистрировалось как обычные контакты,а дальше мы уже сами распределяем своим алгоритмом что брокер а что нет</p></li><li><p>реко - регистрировать в срм все как есть, в том числе контакты брокеров</p></li><li><span style="color: rgb(30,31,33);">добавить мрлжно дополнительный связанный контакт с типом &quot;брокер/агент&quot;</span></li></ul></li></ul><p><span style="color: rgb(30,31,33);"><br /></span></p><h3><span style="color: rgb(30,31,33);">Виды персон в Smartis и критерии их определения</span></h3><p><br /></p><ul class="RichTextList-bulleted"><li><p><strong>Неадекватные</strong>&nbsp;<strong>персоны</strong> - больше 10 тел или 10 емейл или больше 100 кук или больше 500 gclid или 500 yclid или больше 500 срм событий или больше 20 сделок или 500 обращений или больше 2000 сессий - такие персоны считаем неадекватными, тк никто столько точно не проведет событий (реальный покупатель)</p></li></ul><p><br /></p><ul class="RichTextList-bulleted"><li><p><strong>Сомнительные&nbsp;персоны</strong> - от 6 до 9 телефонов, от 6 до 9 емейл, от 50 до 99 кук, от 300 до 499 gclid/yclid, от 300 до 499 срм событий, от 10 до 19 сделок, от 200 до 499 обращений, от 1000 до 1999 сессий - сомнительные, так как такое кол-во событий может быть и у реального человека<br /><br /></p></li><li><p><strong>Серая зона персон</strong> - между точно адекватными и сомнительными, мы не можем определить их как адекватных или сомнительных</p></li></ul><p><br /></p><ul class="RichTextList-bulleted"><li><p><strong>Точно адекватные</strong>&nbsp;<strong>персоны</strong> - меньше или равно 3 телефона, меньше или равно 3 емейл, меньше или равно 9 кук, меньше или равно 99 gclid&nbsp;или yclid, меньше или равно 49 срм событий, меньше или равно 4 сделок, меньше или равно 24 обращений, меньше или равно 99 сессий</p></li></ul><p><br /></p><p><strong>Person ID 0</strong> -&nbsp;это значит, что у срм события нет персоны, сам по себе Person id 0 не означает, что это неадекватная или сомнительная персона</p><h4>Уничтожение неадекватных персон и их пересборка происходит регулярно:</h4><ul class="RichTextList-bulleted"><li><p>Персоны у которых больше 10 телефонов -&nbsp; прогоняем каждый телефон персоны на предмет кол-во связей по каждому из них - сколько телефонов связано с каждым конкретным телефоном. Телефоны у которых кол-во связей больше 10 помечаем как подозрительно-брокерские и персоны с таким телефоном уничтожаются и пытаются пересобраться заново. Сам номер телефона добавляется в ЧС.</p></li><li><p>Синхрон чистки -&nbsp; берет 500 самых плохих неадекватных и сомнительных персон 1 раз в сутки в час ночи и их пересобирает. Дальше копим инфо - какими эти персоны стали через неделю, через месяц и тд.</p></li><li><p>когда РМ добавляет номер в ЧС, персоны с таким телефоном полностью пересобираются.</p></li></ul><p><br /></p><p><br /></p><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="70e3bab7-0b22-4cc1-a0ad-0b5572bab474"><ac:rich-text-body><p><span style="color: rgb(30,31,33);">Клиентам не транслируем детали определения вида персоны, так как сами формулировки надо проработать. При ответе клиенту на вопрос о неадекватных и смонительных персонах объясняем так: Данная персона является неадекватной/сомнительной из-за погрешности в сборе данных (на это влияет, то что указываются ипотечные менеджеры, агенты и брокеры в срм). В рамках продукта мы следим за такими персонами и обеспечиваем, что их будет не больше 5%. У таких персон неаднкватное кол-во обращений, емейл, кук, gclid/yclid, CRM-событий, а также сессий, обращений и сделок.</span></p><p>При этом по персонам отдельно мы НЕ МОЖЕМ ГОВОРИТЬ сколько у кого сделок/звонков и тд.</p></ac:rich-text-body></ac:structured-macro><p><br /></p><p><span style="color: rgb(30,31,33);"><br /></span></p><h2>Саморегуляция</h2><ul><li>Непрерывно автоматика берет по 1 персоне с самыми плохими показателями адекватности - уничтожает ее и отправляет все их данные на</li></ul><p>переанализ</p><ul><li style="list-style-type: none;background-image: none;"><ul><li>Текущие процессы технической поддержки и мониторинга позволяют обеспечивать не более 5% данных принадлежащих неадекватным и подозрительным персонам<ul><li>Продуктово мы стремимся к не более 3%, но требуется выделение ресурса разработки для новых исследований и доработки алгоритмов (в течение 2024 года планируем сделать)<br /><br /></li></ul></li></ul></li><li>&nbsp;UI блокировки служебных телефонов пользователями и менеджерами:</li></ul><p><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_14-56-36.png" /></ac:image></p><p><br /></p><h2>Мониторинг</h2><ul><li>% проанализированных данных на персоны:</li><li>в UI клиентам и менеджерам (в модуле достоверности):<br />+ оповещение в Tg канал &quot;Smartis.Clients Stability&quot; при &lt; 90%<br /><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_15-0-11.png" /></ac:image></li></ul><h3>Мониторинг. Методика оценки Адекватности текущей базы Персон</h3><p><br />Кол-во событий связанных с неадекватными персонами / Кол-во событий всего</p><p>Примеры:</p><ul><li>Обращения: 251 784 / 20 767 982 = 1,21%</li><li>CRM события: 38 515 / 5 826 180 = 0,66%</li></ul><h2>Использование</h2><p><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_14-59-34.png" /></ac:image></p><p><ac:image ac:height="400"><ri:attachment ri:filename="image2023-11-27_15-0-30.png" /></ac:image></p><h3>Использование. С точки зрения моделей данных</h3><p>1. Прямое свойство в модели событий (обращений, crm) - можно выгрузить по API</p><p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-11-27_15-1-54.png" /></ac:image></p><p><br /></p><h2>Недостатки текущего алгоритма</h2><p>1. Не real-time для новых персон или новых параметров персон</p><ul><li>на текущий момент можно гарантировать ритм &quot;сегодня готовы данные за вчера&quot;.&nbsp;</li><li>API потребителям рекомендуем забирать из нас данные начиная с 7 утра</li></ul><p>3. После очистки неадекватных - они без изменения алгоритма могут вернуться, но под другим person_id (потому что не устраняется причина их связи)<br />4. ~1% неадекватных склеек неизбежен - важно мониторить, улучшать непрерывно<br />5. person_id - ИЗМЕНЧИВ!<br />нельзя зашиваться на то, что у обращения/сделки найденных person_id неизменен навсегда. Поэтому внешние потребители должны обновлять результаты определения person_id по date_update (есть фильтр Кадендарь: Дата фильтрации + Дата отображения на дату изменения)<br />6. Алгоритм Non-explainable - многие склейки &laquo;под капотом&raquo;, которые нельзя показать</p><h2>Планы</h2><ol><li>доработать внутренний механизм оценки корректности склейки &quot;Лупа&quot;</li><li>исключить клиентов-не-аналитики из анализа персон</li><li>проверить несколько гипотез оценки адекватности связок</li><li>ввести непрерывный мониторинг метрик качества персон</li><li>создать шаблонную задачу для изучения склейки / расклейки персоны</li></ol><p><br /></p>