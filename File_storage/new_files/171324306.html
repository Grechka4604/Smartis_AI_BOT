<ac:layout><ac:layout-section ac:type="two_right_sidebar"><ac:layout-cell><h3>Основная информация</h3><p>В Smartis можно подключить интеграцию с Alloka. в качестве сервиса обращений (то есть для получения из Alloka&nbsp;звонков). Интеграция нативная, то есть работает автоматически.</p><p>Какие данные получаем из Alloka:</p><ul><li>звонки</li></ul><p>Данные из Alloka содержат информацию о том, с какого источника (релкамного, органического) &quot;пришел&quot; клиент (совершил обращение). На основе информации о рекламном источнике обращения строится аналитика по CRM данным в разрезе каналов, площадок, кампаний и т.д.<br />То есть, на основании данных об источниках обращений из Alloka&nbsp;в Smartis работает атрибуция CRM данных (в зависимости от выбранной&nbsp;<a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171322207" rel="nofollow">Модели Атрибуции</a>)</p><p><br /></p><h3>Обновление данных по интеграции<span style="color: rgb(255,0,0);"> (заполнить!)</span></h3><p><br /></p><h3>Подключение интеграции</h3><ol><li><p>Запросить доступы у клиента для подключения интеграции (также клиент может подключить сам, не передавая доступы вам). Нужен логин пользователя Alloka доступом к нужным проектам и API ключ из Alloka. Уровень доступа - чтение. <span style="color: rgb(0,0,0);">API-ключ можно найти</span><span style="color: rgb(0,0,0);">&nbsp;в&nbsp;разделе &laquo;Профиль&raquo; аккаунта клиента в&nbsp;Аллоке&nbsp;<br /><br /><ac:image ac:height="250"><ri:attachment ri:filename="7.jpg" /></ac:image></span></p></li><li><p>В Smartis перейти в раздел Администрирование&nbsp;&rarr; Интеграции и в разделе &quot;Доступные для подключения&quot; выбрать интеграцию Alloka и нажать &quot;подключить&quot;. Заполнить данные для подключения. В&nbsp;поле формы API-ключ ввести&nbsp; Api-токен полученный в сервисе Alloka<br /><ac:image ac:height="250"><ri:attachment ri:filename="Снимок экрана 2023-12-08 в 12.18.46.png" /></ac:image></p></li><li><p>После подключения интеграция отобразится в разделе &quot;Подключенные интеграции&quot; (Администрирование&nbsp;&rarr; Интеграции).&nbsp;После подключения в клиенте интеграции с сервисом Alloka&nbsp;запускается первичная синхронизация данных. По токену берутся все доступные проекты (эти проекты в смартисе записываются так &quot;название проекта #id&quot; в дальнейшем эти проекты будут использоватся как логины для привязки)&nbsp; и по ним идёт синхронизация сущностей Alloka.&nbsp;&nbsp;</p><p><br /></p><p>Данные по интеграции после подключения автоматически забираем за 30 дней в прошлое, с момента подключения интеграции.</p></li></ol><h3>Привязка интеграции к сайту</h3><p>Пока интеграция не привязана к сайту, данные по ней невозможно просматривать в отчете по данному сайту в Smartis</p><ol><li>Зайти в раздел Администрирование&nbsp;&rarr; Проекты и сайты&nbsp;&rarr; Сайты и найти в списке нужный сайт.&nbsp;</li><li>Кликнуть на название сайта - откроется меню настройки привязок интеграций к сайту.&nbsp;</li><li>В разделе &quot;Интеграции доступные для привязки&quot; найти интеграцию Alloka&nbsp;и нажать &quot;Привязать с логином&quot;.<br /><br /><ac:image ac:width="350"><ri:attachment ri:filename="Снимок экрана 2023-12-08 в 12.23.06.png" /></ac:image></li><li>Из выпадающего списка выбрать логин, по которому приходят обращения для выбранного сайта (можно выбрать только 1 логин, если к сайту нужно привязать несколько логинов - пункт 3 и 4 выполняются столько раз, сколько логинов нужно привязать, если нужно привязать все логины интеграции - выбрать в списке &quot;Все данные этой интеграции&quot;). После выбора логина интеграция привяжется к сайту.&nbsp;<br /><ac:image ac:height="250"><ri:attachment ri:filename="Снимок экрана 2023-12-08 в 12.27.35.png" /></ac:image></li><li>Если нужно изменить логин, по которому получаете данные из Roistat, можно в уже привязанной интеграции выбрать другой логин и подтвердить изменения.</li><li>Для каждой привязанной к сайту интеграции можно дополнительно настроить условия привязки. Чтобы открыть настройки, кликните на иконку шестеренки на плашке привязанной к сайту интеграции<br /><ac:image ac:width="400"><ri:attachment ri:filename="Снимок экрана 2023-12-08 в 12.32.39.png" /></ac:image><br />Зачем заполнять условия: если в выбранном логине находятся данные по звонкам и заявкам по нескольким сайтам (объектам, ЖК) и нужно отфильтровать определенные данные.<br /><em><strong>Пример:</strong>&nbsp;в логине &quot;Застройщик&quot; есть информация о звонках по ЖК1, ЖК2 и Бренду. Нам нужно сделать так, чтобы к сайту ЖК1 были привязаны только те обращения, которые поступают по этому ЖК.<br /></em><span style="color: rgb(0,0,0);"><strong>Как это можно сделать:</strong></span><ol><li><span style="color: rgb(0,0,0);">Если в названии рекламной кампании в&nbsp;Alloka указаны названия ЖК, то можно прописать условие (в виде регулярного выражения) в поле&nbsp;Название РК соответствует регулярному выражению (учтите все возможные варианты написания - на русском и английском языке, сокращения и прочее)</span></li><li><span style="color: rgb(0,0,0);">Если нужно привязать все рекламные кампании, кроме определенных - заполнить&nbsp;в виде регулярного выражения поле&nbsp;Название РК не соответствует регулярному выражению</span></li><li><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);">Метка utm_campaign соответствует регулярному выражению - если нужная метка указывается в utm_campaign (и например не всегда указывается в названии кампании) то можно использовать этот способ. С помощью регулярного выражения нужно указать все возможные значения меток.</span><br /></span></li><li><span style="color: rgb(0,0,0);">Url страницы обращения соответствует регулярному выражению -&nbsp;подходит в случае, когда в названии кампании не указано название ЖК, но обращения по данному ЖК поступают на определенный сайт.&nbsp; Url страницы обращения&nbsp;также указываем в виде регулярного выражения.&nbsp;</span><span style="color: rgb(0,0,0);"><br /></span></li><li><span style="color: rgb(0,0,0);">Логин интеграции соответствует регулярному выражению - позволяет привязать несколько логинов сразу, с помощью регулярного выражения. Чтобы эта привязка работала, при подключении интеграции к сайту нужно выбрать &quot;Все логины этой интеграции&quot; и далее в настройках заполнить данное поле. При этом для каждого подключенного логина невозможно настроить отдельные разные условия привязки (по кампаниям и utm). Но можно задать одинаковые для всех привязанных логинов условия.</span><br /><br /><br /><span style="color: rgb(0,0,0);"><strong>Негативные условия работают как сужающие</strong>.&nbsp;<br /><br /></span><p>положительные условия будут работать по логике ИЛИ (то есть добавлять в выборку данные), а отрицательные будут сужать выборку.<br />Например если заполнено&nbsp; названия РК соответствует регулярному выражению,&nbsp;названия РК НЕ соответствует регулярному выражению&nbsp;и теги, то к сайту привяжутся данные в которых есть выбранные РК, а также выбранные теги (при этом теги могут быть и в других РК, которые мы не указывали в выборке), при этом в них нету РК из поля&nbsp;названия РК НЕ соответствует регулярному выражению.</p><p>формула: (Название РК соответствует регулярному выражению ИЛИ Теги) И Название РК не соответствует регулярному выражению<br /><br /><strong>Пример:</strong><br />Рк соответствует &quot;спб&quot;<br />Рк НЕ соответствует &quot;директ&quot;<br />Теги &quot;в работе&quot; - в отчет попадут все обращения из логина, которые:<br />пришли по рк &quot;спб&quot; с любыми тегами<br />пришли с тегами &quot;в работе&quot; по любы РК<br />и не попадут все обращения, в названии которых есть &quot;директ&quot;</p><br /><p><br /></p></li></ol></li></ol><h3><span style="color: rgb(0,0,0);">Показатели</span></h3><p><span style="color: rgb(0,0,0);">При подключении интеграции создаются системные показатели (автоматиечски). Они будут отображаться в списке показателей в конструкторе отчетов, когда выбран проект, объект или сайт, к которому привязана интеграция. Также показатели&nbsp;<span style="color: rgb(0,0,0);">Alloka</span>&nbsp;звонки&nbsp;добавляются в формулу для системного показателя &quot;Все обращения (новый)&quot;</span></p><p><span style="color: rgb(0,0,0);"><ac:image ac:width="400"><ri:attachment ri:filename="Снимок экрана 2023-12-08 в 13.07.41.png" /></ac:image></span></p><p><br /></p><ol><li><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);">Alloka</span>&nbsp;звонки - отображает данные по звонкам (источник звонка определяется на основе данных рекламной кампании <span style="color: rgb(0,0,0);">Alloka</span>, по которой пришел звонок)</span></li><li><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);">Alloka</span>&nbsp;звонки (по моделям атр.) -&nbsp;отображает данные по звонкам, которые строятся по моделям атрибуции- то есть источник звонка определяется по-разному в зависимости от выбранной в отчете модели атрибуции. Про модели читать тут:&nbsp;<span style="color: rgb(0,0,255);"><a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171322207" rel="nofollow"><span style="color: rgb(0,0,255);">4. Модели Атрибуции</span></a></span></span><br /><span style="color: rgb(0,0,0);"><br /></span></li></ol><p><br /></p><h4>Фильтры для данных Alloka</h4><p>Эти фильтры применимы только к данным из Alloka</p><p><br /></p><ul class="el-dropdown-menu el-popper filters-dropdown-list"><li class="el-dropdown-menu__item"><p>Alloka: тип обращений - фильтрует по типу обращений (если получаем в рамках интеграции не только звонки)</p></li><li class="el-dropdown-menu__item"><p>Alloka: Целевой? - фильтрует по признаку целевой/не целевой. Качество звонка при этом определяется в Alloka по его алгоритмам.<br /><br />Также к данным применяются другие фильтры, которые доступны при выборе показателей сервиса Alloka.</p></li></ul><h4>Группировки для данных Alloka</h4><p>Для данных Alloka&nbsp;доступны системные группировки&nbsp;<a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171322606" rel="nofollow">3. Группировки</a><br />Если при выборе показателя Alloka&nbsp;группировка не отображается - значит, она не применима к данным из этого сервиса (тк в них нет тех параметров, для которых применяется группировка).</p><p>Основные группировки, которые применяются к данным Alloka:</p><p><span style="color: rgb(0,0,0);"><strong>По времени:</strong></span><br /><span style="color: rgb(0,0,0);">День</span><br /><span style="color: rgb(0,0,0);">Месяц</span><br /><span style="color: rgb(0,0,0);">Неделя</span><br /><span style="color: rgb(0,0,0);">День недели</span><br /><span style="color: rgb(0,0,0);">Год</span><br /><span style="color: rgb(0,0,0);">Часы</span></p><p><span style="color: rgb(0,0,0);"><strong>По источнику:</strong></span><br /><span style="color: rgb(0,0,0);">Каналы</span><br /><span style="color: rgb(0,0,0);">Площадки</span><br /><span style="color: rgb(0,0,0);">Кампании</span><br /><span style="color: rgb(0,0,0);">utm_source</span><br /><span style="color: rgb(0,0,0);">utm_campaign</span><br /><span style="color: rgb(0,0,0);">utm_medium</span><br /><span style="color: rgb(0,0,0);">utm_content</span><br /><span style="color: rgb(0,0,0);">utm_term</span><br /><span style="color: rgb(0,0,0);">Объявления&nbsp;[для площадки Яндекс Директ и VK]<br />Каналы и Площадки<br /></span><span style="color: rgb(0,0,0);">Ключевые слова / Форматы медийки&nbsp;[для площадки Яндекс Директ]</span></p><p><span style="color: rgb(0,0,0);"><strong>По времени и источнику:</strong><br />Месяцы и каналы<br />Месяцы, каналы и площадки<br />Каналы, площадки и месяцы<br />Дни и каналы<br />Недели и каналы<br />Дни, каналы и площадки<br />Месяцы и Кампании<br />Дни и площадки<br />Группа каналов и дни<br />Дни и кампании (beta-тест)</span></p><p><span style="color: rgb(0,0,0);"><strong>По ГЕО:</strong><br />Регион<br /></span></p><p><br /></p><p><strong><br /></strong></p><p><strong>Для платных продуктов [если подключена Верификация у клиента]:</strong></p><p><br /></p><p class="el-select-dropdown__item"><span class="common-option-main-label" style="color: rgb(0,0,0);">Верификация: Итог<br /></span><span style="color: rgb(0,0,0);">Верификация: Причины отказа<br /></span><span style="color: rgb(0,0,0);">Верификация: Клиент зарегистрирован в CRM?<br /></span><span style="color: rgb(0,0,0);">Верификация: Клиент выходит на связь после звонка?<br /></span><span style="color: rgb(0,0,0);">Верификация: Клиент брошен?<br /></span><span style="color: rgb(0,0,0);">Верификация: Есть продвижение по воронке после обращения?<br /></span><span style="color: rgb(0,0,0);">Верификация: Есть целевые теги?<br /></span><span style="color: rgb(0,0,0);">Верификация: Первичность<br /></span><span style="color: rgb(0,0,0);">Верификация: Smartis-Категория<br /></span><span style="color: rgb(0,0,0);">Верификация: Период причин отказа<br /></span><span style="color: rgb(0,0,0);">Верификация: Объект в CRM (интереса подтверждающего целевое)</span></p><p class="el-select-dropdown__item"><span style="color: rgb(0,0,0);"><br /></span></p><p class="el-select-dropdown__item"><br /></p><h3><span style="color: rgb(0,0,0);">Детализация данных&nbsp;Alloka</span></h3><p class="el-select-dropdown__item"><br /></p><p><span style="color: rgb(0,0,0);">Для данных Alloka&nbsp;доступна детализация (исходные данные). Они такие же, как у других сервисов обращений - их можно просматривать в конструкторе отчетов или в данных по показателям обращений по клику из отчета или дашборда, а также в базе обращений.</span></p><p><br /></p><p><span style="color: rgb(0,0,0);"><strong>Основные свойства, передаваемые в обращениях Alloka:</strong></span></p><p><br /></p><ul><li><span style="color: rgb(0,0,0);">Данные о свойствах обращения из&nbsp;Alloka: внешний ID, сайт, дата создания, запись разговора, длительность разговора, теги, номер обращения в сервисе (первичность), качество обращения в сервисе и т.д.;&nbsp;</span></li><li><span style="color: rgb(0,0,0);">Данные о клиенте: номер телефона, email, город, регион, устройство и т.д.;</span></li><li><span style="color: rgb(0,0,0);">Данные о рекламном источнике обращения: РК трекинга, параметры сессии, utm_метки, gclid, yclid, страница входа, страница обращения.</span></li></ul><p><br /><span style="color: rgb(0,0,0);">Общая справка по детализации данных сервисов обращений:</span><br /><span style="color: rgb(0,0,255);"><a rel="nofollow" href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171321614"><span style="color: rgb(0,0,255);">3. База обращений</span></a></span><br /><span style="color: rgb(0,0,255);"><a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171322633" rel="nofollow"><span style="color: rgb(0,0,255);">6. Исходные данные (Детализация, Сырые данные)</span></a></span><br /><br /><span style="color: rgb(0,0,0);">Для Alloka&nbsp;в детализации доступны также такие наборы данных (столбцы) которые можно просматривать и при необходимости фильтровать:</span></p><p><br /></p><ul class="el-scrollbar__view el-select-dropdown__list"><li class="el-select-dropdown__item"><span>Alloka: has_history</span></li><li class="el-select-dropdown__item"><span>Alloka: utm</span></li><li class="el-select-dropdown__item"><span>Alloka: search_request</span></li><li class="el-select-dropdown__item"><span>Alloka: custom_data</span></li><li class="el-select-dropdown__item"><span>Alloka: alloka_id</span></li><li class="el-select-dropdown__item"><span>Alloka: custom_status</span></li><li class="el-select-dropdown__item"><span>Alloka: is_deferred</span></li><li class="el-select-dropdown__item"><span>Alloka: region</span></li><li class="el-select-dropdown__item"><span>Alloka: dialstatus</span></li><li class="el-select-dropdown__item"><span>Alloka: source</span></li><li class="el-select-dropdown__item"><span>Alloka: call_answered</span></li><li class="el-select-dropdown__item"><span>Alloka: first_call</span></li><li class="el-select-dropdown__item"><span>Alloka: platform</span></li><li class="el-select-dropdown__item"><span>Alloka: os</span></li><li class="el-select-dropdown__item"><span>Alloka: target</span></li><li class="el-select-dropdown__item"><span>Alloka: grouping_ids</span></li><li class="el-select-dropdown__item"><span>Alloka: sms</span></li><li class="el-select-dropdown__item"><span>Alloka: alloka_object_title</span></li><li class="el-select-dropdown__item hover"><span>Alloka: customer_status</span></li></ul><p><span style="color: rgb(0,0,0);"><br /></span></p><p class="el-select-dropdown__item"><br /></p><p class="el-select-dropdown__item"><span style="color: rgb(0,0,0);">Для добавления фильтра по указанным выше параметрам Alloka&nbsp;обратитесь в тех.поддержку Smartis.</span></p><p class="el-select-dropdown__item"><br /></p><h3><strong>Привязка источника обращения Alloka в Smartis</strong></h3><p class="el-select-dropdown__item hover">Когда мы получаем данные из&nbsp;Alloka, они изначально не относятся ни к каким рекламным источникам - привязка происходит в Smartis (из&nbsp;Alloka<span style="color: rgb(0,0,0);">&nbsp;</span>мы получаем названия рекламных кампаний и utm метки, на основе чего и выполняются привязки).<br /><br /></p><p class="el-select-dropdown__item hover">О том, как привязать обращения по рекламным кампаниям&nbsp;Alloka&nbsp;к площадкам в Smartis читать тут:&nbsp;<a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171322205" rel="nofollow">2. Каналы и площадки</a></p><p>Если обращения из&nbsp;Alloka&nbsp;не привязаны (автоматически по названию кампании или вручную), то они будут попадать в площадку &quot;Другое&quot; в отчете по площадкам/каналам.</p><p>В СJM клиента обращения из Alloka отображаются так:<br /><br /><ac:image ac:width="400"><ri:attachment ri:filename="Снимок экрана 2023-12-08 в 13.28.32.png" /></ac:image></p><p>Отображаются:</p><ul><li>тип обращения (звонки или заявки)&nbsp;</li><li>статус (отвечен/сбой и другие)</li><li>длительность разговора</li><li>телефон клиента и оператора</li><li>Канал и Площадка (на основании того, к какой площадке мы привязали данные обращения)</li><li>РК треккинга - это название кампании в&nbsp;Alloka.&nbsp;</li><li>При наличии тегов - отобразятся и теги. Теги можно проставить и в Smartis, но в таком случае в&nbsp;Alloka&nbsp;теги не передадутся.<br /><br /></li></ul><h3><span style="color: rgb(96,98,102);"><span style="color: rgb(0,0,0);">Достоверность&nbsp;Alloka</span></span></h3><p><span style="color: rgb(96,98,102);"><span style="color: rgb(0,0,0);">На данный момент достоверность по сервису не отображается. Если нужно добавить - обратитесь в тех.поддержку Smartis через шаблонную задачу:<br /><a href="https://app.asana.com/0/1204486395777830/1205284749626323/f">https://app.asana.com/0/1204486395777830/1205284749626323/f</a><br /><a href="https://app.asana.com/0/1204486395777830/1205528085385793/f">https://app.asana.com/0/1204486395777830/1205528085385793/f</a><br /><br /></span></span></p><p class="el-select-dropdown__item"><br /></p><h3><strong>Работа с часовыми поясами</strong></h3><p><strong>smartis_stat.services</strong><br /><strong>id</strong> = 20<br /><strong>title</strong> = 'Alloka'<br /><strong>service_class</strong> = '\App\Classes\Alloka\Core'</p><p><strong>1.) можем ли мы автоматически брать из сервиса настройку часового пояса? как работает эта настройка?</strong></p><p>Мы берем дату и время из данных полученных по <strong>API</strong> по сущности (<strong>Звонки</strong>, <strong>Объекты</strong>) и записываем <strong>как есть</strong>, как к нам приходит из <strong>API</strong>, без конвертации или обработки часового пояса, <strong>с той датой и временем как указано у клиента</strong>.<br />При получении звонков есть закомментированная\неактивная логика приведения даты и времени звонка к часовому поясу <strong>Europe/Moscow</strong>, ниже приведен комментарий почему данная логика не активна.<br />На данный момент автоматически не забираем настройку часового пояса из сервиса. Подобной настройки в пользовательских настройках интеграции так же нет.</p><p>Связанные методы:<br /><code>\App\Classes\Alloka\Synchronizers\Objects::save</code><br /><code>\App\Classes\Alloka\Synchronizers\Calls::save</code><br />Комментарий:<br /><em>По-хорошему надо приводить к Москве - но тогда перестает сходиться с кабинетом аллоки</em><br /><em>пока решили пренебречь тем что почасовое распределение неадекватно, важнее сойтись с аллокой потому что клиент живет с верой что там правильно</em></p><p><strong>2.) можем ли мы вообще на своей стороне вносить правки, чтобы данные по сервису отображались в нужном нам часовом поясе?</strong></p><p>Можем, но не будем. По всем сервисам. В интерфейсе мы отображаем все данные в едином часовом поясе.</p><p><strong>3.) знаем ли мы, в каком часовом поясе приходят данные из сервиса?</strong></p><p>Не знаем, берем даты сущностей как есть, как они приходят к нам по <strong>API</strong>.</p><p class="el-select-dropdown__item"><span style="color: rgb(0,0,0);"><br /></span></p><p><span style="color: rgb(0,0,0);"><br /></span></p><p><br /></p><p><span style="color: rgb(0,0,0);"><br /></span></p><p><span style="color: rgb(0,0,0);"><br /></span></p><p><br /></p></ac:layout-cell><ac:layout-cell><p><ac:structured-macro ac:name="toc" ac:schema-version="1" ac:macro-id="f5bbd513-21b9-49f0-9c22-107768ccbbd9" /></p></ac:layout-cell></ac:layout-section></ac:layout>