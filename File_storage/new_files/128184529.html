<ac:layout><ac:layout-section ac:type="two_right_sidebar"><ac:layout-cell><h3>Бизнес смысл функционала.</h3><p>Как правило клиенты фиксируют в CRM больше касаний с клиентами чем отслеживают маркетинговыми сервисами (прямые звонки в колцентр, самоходы прямо в офис продаж, прямой проброс в crm от сервиса к которому больше нет доступа, импорты данных, базы телемаркетинга, брокерские активности, самодельные статические колтрекинги). Чтобы смартис нормально разложил срм данные по источникам - нужно такие касания иметь в качестве маркетинговых (в requests).</p><p>Мы не создаем маркетинговые касания (МК) на все, что нашли в полях с источником у клиента! Важно, что мы в первую очередь стараемся оцифровать все через колл-трекинг, и уже в случаях, где это невозможно, создаем МК. Обычно МК создаются по источникам (площадкам, каналам):</p><ul><li>агенты/брокеры</li><li>самоходы (в случае, если клиенту важно их выделить в отдельный канал)</li><li>рекомендации</li><li>другие источники, по которым нет возможности оцифровать касания через колл-трекинг или сервисы заявок</li></ul><h3>Инструкция создания маркетингового касания</h3><ol><li>В конструкторе отчетов создайте показатель, который строит те данные, которые вы хотите учитывать как маркетинговые касания.</li></ol><ac:structured-macro ac:name="tip" ac:schema-version="1" ac:macro-id="5242f885-d701-4322-8a64-d4b2f8582641"><ac:rich-text-body><p>Если у клиента нужно создать несколько видов МК, то важно проверять, чтобы не было пересечений между ними. Например, если у вас МК создаются на основе сущности CRM &quot;сделки&quot; по разным полям:</p><p>-&nbsp;по полю &quot;Источник сделки&quot; (название поля - пример!)</p><p>-&nbsp;по полю &quot;Направление сделки&quot; <span>(название поля - пример!)</span></p><p>могут возникнуть пересечения - когда у 1 сделки будут нужным образом заполнены оба этих поля. В таком случае МК будут конфликтовать между собой и создаваться будет не 2 касания, а первое, которое попадет в очередь. Поэтому либо избегайте создания МК по разным полям 1 сущности, либо при формировании показателя добавляйте фильтр по второму полю, которое используется при создании других МК. Фильтр может быть либо &quot;Поле&quot; - пустое значение, либо &quot;Поле&quot; - не равно/не включает &quot;значение, которое используется для создания других МК&quot;. В таком случае конфликта не будет и МК будут создаваться корректно, а достоверность по ним будет высокая.</p><p><br /></p><p>Пример фильтрации таких МК:<br /><strong>МК Авито</strong><br />Сделки + фильтры &quot;<span>Источник сделки&quot; = &quot;Авито&quot;, <span>&quot;Направление сделки&quot; не равно &quot;Офлайн&quot;</span></span></p><p><strong>МК Офлайн<br /></strong>Сделки + фильтры &quot;Источник сделки&quot; не равно &quot;Авито&quot;, &quot;Направление сделки&quot; = &quot;Офлайн&quot;<strong><br /></strong></p></ac:rich-text-body></ac:structured-macro><p>Если вы добавите в качестве доп фильтра в показатель-основу для МК &quot;Источник Smartis: Канал равно Другое&quot; (или остальное, другая реклама и подобные) - то при создании МК мы будем проверять, соответствует ли показатель настройкам фильтрации с учетом модели атрибуции по <strong>последнему касанию, период бесконечность, включая прямые касания.</strong></p><p>То есть МК будут создаваться только если в CJM последнее касание за любой период до срм элемента лежит в канале другое или отсутствует. Если будут касания, в том числе с прямым трафиком, то МК не создастся.<br />Если вам нужно учитывать другие модели атрибуции (например, линейную или по первому касанию), то нужную модель атрибуции указывайте в сам показатель в качестве перекрытия. (см скрин с примером)</p><p><ac:image ac:width="500"><ri:attachment ri:filename="Снимок экрана 2024-08-20 в 12.10.27.png" /></ac:image></p><p>На скрине указана МА первое касание, 365 дней. В таком случае МК будут создаваться только если первое касание за последние 365 дней было по каналу Другое.</p><p>2. В разделе интеграций подключаем новую интеграцию &quot;Маркетинговые касания из CRM&quot;</p><p><ac:image ac:height="400"><ri:attachment ri:filename="2021-07-08_16-16-12.png" /></ac:image></p><p>3. В качестве &quot;Показателя-основы&quot; выбираем созданный показатель:&nbsp;в качестве показателя основы нужно выбирать ТОЛЬКО показатели, содержащие CRM данные. Если выбран другой показатель, то появится ошибка.</p><p><ac:image ac:width="400"><ri:attachment ri:filename="123456.jpg" /></ac:image></p><p>4. Далее сопоставляем поля CRM чтобы объяснить смартису где искать информацию об источниках.</p><h4>Площадки для привязки МК</h4><p>Есть 2 варианта:</p><ul><li><p>У вас четкое сопоставление&nbsp; - МК должны принадлежать одной площадке - тогда достаточно выбрать &quot;Площадка, в которую поместить данные&quot;.&nbsp;Например, так будет ОК для МК по Брокерам, Самоходам.&nbsp;</p><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="77289f6b-43e8-4458-85df-830accd8b0cf"><ac:rich-text-body>Если удалили или изменили площадку, в которую должна попадать МК по интеграции, то в настройках МК площадка автоматически изменится на новую.</ac:rich-text-body></ac:structured-macro></li><li><p>Нужно определить автоматически к каким источникам относятся данные из МК - например, есть поле, в котором указываются разные значения. Далее на основе этих значений нужно распределить МК из одной интеграции по разным площадкам. В таком случае НЕ НУЖНО заполнять поле &quot;Площадка, в которую поместить данные&quot;.</p><p>В таком случае, в настройке площадок по клику на шестеренку создается вкладка &quot;Маркетинговые касания&quot;, где необходимо сопоставлять данные с источниками (так же, как в случае с РК колл-трекинга). При этом заполнение полей по utm также НЕ обязательно. Для того, чтобы привязка работала, необходимо заполнить поле &quot;РК трекинга/Капмании&quot;</p><p>Пример в Основе 2022: не указали, в какую площадку поместить данные и теперь сами привязыаем МК к нужным площадкам, как обращения из колл-трекингов. В настройке привязок отображаются значения из поля, указанного в кач-ве поля РК трекинга/кампании<br /><br /><ac:image ac:width="470"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 14.56.38.png" /></ac:image></p><p><ac:image ac:width="600"><ri:attachment ri:filename="Снимок экрана 2024-08-19 в 14.39.48.png" /></ac:image></p><p><br /></p><h4>Кампании в МК</h4></li><li><p>Если клиенту НЕ нужен срез по кампаниям маркетинговых касаний (а нужен только срез по площадкам), то в настройках интеграции поля с utm метками и с РК трекинга/Кампанией НЕ заполняем. То есть, поля&nbsp;utm_source, utm_medium,&nbsp;utm_campaign,&nbsp;utm_content, utm_term,&nbsp;РК трекинга/Кампания&nbsp;пропускаем в настройках. <br /><br />Настройка интеграции в таком случае будет выглядеть так: заполнены только 3 первых поля.<br /><ac:image ac:height="250"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 15.01.14.png" /></ac:image><br />В таком случае отчеты по МК будут строиться в таких группировках по источнику: площадка. В группировке по кампаниям будет все в РК &quot;не указано&quot;. Также и для группировок по utm, ключевым словам и объявлениям - все будет в &quot;не указано&quot;.<br /><ac:image ac:width="600"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 15.09.15.png" /></ac:image></p><p>В карточке CJM клиента, такие МК будут выглядеть так: указана только площадка<br /><ac:image ac:height="250"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 15.27.50.png" /></ac:image></p></li></ul><ul><li><p>Если клиенту нужны детализации (группировки, отчеты), в которых должны быть видны данные по кампании, объявлению, ключевому слову - нужно заполнить в настройках интеграции поля с соответствующими utm метками:</p><ul><li>utm_source и utm_medium - будет детализация по&nbsp;utm_source и utm_medium&nbsp;</li><li>utm_campaign -&nbsp;будет срез по кампаниям,&nbsp;utm_campaign&nbsp;</li><li><p>utm_content - будет срез по объявлениям и&nbsp;utm_content</p></li><li><p>utm_term - будет срез по ключам и по&nbsp;utm_term<br /><br />При этом конечно важно, чтобы все данные для заполнения полей были в карточке срм, на основе которых создается МК.<br />На скрине ниже в карточке срм, на основе которой создается МК, нет поля, по которому можно определить параметры utm. Следовательно, мы не сможем их заполнить на основе текущего набора полей, которые нам передает клиент.<br /><br /><ac:image ac:width="350"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 14.36.04.png" /></ac:image><br /><br /></p><p>На скрине ниже - видно, что в СРМ клиента есть поля, в которых указаны метки utm. Соответственно, мы можем использовать эти поля в настройках интеграции. В таком случае для МК, у которых прописаны эти поля, будет доступен срез как по utm меткам (utm_source, utm_medium, utm_term), так и по ключевым словам.<br /><ac:image ac:width="350"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 15.15.25.png" /></ac:image><br /><br />В настройках интеграции это будет выглядеть так: в примере заполнено поле&nbsp;utm_campaign и поле РК трекинга.&nbsp;<br /><ac:image ac:width="500"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 15.22.25.png" /></ac:image><br /><br />Поле для сбора&nbsp;utm_campaign и поле РК трекинга взяли из карточки СРМ и используем для создания кампаний и привязок МК к площадкам.&nbsp;В примере ниже, у нас есть поле для сбора utm_campaign, и мы его используем в интеграции с МК.&nbsp;</p><p><ac:image ac:width="350"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 15.15.25.png" /></ac:image><br /><br />Таким образом, в отчете по МК есть срез по кампаниям, на основе указанной в этом поле информации<br /><ac:image ac:width="600"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 15.16.37.png" /></ac:image></p></li><li style="text-align: left;">Аналогичным образом можно заполнить остальные поля с utm в настройках интеграции и использовать отчеты по МК в описанных выше группировках.<br /><br />В карточке CJM клиента, такие МК будут выглядеть так: указан utm_campaign, РК трекинга и площадка<br /><br /><br /><ac:image ac:width="350"><ri:attachment ri:filename="Снимок экрана 2024-09-18 в 15.26.18.png" /></ac:image></li></ul></li></ul><ul><li style="text-align: left;">&nbsp;Параметр &quot;Кампания в Smartis&quot; (requests.campaign_id) у создаваемого МК заполняется по общим правилам назначения Кампании Smartis.&nbsp;<ac:link><ri:page ri:content-title="2.1. Кампании" /></ac:link>&nbsp;используя в качестве значений utm_campaign / РК треккинга те значения доп полей CRM элемента - которые выбраны в настройках интеграции. Если в интеграции не сопоставить какие доп поля являются&nbsp;utm_campaign ИЛИ РК треккинга, ИЛИ если значения выбранных полей будут пусты - Кампания у МК будет 0 (&quot;Кампания не найдена&quot;).</li></ul><p><ac:image ac:width="600"><ri:attachment ri:filename="Снимок экрана 2024-08-19 в 14.52.43.png" /></ac:image></p><ul><li style="text-align: left;">В полях gclid и yclid можем выбрать дополнительное поле для того чтобы маркетинговые касания могли матчится с сессиями</li></ul><p><br /><ac:image ac:height="400"><ri:attachment ri:filename="image2025-2-12_17-12-0.png" /></ac:image><br /><br /></p><p style="margin-left: 30.0px;">5. Параметр &quot;Создавать только если обращение не зафиксировано в других маркетинговых сервисах&quot; выключайте только в том случае, если вам по каким то причинам в проекте необходимо 1 в 1 совпадение данных перенесенных из срм в качестве маркетинговых. В стандартной бизнес задаче - выключать не нужно - касание маркетинговое уже есть, матчинг дублированное перенесенное не улучшит, но создаст размывание веса канала.<br />Проверка в коде выглядит так:<br /><ac:image ac:height="250"><ri:attachment ri:filename="image2021-12-2_18-3-59.png" /></ac:image><br />Означает:<br />если есть звонок с того же номера<br />у того же client_id&nbsp;<br />в пределах +/- 5 мин от даты создания срм события<br />то маркетингового касания создано не будет</p><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="12276cd8-1ad1-4029-92f2-0eda6e9dce8c"><ac:rich-text-body><p>Маркетинговые касания создадутся при наличии обращений, если обращение поступило с невалидного номера либо если в обращении нет номера телефона клиента. Это связано с тем, что в таком случае невозможно точно установить, что обращение и срм-элемент принадлежат одному и тому же клиенту (абоненту).</p><p>Пример: <br /><br /><ac:image ac:thumbnail="true" ac:height="250"><ri:attachment ri:filename="image (11).png" /></ac:image></p><p>мы видим, что обращение (в данном случае это Чат со Статусом <strong>&quot;Отклоненный&quot;</strong> - посетитель зашел на сайт, ему оператор отправил приглашение в чат (в комеджике этот инструмент называется <strong>&quot;Автоприглашение в чат&quot;)</strong> и посетитель его отклонил) добавилось в карточку (связка по google client ID), при этом <strong>номера телефона нет</strong></p><p><br /></p><p><strong>Делаем вывод:</strong></p><p>Так как автоприглашение было - мы фиксируем это событие в карточке (связка по google client id).</p><p>Сама событие отклонено, <strong>телефон клиента не зафиксирован</strong>, маркетинговое касание создалось <strong>справедливо</strong>, т.к. при проверке/поиске обращений по номеру телефона обращение не нашлось, в чате клиент идет как Аноним (если бы было событие с номером телефона, то маркетинговое касание не создалось).</p></ac:rich-text-body></ac:structured-macro><p style="margin-left: 30.0px;"><br /></p><p>6. После создания интеграции необходимо ее привязать к нужным сайтам.&nbsp; Далее Смартис начнет автоматически создавать маркетинговые касания начиная с начала текущего года каждые 15 мин с момента последнего запуска по конкретной интеграции максиму до +7 дн. Исторические данные нужно будет вручную (описание ниже).</p><h3><strong>Алгоритм пересоздания МК</strong></h3><p>1. Сначала остановить интеграцию по которой создаются МК.</p><p>2. Поставить шаблонную задачу на удаление МК за определенный период или за все время (<a href="https://app.asana.com/0/1206876306252490/1206877365616967">https://app.asana.com/0/1206876306252490/1206877365616967</a>).</p><p>3. После удаления изменить настройки интеграции как вам нужно, сохранить их.</p><p>4. Активировать/включить интеграцию.</p><p>5. Запустить пересоздание МК через мониторинг.</p><p><br /></p><p><strong>Логика последующего создания МК</strong></p><p>- каждый запуск берет -2 дня +7 дней с момента последней метки, докуда досинхронил</p><p>-&nbsp;в 4 ночи каждый день контрольно создаем за 14 последних дней</p><p>-ежедневно обновляется достоверность по МК за последние 60 дней. То есть если в срм что-то изменилось в прошлом и достоверность стала ниже, чем 99, мы ее обновим и перезаберем данные. На эту операцию есть 5 попыток (выполняется 519 синхроном, описан е работы см в разделе&nbsp;<ac:link><ri:page ri:content-title="9.1 Автоматический контроль достоверности" /></ac:link>&nbsp;)</p><p>+ есть отдельный синхрон (515) который контролирует корректность создания каждый час и удаляет те МК которые после изменения состояния данных не должны были создать.</p><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="ec10ddbd-418a-44a7-9221-1fc5af7bd297"><ac:rich-text-body>МК удалится, если после его создания поступило обращение из другого сервиса И при этом в интеграции этого МК указано &quot;Создавать только если обращение не зафиксировано в других маркетинговых сервисах&quot; (время обращения либо до МК, либо максимум 5 минут после МК).</ac:rich-text-body></ac:structured-macro><p><strong>Важное ограничение:</strong> Маркетинговое касание создается на дату создания срм события, вне зависимости от того как вы фильтруете или отображаете данные в показателе. Маркетинговое касание создается к конкретному срм элементу. Поэтому если при просмотре CJM вы видите, что МК создано, но срм элемент лежит в Другом, проверьте, какой именно срм элемент попадает в Другое.&nbsp;<br />На примере из скриншота видно, что в Другое попадает 1 в списке элемент с id заканчивающимся на 1477. Перед ним нет маркетингового касания, поэтому он попадает в Другое. Маркетинговое касание создано к следующему в списке срм элементу с id заканчивающимся на 6986.&nbsp;<br /><ac:image ac:width="600"><ri:attachment ri:filename="photo_2024-05-16_17-40-35.jpg" /></ac:image></p><p>Если выключить интеграцию - перестаёт автоматически создавать. Если включить заново - автоматически нагонет с момента выключения.</p><p>Для проверки или ручного переноса исторических данных есть показатель</p><p><ac:image ac:height="250"><ri:attachment ri:filename="2021-07-08_16-32-22.png" /></ac:image></p><p>У него доступны ВСЕ фильтры и ВСЕ группировки обращений Под графиком при выборе этого показателя - будет доступна ссылочка - &quot;Обновить маркетинговые касания из CRM&quot; - при нажатии будут прокинуты касания за построенный период. Скорость ~ 1000 шт / Х мин</p><p><br /></p><p>При подключении Маркетинговых касаний важно привязать интеграцию к сайту/сайтам.<br /><br /></p><ol><li><span style="color: rgb(0,0,0);">Для привязки необходимо пройти в раздел &quot;Проекты и сайты&quot;, выбрать нужный сайт и зайти в его настройки.&nbsp;</span></li><li><span style="color: rgb(0,0,0);">В доступных для привязки интеграциях необходимо выбрать интеграцию МК и &quot;привязать ее с логином&quot; к сайту.</span></li><li><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);">Из выпадающего списка выбрать логин, по которому приходят обращения для выбранного сайта (можно выбрать только 1 логин, если к сайту нужно привязать несколько логинов - пункт 2 и 3 выполняются столько раз, сколько логинов нужно привязать, если нужно привязать все логины интеграции - выбрать в списке &quot;Все данные этой интеграции&quot;). После выбора логина интеграция привяжется к сайту.&nbsp;</span><br /></span></li><li><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);">Иногда данные по разным проектам могут находится внутри одного сайта (логина). В таком случае мы должны перейти в настройку привязкок в привязанной к сайту в Smartis интеграции.&nbsp;<br /><ac:image ac:width="400"><ri:attachment ri:filename="Снимок экрана 2024-06-17 в 11.03.56.png" /></ac:image></span><br /></span></span></li><li><span style="color: rgb(0,0,0);">Если в названии рекламной кампании в CoMagic указаны названия ЖК, то можно прописать условие (в виде регулярного выражения) в поле&nbsp;Название РК соответствует регулярному выражению (учтите все возможные варианты написания - на русском и английском языке, сокращения и прочее)</span></li><li><span style="color: rgb(0,0,0);">Если нужно привязать все рекламные каспании, кроме определенных - заполнить&nbsp;в виде регулярного выражения поле&nbsp;Название РК не соответствует регулярному выражению</span></li><li><span style="color: rgb(0,0,0);">Выбрать конкретные рекламные кампании CoMagic&nbsp;в поле &quot;Выбор конкретных кампаний&quot; (с этим пунктом будьте осторожны, если у клиента добавятся новые рекламные кампании - условия привязки нужно будет актуализировать.&nbsp; Поэтому вариант из пункта &quot;а&quot; более надежный</span></li><li><span style="color: rgb(0,0,0);">Метка utm_campaign соответствует регулярному выражению - если нужная метка указывается в utm_campaign (и например не всегда указывается в названии кампании) то можно использовать этот способ. С помощью регулярного выражения нужно указать все возможные значения меток.</span></li><li><span style="color: rgb(0,0,0);">Url страницы обращения соответствует регулярному выражению -&nbsp;подходит в случае, когда в названии кампании не указано название ЖК, но обращения по данному ЖК поступают на определенный сайт.&nbsp; Url страницы обращения&nbsp;также указываем в виде регулярного выражения.&nbsp;</span></li><li><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);">Логин интеграции соответствует регулярному выражению - можно выбрать логины, если привязаны все логины данной интеграции.</span></span></span></li></ol><h3><strong>Важные нюансы</strong>:</h3><ol><li>Мы не создаем маркетинговых касаний если у него нет валидного мобильного телефона прошедшего проверку как телефон персон (не замечен в спаме итд). Из-за этого могут не сходится 1 в 1 данные в показателе &quot;Маркетинговые касания из CRM&quot; и в показателе-основе</li><li>Если будет меняться логика показателя - то это начнет действовать только с момента пересохранения показателя для новых проброшенных данных. При этом удалить старые проброшенные данные можно пока только через разработчика (удаление интеграции тоже не поможет). Если показатель стал &quot;менее строгим&quot; и данных добавляется а не уменьшается - то ручные пинки проброса касаний - актуализируют данные.</li><li><p>Перезапуск за одни и те же периоды не создаст дубли - уникальность определяется нашим идентификатором срм события.</p><p><br /></p></li></ol><h3>Проверка создания</h3><ol><li>Мы строим в конструкторе все показатели МК, на основе которых создаются касания и автоматически появляется показатель маркетинговые касания срм. Проверку создания МК важно выполнять именно по показателю-основе, который вы указали при настройке интеграции МК.<br /><ac:image ac:height="250"><ri:attachment ri:filename="image2024-1-15_11-26-55.png" /></ac:image></li><li>Плюс минус кол-во созданных касание в показателе маркетинговые касания срм должны суммарно совпадать с всеми элементами, которые в показателях МК.&nbsp; &nbsp;</li><li>Если не совпадает, то можно дополнительно просихронизировать в мониторинге.&nbsp;</li><li>Просинхрнизировать можно выбрав нужную интеграцию, период и нажав Данные + Достоверность.&nbsp;Достоверность ежедневно пересчитываем за последние 30 дней.<br /><ac:image ac:height="400"><ri:url ri:value="http://dl3.joxi.net/drive/2024/01/15/0044/0356/2916708/08/d1659f5950.jpg" /></ac:image></li></ol><h3>Достоверность по функционалу Маркетинговых касаний</h3><p>Достоверность обновляется каждый день, перерасчет происходит ночью. Достоверность обновляется ежедневно за последние 60 дней. То есть если у сущности срм изменились доп поля в прошлом, мы увидим эти изменения, если они попадают в период 60 дней. При этом автоматический контроль достоверности после обнаружения плохой достоверности за последние 60 дней будет автоматически перезабирать проблемные данные (в нашем случае - создавать МК).</p><p>Такое возможно, что сегодня достоверность нормальная, а завтра за прошлый период будет плохая. Если плохая достоверность за старый период, то возможно есть конфликт между пересечениями мк - нужно проверить как настроены МК с низкой достоверностью и исключить пересечения (как это сделать описано выше)</p><p><br /></p></ac:layout-cell><ac:layout-cell><p><br /></p><p><ac:structured-macro ac:name="toc" ac:schema-version="1" ac:macro-id="3859549c-916a-455a-b44f-4118612fc003" /></p></ac:layout-cell></ac:layout-section></ac:layout>