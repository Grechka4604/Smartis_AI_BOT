<p>Для того чтобы оцифровать куку (цифровой след) потенциального покупателя/покупателя который есть в CRM - нужна механика матчинга через smid. Порядок влияния на мачинг 5-7% при соблюдении рекомендаций ниже</p><h2>Логика работы</h2><ol><li>из CRM (там где рекламодатель ведет клиентскую базу), где есть телефон клиента который купил/собрался купить - ему отправляется SMS с ссылкой на сайт</li><li>в ссылке на сайт вшивается параметр &quot;smid&quot;, значение которого формируется на основе телефона с дополнительной шифрацией<ol><li><p>Используется хеширование телефона алгоритмом&nbsp;crc32b, пример на php</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="0fd643ec-d6a5-4263-a592-d364f8f8189b"><ac:plain-text-body><![CDATA[$p = '79197615929';
echo hash('crc32b', $p);


//результат: 20643ee9]]></ac:plain-text-body></ac:structured-macro></li><li>crc32b потому что он имеет наименьшее количество колизий, Игорь проверял на 1 млн телефонов - было менее 5000 дублирующихся значений (менее 0,5%) при этом имеет наименьшую длину - всегда 8 символов (что не нагружает смску)</li><li>Именно этот алгоритм вшит на стороне кода Smartis - иные алгоритмы по умолчанию не сматчатся и нужны будут кастомные доработки</li><li>телефон для хеширования должен быть именно в таком формате как в примере (начинается с 7, без +)</li></ol></li><li>Для того чтобы пользователи кликали по ссылке и цель максимального матчинга выполнялась - смс должна &quot;призывать&quot; пройти на сайт, вот самые удачные примеры, когда это работает:<ol><li>Оплатить бронь по ссылке</li><li>Активировать личный кабинет по ссылке</li><li>Подробнее об акции по ссылке</li></ol></li><li>Не важно когда будет отправлена смс - до или после покупки - в тот момент когда пользователь кликнет по ссылке - его цифровой след соединиться с историей видимой по телефону, даже если прошел месяц или год (если он не чистил историю браузера конечно)</li></ol><p><br /></p><h2>Что нужно, чтобы включить у клиента</h2><ol><li>Выполнить шаблонную задачу &quot;Шаблон №5: Анализ - Включение grsid/smid&quot;&nbsp;<a href="https://app.asana.com/0/1204486395777830/1203399493746279/f">https://app.asana.com/0/1204486395777830/1203399493746279/f</a></li><li>Передать инструкции по шифрованию, логику и рекомендации описанную выше клиенту</li><li>Клиент должен реализовать на своей стороне отправку этих смс с добавлением smid (ниже пример кода из 1С, можно отправлять тем у кого 1С)</li><li>Если выполняется 1 в 1 как мы рекомендуем и нам не требуется кастомизировать - <strong style="letter-spacing: 0.0px;">функционал может быть предоставлен бесплатно</strong> для целей повышения матчинга клиента (в рамках оплат за матчинг).</li></ol><h2>Какие есть инструменты для работы и контроля</h2><ol><li>Так можно контролировать что переходы по ссылкам со smid в смс начались:<br /><ac:image ac:height="400"><ri:attachment ri:filename="image2023-7-20_19-0-58.png" /></ac:image></li><li>Так проверять что именно пишет клиент в smid<br /><ac:image ac:height="250"><ri:attachment ri:filename="image2023-7-20_19-2-5.png" /></ac:image></li><li>Тут можно зашифровать заранее известный номер телефона на котором тестируете для проверки что все сматчится (сопоставить свой smid в смс с тем что дает этот онлайн-код) -&nbsp;<a href="https://onlinephp.io/code/eea4cbdab715eade5aa234c8fad0196920c5b421">https://onlinephp.io/code/eea4cbdab715eade5aa234c8fad0196920c5b421</a><br /><br /></li></ol><p><strong>Ньюансы</strong>:</p><ol><li>Фильтр &quot;Сегменты: Инструменты Матчинга (ROPO и другие)&quot; работает только при старом анализе и на него не надо опираться</li></ol><p><br /></p><p><br /></p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="b3e9938e-2102-43c5-be28-051a791ac34a"><ac:parameter ac:name="title">Пример кода в 1С у одно из клиентов</ac:parameter><ac:plain-text-body><![CDATA[smid = ПолучитьСтрокуHEX(ОбменЦНСИ.КодироватьAdler32(НомерАбонента))

Функция КодироватьAdler32(Знач ИсходнаяСтрока) Экспорт
	РезультатСтрока = "";
	МассивКодов = новый Массив;
	Пока НЕ ПустаяСтрока(ИсходнаяСтрока) Цикл
		рез256 = СдвигВПраво(КодСимвола(Прав(ИсходнаяСтрока, 1)), 256);
		Для Каждого ТекРез256 Из рез256 Цикл
			МассивКодов.Вставить(0, ТекРез256);
		КонецЦикла;
		ИсходнаяСтрока = Лев(ИсходнаяСтрока, СтрДлина(ИсходнаяСтрока)-1);
	КонецЦикла;

	s1 = 1;
	s2 = 0;
	Для каждого ТекМассивКодов Из МассивКодов Цикл
		s1 = s1 + ТекМассивКодов;
		s2 = s2 + s1;
	КонецЦикла;

	Возврат(s2 * 65536 + s1);
КонецФункции

Функция ПолучитьСтрокуHEX(Знач ИсходноеЗначение) Экспорт
	ХексСтрока = "";
	рез16 = СдвигВПраво(ИсходноеЗначение, 16);
	Для каждого ТекЗначение Из рез16 Цикл
		ХексСтрока = Строка(Символ(?(ТекЗначение < 10, 48, 55)+ТекЗначение)) + ХексСтрока;
	Конеццикла;
	Возврат(ХексСтрока);
КонецФункции

Функция СдвигВПраво(Знач ИсходноеЗначение, Знач Сдвиг) Экспорт
	ВозвратРезультат = новый Массив;
	Пока ИсходноеЗначение <> 0 Цикл
		ВозвратРезультат.Добавить(ИсходноеЗначение - Цел(ИсходноеЗначение / Сдвиг) * Сдвиг);
		ИсходноеЗначение = Цел(ИсходноеЗначение / Сдвиг);
	КонецЦикла;
	Если ВозвратРезультат.Количество() = 0 Тогда
		ВозвратРезультат.Добавить(0);
	КонецЕсли;
	Возврат(ВозвратРезультат);
КонецФункции]]></ac:plain-text-body></ac:structured-macro><p><br /></p><p>Как организовано у клиента чей код представлен в примере :</p><blockquote><p class="p2"><span style="color: rgb(0,0,0);"><em>провайдер СМС - внешний партнер.</em></span></p><p class="p2"><span style="color: rgb(0,0,0);"><em>механизм таков:</em></span></p><p class="p2"><span style="color: rgb(0,0,0);"><em>в 1С я формирую сообщение и сопутствующие параметры: номер телефона, логин, пароль&nbsp; и т.д.</em></span></p><p class="p2"><span style="color: rgb(0,0,0);"><em>1С дергает хранимку на нашем SQL сервере и все эти данные кладутся туда.</em></span></p><p class="p2"><span style="color: rgb(0,0,0);"><em>на сервере периодически работает джоб, который берет неотправленные данные и каким-то транспортом кидает в СМС-шлюз, который принадлежит уже внешнему провайдеру</em></span></p><p class="p2"><span style="color: rgb(0,0,0);"><em>шлюз в обратку дает ответы по отправленным сейчас и ранее данным (доставлено, отправлено и т.д.)</em></span></p><p class="p2"><span style="color: rgb(0,0,0);"><em>ответы шлюза возвращаются в 1С для отслеживания статусов отправленных сообщений.</em></span></p><p class="p2"><span style="color: rgb(0,0,0);"><em><br /></em></span></p><p class="p2"><span style="color: rgb(0,0,0);"><em><br /></em></span></p></blockquote>