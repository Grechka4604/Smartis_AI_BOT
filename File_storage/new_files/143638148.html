<p><span style="color: rgb(0,0,0);"><br /></span></p><h2><strong><span style="color: rgb(0,0,0);">API</span></strong></h2><p><span style="color: rgb(0,0,0);">Всю информацию о заявках (в том числе и переписку из чатов/мессенджеров) можно забирать по средствам API. </span></p><p><span style="color: rgb(0,0,0);">Для этого нужно клиенту/рекламному агентству передать эту документацию для изучения - <a href="http://smartcallback.ru/documentation-api/">http://smartcallback.ru/documentation-api/</a>, а так же сделать доступ API для клиента в этом разделе <a href="https://xrm.smartcallback.ru/api-client/">https://xrm.smartcallback.ru/api-client/</a> - пролистываете вниз, нажимаете добавить доступ, заполняете поля (id клиента, название, сайт, id доменов) и нажимаете сохранить. </span></p><p><span style="color: rgb(0,0,0);">Сгенерированные данные надо передать клиенту: ClientToken - вторая колонка, Signature - третья колонка, ApiToken - четвертая колонка. По этим данным клиент/рекламное агентство будут забирать от нас необходимые данные.&nbsp;</span></p><p><br /></p><p><br /></p><h2><strong>Webhooks</strong></h2><h5>SmartCallBack умеет отправлять данные по обращениям с помощью POST и GET запроса на любой указанный адрес в виде Webhook (вебхук), например по адресу:<br /><a rel="nofollow" class="external-link" href="http://site.ru/leads/">http://site.ru/leads/?</a></h5><h5><strong>Рекомендуем:</strong>&nbsp;использовать SSL-сертификат (https) для конечной принимающей стороны, для обеспечения безопасности данных.</h5><h5><strong>Триггеры срабатывания</strong>:</h5><h5>Webhook №1: Начало звонка оператору<br />Отправление информации об обращении и посетителе который заказал звонок. Триггер срабатывания - начала звонка оператору. Может быть полезным для отображения карточки клиента в момент звонка в CRM</h5><h5><br />Webhook №2: Создание заявки через messenger<br />Отправление информации об обращении и посетителе, который оставил заявку через Viber, WhatsApp или Telegram. Триггер срабатывания - создание новой заявки через Viber, WhatsApp или Telegram.</h5><h5><br />Webhook №3: Закрытие диалога<br />Отправление информации об обращении и посетителе, с которым происходило общение</h5><h5>(при необходимости набор триггеров может быть расширен).</h5><h5>Эта возможность может быть полезна для отображения карточки клиента в момент звонка в CRM.</h5><h5>Запрос включает в себя набор параметров:</h5><ul><li><h5><code>id</code>- уникальный id заявка в системе SmartCallBack</h5></li><li><h5><code>phone</code>- номер клиента</h5></li><li><h5><code>status</code>&nbsp;- код статуса обращения, пример:{&quot;code&quot;:&quot;6&quot;,&quot;title&quot;:&quot;Вызов оператора&quot;}</h5></li><li><h5><code>type</code>&nbsp;- тип заявки в системе SmartCallBack</h5></li><li><h5><code>email</code>&nbsp;- mail оставленный клиентом</h5></li><li><h5><code>domen_id</code>&nbsp;- уникальный id домена в системе SmartCallBack</h5></li><li><h5><code>date_create</code>- дата оставления заявки (unix-метка времени по Москве)</h5></li><li><h5><code>date_callback</code>- дата звонка</h5></li><li><h5><code>queryType</code>- качество обращения, от 0 до 9, где 0-не целевой , 1-околоцелевой, 9-целевой.</h5></li><li><h5><code>manager_id</code>- номер менеджера в системе SmartCallBack</h5></li><li><h5><code>date_queryType</code>&nbsp;- дата присвоения queryType</h5></li><li><h5><code>page_from</code>&nbsp;- страница с которой оставили заявку</h5></li><li><h5><code>page_start</code>&nbsp;- страница захода на сайт</h5></li><li><h5><code>session_start</code>- номер сессии</h5></li><li><h5><code>city</code>&nbsp;- город</h5></li><li><h5><code>domen</code>- адрес домена</h5></li><li><h5><code>manager_name</code>- имя менеджера в системе SmartCallBack</h5></li><li><h5><code>duration</code>&nbsp;- продолжительно звонка по заявке</h5></li><li><h5><code>record_url</code>- ссылка на запись разговора</h5></li><li><h5><code>utm_source</code>- utm sourse источника с которого оставили заявку</h5></li><li><h5><code>utm_medium</code>- utm medium источника с которого оставили заявку</h5></li><li><h5><code>utm_campaign</code>- utm medium источника с которого оставили заявку</h5></li><li><h5><code>utm_content</code>- utm content источника с которого оставили заявку</h5></li><li><h5><code>utm_term</code>- utm term источника с которого оставили заявку</h5></li><li><h5><code>tags</code>- теги к заявке из системы SmartCallBack</h5></li><li><h5><code>message</code>- переписка пользователя и оператора</h5></li></ul><h3><strong>Справочник типов обращений SmartCallBack (возможные значения type в списке выше):</strong></h3><h5>1 &ndash;&nbsp;CallBack &nbsp;Обратный звонок<br />2 &ndash;&nbsp;Telegram &nbsp;Заявки из Telegram Messenger<br />3 &ndash;&nbsp;WhatsApp &nbsp;Заявки из WhatsApp Messenger<br />4 &ndash;&nbsp;Viber &nbsp;Заявки из Viber Messenger<br />5 &ndash;&nbsp;F.leads &nbsp;Заявки из F.leads Messenger<br />6 &ndash;&nbsp;Вконтакте &nbsp;Заявки из VK Messenger или VK Leads<br />7 &ndash;&nbsp;CoMagic &nbsp;Заявки из системы CoMagic<br />8 &ndash;&nbsp;Такси<br />9 &ndash;&nbsp;Email<br />10 &ndash;&nbsp;MobileDirect Прямой звонок с мобильного устройства в call-центр<br />11 &ndash;&nbsp;myTarget (автоматизированные лиды из рекламной системы myTarget)<br />12 &ndash;&nbsp;LiveChat (обращения через онлайн консультант на сайте)<br />13 &ndash;&nbsp;Юла Автоматизированные лиды с портала объявлений Юла</h5><h3><strong>Справочник статусов обращений SmartCallBack (возможные значения поля status из списка параметров веб-хук)</strong></h3><h5>0 &ndash; Новая<br />1 &ndash; Принята<br />2 &ndash; Нет ответа<br />3 &ndash; Обработана<br />4 &ndash; Архив<br />5 &ndash; MobileDirect<br />6 &ndash; Вызов оператора<br />7 &ndash; Вызов посетителя<br />8 &ndash; Оператор на линии<br />9 &ndash; Посетитель на линии<br />10 &ndash; Идет разговор<br />11 &ndash; Завершено оператором<br />12 &ndash; Завершено посетителем<br />13 &ndash; Обрыв связи<br />14 &ndash; Email<br />15 &ndash; Ожидание повторного звонка<br />16 &ndash; Потенциальный клиент<br />17 &ndash; Диагностика системы<br />18 &ndash; Ожидаем действие оператора<br />19 &ndash; Отправлено письмо<br />20 &ndash; Запись на показ<br />21 &ndash; Запись на показ<br />22 &ndash; Помечено как спам<br />23 &ndash; Удалена<br />24 &ndash; Подписка<br />25 &ndash; Отправка SMS<br />26 &ndash; Viber<br />27 &ndash; WhatsApp<br />28 &ndash; На обработку<br />29 &ndash; Telegram<br />31 &ndash; F.leads<br />32 &ndash; Вконтакте<br />34 &ndash; Другие события<br />35 &ndash; Новый диалог<br />36 &ndash; Запрос на чат<br />37 &ndash; Идет общение<br />38 &ndash; Диалог закрыт<br />39 &ndash; Оператор не ответил<br />40 &ndash; Посетитель не ответил</h5><p><br /></p><h3>Настройка</h3><h5>Интеграция с помощь web-хук включается в настройках сайта в блоке интеграций (см. скриншот ниже), в ее настройках вы можете указать на какие URL направлять запросы при различных событиях SmartCallBack.</h5><h5><ac:image ac:width="700"><ri:url ri:value="https://docs.uiscom.ru/download/attachments/138908379/image2022-3-28_14-32-33.png?version=1&amp;modificationDate=1648467154779&amp;api=v2" /></ac:image></h5><p><br /></p><h5><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2021-9-28_13-29-39.png" /></ac:image></span></h5><h3>Важно:</h3><h5>Хука может отправлять в формате post и get запроса.</h5><h5>При использовании GET-запроса параметр message (текст переписки) не передается (так как GET-запрос имеет ограничение по длине запроса).</h5><p><br /></p><p><strong><br /></strong></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:url ri:value="http://smartis.bi/faq/content/images/2018/02/2018-02-27_17-46-39.png" /></ac:image></span></p><p><br /></p><h3><strong>Примеры запросов:</strong></h3><h4>GET:</h4><h5>id=9795&amp;status=38&amp;status<em>type</em>id=12&amp;domen<em>id=1619&amp;application=LiveChat&amp;fio=LiveChat client #888385&amp;phone=&amp;date</em>create=1519807722&amp;utm<em>source=&amp;utm</em>campaign=&amp;utm<em>term=&amp;utm</em>content=&amp;utm<em>medium=&amp;query</em>number<em>domen=1&amp;query</em>number<em>client=1&amp;status</em>title=Диалог закрыт&amp;status<em>type=LiveChat&amp;domain</em>title=<a rel="nofollow" class="external-link" href="http://sol-system.ru/">sol-system.ru</a>&amp;count<em>messages</em>from<em>operator=2&amp;count</em>messages<em>from</em>client=2&amp;messages=json_строка</h5><p><br /></p><h4>POST:</h4><h5>Array<br />(<br />[id] =&gt; 4709759<br />[phone] =&gt; 79670330590<br />[status] =&gt; 6<br />[type] =&gt; 1<br />[email] =&gt;<br />[domen_id] =&gt; 573<br />[date_create] =&gt; 1632403560<br />[date_callback] =&gt; 0<br />[manager_id] =&gt; 0<br />[queryType] =&gt; 0<br />[date_queryType] =&gt; 0<br />[name] =&gt;<br />[sources_json] =&gt; {&quot;getParams&quot;:{&quot;test&quot;:&quot;&quot;},&quot;startQuery&quot;:{&quot;id&quot;:&quot;4709759&quot;},&quot;mainAbout&quot;:&quot;Прямой заход&quot;,&quot;source_type&quot;:&quot;direct_hit&quot;,&quot;utm_source&quot;:null,&quot;utm_medium&quot;:null,&quot;utm_campaign&quot;:&quot;&quot;,&quot;utm_content&quot;:&quot;&quot;,&quot;utm_term&quot;:&quot;&quot;,&quot;first_page&quot;:&quot;https:\/\/<a rel="nofollow" class="external-link" href="http://auto.smartcallback.ru/">auto.smartcallback.ru</a>\/?test&quot;,&quot;page_from&quot;:&quot;&quot;}<br />[page_from] =&gt;<br />[page_start] =&gt;&nbsp;<a class="external-link" rel="nofollow" href="https://auto.smartcallback.ru/?test">https://auto.smartcallback.ru/?test</a><br />[session_start] =&gt; 1632403502<br />[city] =&gt; Москва<br />[domen] =&gt;&nbsp;<a href="http://auto.smartcallback.ru/" class="external-link" rel="nofollow">auto.smartcallback.ru</a><br />[manager_name] =&gt;<br />[duration] =&gt;<br />[record_url] =&gt;<br />[gclid] =&gt;<br />[utm_source] =&gt;<br />[utm_medium] =&gt;<br />[utm_campaign] =&gt;<br />[utm_content] =&gt;<br />[utm_term] =&gt;<br />[tags] =&gt; Array<br />)</h5><p><br /></p><p><strong><ac:structured-macro ac:name="ui-button" ac:schema-version="1" ac:macro-id="342b1c88-7e36-432f-8e4c-b1012ab5e4dd"><ac:parameter ac:name="color">green</ac:parameter><ac:parameter ac:name="size">large</ac:parameter><ac:parameter ac:name="icon">info</ac:parameter><ac:parameter ac:name="title">Передача заявок и чатов в CRM/коллтрекинговые системы</ac:parameter><ac:parameter ac:name="url">https://docs.uiscom.ru/pages/viewpage.action?pageId=143638212</ac:parameter></ac:structured-macro><br /></strong></p>