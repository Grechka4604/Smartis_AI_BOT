<ac:layout><ac:layout-section ac:type="two_right_sidebar"><ac:layout-cell><p>Наш web-счетчик наподобие Яндекс.Метрики или Google Analytics (но разумеется мы не гонимся за полным воспроизведением их функционалов).</p><p>Устанавливается на этапе внедрения на все сайты и страницы клиента. Если добавляются новые сайты, необходимо контролировать установку кода.&nbsp;</p><p>Устанавливается на сайты клиентов одной строчкой кода, пример:</p><table class="wrapped"><colgroup><col /></colgroup><tbody><tr class="xtr-0"><td class="xtd-0-0"><p><code class="jscript plain">&lt;script type=</code><code class="jscript string">&quot;text/javascript&quot;</code>&nbsp;<code class="jscript plain">async src=</code><code class="jscript string">&quot;//<a href="https://docs.uiscom.ru/pages/smartcallback.ru/api/SmartCallBack.js?t=TOKEN_">smartcallback.ru/api/SmartCallBack.js?t=TOKEN_</a>КЛИЕНТА&quot;</code>&nbsp;<code class="jscript plain">charset=</code><code class="jscript string">&quot;utf-8&quot;</code><code class="jscript plain">&gt;&lt;/script&gt;</code></p></td></tr></tbody></table><p><br /></p><h3><strong>Он нам нужен чтобы</strong></h3><ol><li>получать сырые данные о посещениях каждого конкретного человека на сайт наших клиентов&nbsp;<ol><li>Да Яндекс.Метрика умеет отдавать через Logs API сырые сессии - но там идет частичное скрытие персональных данных например IP + ЯМ не закрывает остальных задач зачем нам нужен наш счетчик</li><li>Google Analytics не отдает сырых данных</li></ol></li><li>Кросс-доменная идентификация человека. Если человек посещает сайты наших клиентов в одном и том же браузере (каждое открытие инкогнито считается другим браузером) - мы будем знать что это один и тот же человек за счет этой кросс-доменной идентификацией</li><li>Последующая кросс-девайсная склейка. Наш идентификатор браузера (так называемый pid) который фиксируется счетчиком за каждым браузером - в последующих алгоритмах персон объединяется с другими pid того же человека или семьи - тем самым соединяя разные браузеры и устройства.</li><li>Cookie-less идентификация. В наш счетчик встроена fingerprint идентификация, которая на текущий момент дает точность 80% для ПК и 60% для мобильных устройств. Это наша подготовка к полному отключению кук.</li><li>Определение гео-локации человека. Работает на базе ЯКарт</li><li>Как Smartis Tag Manager - если подключенные интеграции в Smartis требуют дополнительного размещения кода на сайт клиента - мы через наш код добавляем на сайт клиента этот код дополнительно &quot;обезопасивая клиента&quot; от его потенциальных ошибок<ol><li>Например куки-матчинг с Циан Postview</li><li>Например куки-матчинг с MyTarget чтобы отправлять в него аудитории в рамках задач CDP</li></ol></li><li>Отслеживание&nbsp;<a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=169517487" rel="nofollow">микроконверсий</a></li></ol><p><strong>Чтобы получить идентификатор сессии Smartis на сайте, нужно выполнить:<br /></strong></p><pre>document.addEventListener('SCBready', function(){</pre><pre>  console.info(smAnalytics.getSessionId());</pre><pre><code>});</code></pre><p><strong><br /></strong></p><p><strong>Чтобы получить PID текущего посетителя на сайте клиента</strong>, необходимо использовать следующий код:</p><pre><code>document.addEventListener('SCBready', function(){
  console.info(smAnalytics.getPeopleId());
});</code></pre><p><br /></p><p>Этот код позволяет зафиксировать идентификатор сессии Smartis на сайте клиента. PID (идентификатор браузера) будет доступен в данных, которые считываются по сессии нашим кодом на сайте клиента</p><p class="p1">Обратите внимание, что с офлайн площадок не будет данных о сессиях (посетителях сайтов). Так как счетчик устанавливается только на сайт клиента. примеры площадок, с которых не будет сессий:</p><ul style="list-style-type: square;"><li class="p1">радио</li><li class="p1">ТВ</li><li class="p1">наружная реклама</li><li class="p1">листовки</li><li class="p1">пресса</li><li class="p1">электрички</li><li class="p1">реклама на транспорте</li><li class="p1">и другие офлайн источники, в том числе созданные у клиента (например, посещение мероприятий, звонок в КЦ и тому подобные)</li></ul><h3><strong>Инструкции установки</strong></h3><ol><li><strong>Код счетчика&nbsp;</strong>конкретного клиента можно найти<strong>&nbsp;в разделе&nbsp;<a href="https://docs.uiscom.ru/pages/viewpage.action?pageId=171321620">&quot;Администрирование&quot;&nbsp;&rarr;&nbsp;&quot;Проекты и сайты&quot;</a>.&nbsp;</strong>Там же лежат рекомендации как его устанавливать на сайт.<strong><br /><br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-8-29_22-6-37.png" /></ac:image></span><br /><br /></strong><ol><li>Если нарушить рекомендации - могут быть расхождения с другими счетчиками с которыми может сверяться клиент - они будут выполняться в разное время тем самым терять часть сессий, или блокироваться какими то ошибками в коде до нашего кода<ol><li><p class="p1"><strong>Если клиент может поставить код только через GTM</strong>&nbsp;(Google Tag Manager):</p><ol><li><p class="p1">ставить на триггер &quot;All Pages&quot;</p></li><li><p class="p1">Мы не рекомендуем так делать потому что:</p><ol><li>появляется дополнительная задержка между входом человека и инициализацией GTM</li><li>Потому что Google вводит без предупреждения ограничения для РФ и в любой момент может все сломаться</li></ol></li><li><p class="p1">мы не гарантируем сходимость 95% с ЯМ и GA для сайтов где наш счетчик стоит через GTM</p></li><li><p class="p1">Удобно проверять что установлено через GTM с помощью расширение&nbsp;<a rel="nofollow" class="external-link" href="https://chrome.google.com/webstore/detail/tag-assistant-legacy-by-g/kejbdjndbnbjgmefkgdddjlbokphdefk">Tag Assistant</a>&nbsp;в Google Chrome</p></li><li><p class="p1">Важно соблюдать последовательность кодов в GTM. Наш счетчик должен быть установлен первым -&nbsp; при нарушении этой последовательности у нас будут еще больше расхождения в объеме сессий.</p></li><li><p class="p1">Важно также соблюдать рекомендации по месту установки кода (в блоке &lt;head&gt; переда закрывающим блоком &lt;/head&gt;)<br /><br /></p></li></ol></li></ol></li></ol></li><li>На сайтах где наш код установлен, но сайт незарегистрирован сессия фиксироваться не будет. Для отслеживания с каких сайтов идут нерегистрируемые запросы сделана специальная вкладка &quot;Потенциальные сайты&quot;<br /><br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-9-6_14-39-38.png" /></ac:image></span><br /><br /><ol><li>В ней вы можете изучить каждый домен и поддомен, с которого идут запросы с токеном клиента и выполнить следующие действия:<ol><li>Создать сайт нажав на &quot;+&quot; если вы знаете что этот сайт принадлежит этому клиенту, просто вы забыли его зарегистрировать в Smartis</li><li>Скрыть нажав &quot;корзинку&quot; - тем самым вы подтвердите что проверили и этот сайт не надо регистрировать и не хотите больше чтобы он маячил перед глазами в этом списке</li><li>Нажать на &quot;ссылка&quot; в колонке &quot;Основной домен&quot; (актуально для строк-поддоменов) и внутри настроек основного домена включить &quot;Учет поддоменов&quot;<br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><ac:image ac:height="400"><ri:attachment ri:filename="image2023-8-29_22-16-30.png" /></ac:image></span></li></ol></li></ol><ol><li>Для коробок - Работа нашего счетчика сессий и прослушка форм - должна быть настроена в облаке. При создании сайта в коробке - он должен автоматически создаваться в облаке, что обычно достаточно для сбора сессий, но дополнительные настройки (учет поддоменов, зеркала сайта итд ) надо делать в облаке.&nbsp;<ac:link><ri:page ri:content-title="Коробочные решения / особенности работы" /></ac:link></li></ol></li><li>Данные можно анализировать в Smartis выбирая&nbsp;<strong>показатель Посетители (Smartis).&nbsp;</strong>Для него доступна детализация сырых данных, и проваливание в CJM<ol><li>У этого показателя есть соответствующие свойствам сессий группировки и фильтры для анализа<br /><br /></li></ol></li></ol><p><strong>ВАЖНО: </strong>код на сайте НЕ должен быть закомментирован. В таком случае он не будет работать (сессии с сайта перестанут поступать в Smartis).<strong> </strong>Закомментированный код<strong> -&nbsp;</strong>означает, что часть кода на веб-странице была временно отключена или скрыта от выполнения. Это может быть сделано для тестирования, устранения ошибок или временного отключения функционала.</p><p>Закомментированный код не будет выполняться браузером, и, следовательно, не будет влиять на работу сайта. Это может быть полезно, если разработчик хочет сохранить код для будущего использования, но не хочет, чтобы он мешал текущей работе сайта.</p><p>Пример закомментированного кода - на скриншоте.&nbsp;</p><p>Символы, указывающие на закомментированный код, зависят от языка программирования или разметки.&nbsp; Для HTML:</p><ol><li style="list-style-type: none;background-image: none;"><ul><li>Комментарии обозначаются тегами <code>&lt;!--</code> и <code>--&gt;</code>.</li><li>Пример: <code>&lt;!-- Это комментарий в HTML --&gt;</code></li></ul></li></ol><p><strong><ac:image ac:width="600"><ri:attachment ri:filename="Снимок экрана 2024-09-23 в 12.36.01.png" /></ac:image></strong></p><p><strong><br /></strong></p><h3><strong>Добавление сайтов с подстраницами</strong></h3><p>Если вы хотите добавить сайт с подстраницей (например example_site.ru/subpage)</p><p>В таком случае привязанную&nbsp; к сайту интеграцию SmartCallBack необходимо изменить следующим образом:</p><ol><li>У нас должно быть два сайта:<ol><li>Основной без подстраницы ( example_site.ru)</li><li>Целевой, содержащий подстраницу (<a href="http://example.ru/subpage">example_site.ru/subpage</a>)<br /><ac:image ac:height="150"><ri:attachment ri:filename="image2025-2-20_17-39-33.png" /></ac:image></li></ol></li><li>Переходим в настройки нашего сайта (<a href="http://example.ru/subpage">example_site.ru/subpage</a>)<br /><br /><ac:image ac:height="250"><ri:attachment ri:filename="image2025-2-20_17-40-52.png" /></ac:image></li><li>В выпадающем списке выбираем этот же сайт, но без подстраницы (example_site.ru)<br /><ac:image ac:height="250"><ri:attachment ri:filename="image2025-2-20_17-43-11.png" /></ac:image></li><li>В настройках интеграции SmartCallBack записываем следующее регулярное выражение (соответсвует названию вашей подстраницы)<br /><ac:image ac:height="250"><ri:attachment ri:filename="image2025-2-20_17-46-5.png" /></ac:image></li></ol><ac:structured-macro ac:name="warning" ac:schema-version="1" ac:macro-id="98c692f0-6994-442e-9ab7-0a775625df83"><ac:rich-text-body><p>Иначе при построении отчетов сессии по этому сайту (<a href="http://example.ru/subpage">example_site.ru/subpage</a>) не отобразятся.</p></ac:rich-text-body></ac:structured-macro><p><br /></p><h3><strong>Особенности:</strong></h3><ol><li><strong>Дублирование данных<br /></strong>Возможны случаи дубликации данных по сессиям, это нормально в течении недели после проведения работ по сессиям. После этого данные должны быть уникализированы - за это отвечает процесс &quot;оптимизации партиций ClickHouse&quot; - см. таблицу smartis_stat.click_house_partitions Графана:&nbsp;<a href="https://grafana.smartis.bi/d/q98Sz7RHz/dubli-v-clickhouse?orgId=1">https://grafana.smartis.bi/d/q98Sz7RHz/dubli-v-clickhouse?orgId=1</a></li><li><strong>Расхождение до 5%</strong>&nbsp;по сравнению с Яндейс.Метрикой или Google Analytics&nbsp;<strong>считается нормой</strong>.<br /><strong>При бОльших значениях</strong>&nbsp;- запрашивайте гостевой доступ к счетчику для продукт менеджера, фиксируйте задачу вида &quot;Счетчик - расхождения более 5%&quot; - фиксируйте там клиента/сайт и доступы - продукт менеджер изучит почему возникает расхождение.</li><li>Другие возможные причины расхождений:&nbsp;<a rel="nofollow" href="https://docs.google.com/document/d/13yuz8DEbw4WIFmjxKyoXHQnJ56u0wwiAaev96oMB4Wg/edit" class="external-link">https://docs.google.com/document/d/13yuz8DEbw4WIFmjxKyoXHQnJ56u0wwiAaev96oMB4Wg/edit<br /></a></li><li>Все по пунктам выше идеально, но мы видим разницу в визитах. Вот объяснение: ЯМ часто блокируется в браузерах как счетчик-трекер, из-за чего не устанавливается куки, и каждый просмотр странички фиксируется как новая сессия. У нас такого эффекта нет, наш счетчик не блокируется браузерами, как трекер, он трактуется как внутренний скрипт клиента, поэтому сессии в Смартис ближе к реальным людям, которые зашли на сайт, а в ЯМ это ближе к просмотрам страничек, поэтому цифры в ЯМ больше, чем в Смартис. Особенно это проявляется в смартфонах, мы можем увидеть это отчете в ЯМ по типам устройств. ПК у нас сходится, даже в Смартисе больше, а смартфоны нет. Айфонов примерно половина трафика, но они по умолчанию блокируют все счетчики, пока пользователь не даст свое согласие.<br />Если клиент не верит в счетчик Смартис: записать видео по комментарию 4</li></ol><h3>Как проверять установку кода через gtm</h3><p><strong>1. Можно проверить через расширение браузера Tag Assistant</strong></p><p><strong>2. Базовая проверка</strong></p><ul><li class="ProsemirrorEditor-listItem"><p>ищем наш счетчик<br /><br /><ac:image ac:height="400"><ri:attachment ri:filename="image.png" /></ac:image></p></li><li class="ProsemirrorEditor-listItem"><p>видим, что код установлен в head напрямую</p></li><li class="ProsemirrorEditor-listItem"><p>если бы установка была через GTM , то наш код был бы где-то далеко внизу, не в head</p><p><strong>Вот пример скриптов которые добавлены через Google tag manager</strong><br /><br /><ac:image ac:height="400"><ri:attachment ri:filename="image (1).png" /></ac:image></p></li></ul></ac:layout-cell><ac:layout-cell><p><ac:structured-macro ac:name="toc" ac:schema-version="1" ac:macro-id="17e6d71a-a7ff-4c10-ad75-c46855f2b438" /></p></ac:layout-cell></ac:layout-section></ac:layout>